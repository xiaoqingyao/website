2019-02-11 10:49:54,403 [52412] DEBUG Sys - select name from dbo.sysobjects where id = object_id(N'[dbo].[fun_getPY]') and xtype in (N'FN', N'IF', N'TF')
2019-02-11 10:49:54,466 [52412] DEBUG Sys - select name from dbo.sysobjects where id = object_id(N'[dbo].[fun_getPY]') and xtype in (N'FN', N'IF', N'TF')
2019-02-11 10:49:54,469 [52412] DEBUG Mms - select name from dbo.sysobjects where id = object_id(N'[dbo].[fun_getPY]') and xtype in (N'FN', N'IF', N'TF')
2019-02-11 10:49:54,496 [52412] DEBUG Mms - select name from dbo.sysobjects where id = object_id(N'[dbo].[fun_getPY]') and xtype in (N'FN', N'IF', N'TF')
2019-02-11 10:52:23,909 [52872] DEBUG Servicesys_user - 获取实体对象
2019-02-11 10:52:23,918 [52872] DEBUG Sys - select sys_user.* from sys_user where  UserCode =  'admin'and Password =  '1234'and IsEnable =  'True'
2019-02-11 10:52:24,008 [52872] DEBUG Sys - 
update sys_user
set LoginCount = isnull(LoginCount,0) + 1
   ,LastLoginDate = getdate()
where UserCode = 'admin' 
2019-02-11 10:52:24,113 [52872] DEBUG Sys - insert into sys_loginHistory([UserCode],[UserName],[HostName],[HostIP],[LoginCity],[LoginDate]) values('admin','管理员','','219.142.8.222','北京市','2019/2/11 10:52:24')
2019-02-11 10:52:24,124 [52872] DEBUG Servicemms_project - 获取实体对象
2019-02-11 10:52:24,124 [52872] DEBUG Mms - select mms_project.* from mms_project where  ProjectCode =  '201306030001'
2019-02-11 10:52:24,215 [52764] DEBUG Sys - select * from sys_userSetting where UserCode='admin'
2019-02-11 10:52:25,941 [52900] DEBUG Sys - 
--角色的菜单
select distinct B.*
from sys_roleMenuMap A
inner join sys_menu  B on B.MenuCode = A.MenuCode
where B.IsEnable='1'
  and RoleCode in (
  select RoleCode from sys_userRoleMap where UserCode = 'admin' --用户的角色
union all
  select RoleCode from sys_organizeRoleMap where OrganizeCode in  --机构的角色
  (
	select OrganizeCode from sys_userOrganizeMap where UserCode = 'admin'
  )  
)
order by B.MenuSeq,B.MenuCode
2019-02-11 10:52:31,549 [52872] DEBUG Sys - 
select 1
from sys_roleMenuMap A
left join sys_userRoleMap B on B.RoleCode = A.RoleCode
left join sys_menu C on C.MenuCode = A.MenuCode
where B.UserCode = 'admin'
and C.URL in ('/Mms/direct/Index','/Mms/direct')
2019-02-11 10:52:31,564 [52872] DEBUG Servicemms_warehouse - 获取动态列表
2019-02-11 10:52:31,564 [52872] DEBUG Mms - select WarehouseCode as value,WarehouseName as text from mms_warehouse where  ProjectCode =  '201306030001'
2019-02-11 10:52:31,575 [52872] DEBUG Servicesys_code - 获取动态列表
2019-02-11 10:52:31,576 [52872] DEBUG Sys - select Code as value,Text as text from sys_code where  CodeType =  'SupplyType'
2019-02-11 10:52:34,489 [52764] DEBUG Servicemms_direct - 获取动态列表
2019-02-11 10:52:34,489 [52764] DEBUG Mms - select top 20 
        A.*, B.ProjectName, C.MaterialTypeName,D.MerchantsName as SupplierName,E.MerchantsName as PickUnitName
     from 
        mms_direct A
        left join mms_project       B on B.ProjectCode      = A.ProjectCode
        left join mms_materialType  C on C.MaterialType     = A.MaterialType
        left join mms_merchants     D on D.MerchantsCode    = A.SupplierCode
        left join mms_merchants     E on E.MerchantsCode    = A.PickUnit
     where  A.ProjectCode =  '201306030001' order by A.BillNo
2019-02-11 10:52:34,536 [52764] DEBUG Mms - select count(*) from ( select 
        A.*, B.ProjectName, C.MaterialTypeName,D.MerchantsName as SupplierName,E.MerchantsName as PickUnitName
     from 
        mms_direct A
        left join mms_project       B on B.ProjectCode      = A.ProjectCode
        left join mms_materialType  C on C.MaterialType     = A.MaterialType
        left join mms_merchants     D on D.MerchantsCode    = A.SupplierCode
        left join mms_merchants     E on E.MerchantsCode    = A.PickUnit
     where  A.ProjectCode =  '201306030001' ) tb_temp
2019-02-11 10:52:37,868 [52764] DEBUG Sys - 
select 1
from sys_roleMenuMap A
left join sys_userRoleMap B on B.RoleCode = A.RoleCode
left join sys_menu C on C.MenuCode = A.MenuCode
where B.UserCode = 'admin'
and C.URL in ('/Mms/receive/Index','/Mms/receive')
2019-02-11 10:52:37,875 [52764] DEBUG Servicemms_warehouse - 获取动态列表
2019-02-11 10:52:37,875 [52764] DEBUG Mms - select WarehouseCode as value,WarehouseName as text from mms_warehouse where  ProjectCode =  '201306030001'
2019-02-11 10:52:37,876 [52764] DEBUG Servicesys_code - 获取动态列表
2019-02-11 10:52:37,876 [52764] DEBUG Sys - select Code as value,Text as text from sys_code where  CodeType =  'SupplyType'
2019-02-11 10:52:38,165 [52900] DEBUG Servicemms_receive - 获取动态列表
2019-02-11 10:52:38,165 [52900] DEBUG Mms - select top 20 
        A.*, B.ProjectName, C.MaterialTypeName, D.WarehouseName as WarehouseName, E.MerchantsName AS SupplierName
     from 
        mms_receive A
        left join mms_project       B on B.ProjectCode      = A.ProjectCode
        left join mms_materialType  C on C.MaterialType = A.MaterialType
        left join mms_warehouse         D on D.WarehouseCode       = A.WarehouseCode
        left join mms_merchants     E on E.MerchantsCode    = A.SupplierCode
     where  A.ProjectCode =  '201306030001' order by A.BillNo
2019-02-11 10:52:38,182 [52900] DEBUG Mms - select count(*) from ( select 
        A.*, B.ProjectName, C.MaterialTypeName, D.WarehouseName as WarehouseName, E.MerchantsName AS SupplierName
     from 
        mms_receive A
        left join mms_project       B on B.ProjectCode      = A.ProjectCode
        left join mms_materialType  C on C.MaterialType = A.MaterialType
        left join mms_warehouse         D on D.WarehouseCode       = A.WarehouseCode
        left join mms_merchants     E on E.MerchantsCode    = A.SupplierCode
     where  A.ProjectCode =  '201306030001' ) tb_temp
2019-02-11 10:52:45,619 [52872] DEBUG Sys - 
select 1
from sys_roleMenuMap A
left join sys_userRoleMap B on B.RoleCode = A.RoleCode
left join sys_menu C on C.MenuCode = A.MenuCode
where B.UserCode = 'admin'
and C.URL in ('/Mms/send/Index','/Mms/send')
2019-02-11 10:52:45,625 [52872] DEBUG Servicemms_warehouse - 获取动态列表
2019-02-11 10:52:45,625 [52872] DEBUG Mms - select WarehouseCode as value,WarehouseName as text from mms_warehouse where  ProjectCode =  '201306030001'
2019-02-11 10:52:45,626 [52872] DEBUG Servicesys_code - 获取动态列表
2019-02-11 10:52:45,626 [52872] DEBUG Sys - select Code as value,Text as text from sys_code where  CodeType =  'Pricing'
2019-02-11 10:52:45,627 [52872] DEBUG Servicesys_code - 获取动态列表
2019-02-11 10:52:45,627 [52872] DEBUG Sys - select Code as value,Text as text from sys_code where  CodeType =  'MaterialUse'
2019-02-11 10:52:46,071 [52872] DEBUG Sys - select MenuCode from sys_menu where URL = '/mms/send'
2019-02-11 10:52:46,073 [52872] DEBUG Sys - 
select *
from sys_roleMenuColumnMap 
where MenuCode = '1001'
and RoleCode in (
select RoleCode
from sys_userRoleMap
where userCode = 'admin'
union
select A.RoleCode
from sys_organizeRoleMap A
inner join sys_userOrganizeMap B on B.OrganizeCode = A.OrganizeCode
where B.UserCode = 'admin'
)
2019-02-11 10:52:46,109 [52872] DEBUG Sys - select MenuCode from sys_menu where URL = '/mms/send'
2019-02-11 10:52:46,109 [52872] DEBUG Sys - 
select A.*
from sys_button A
inner join sys_roleMenuButtonMap B on B.MenuCode = '1001' and B.ButtonCode = A.ButtonCode
where RoleCode in (
select RoleCode
from sys_userRoleMap
where userCode = 'admin'
union
select A.RoleCode
from sys_organizeRoleMap A
inner join sys_userOrganizeMap B on B.OrganizeCode = A.OrganizeCode
where B.UserCode = 'admin'
)
order by ButtonSeq
2019-02-11 10:52:46,394 [52872] DEBUG Servicemms_send - 获取动态列表
2019-02-11 10:52:46,395 [52872] DEBUG Mms - select top 20 
        A.*, B.ProjectName, C.MaterialTypeName, D.WarehouseName,E.MerchantsName as PickUnitName
     from 
        mms_send A
        left join mms_project       B on B.ProjectCode      = A.ProjectCode
        left join mms_materialType  C on C.MaterialType = A.MaterialType
        left join mms_warehouse         D on D.WarehouseCode       = A.WarehouseCode
        left join mms_merchants E on E.MerchantsCode=A.PickUnit
     where  A.ProjectCode =  '201306030001' order by A.BillNo
2019-02-11 10:52:46,415 [52872] DEBUG Mms - select count(*) from ( select 
        A.*, B.ProjectName, C.MaterialTypeName, D.WarehouseName,E.MerchantsName as PickUnitName
     from 
        mms_send A
        left join mms_project       B on B.ProjectCode      = A.ProjectCode
        left join mms_materialType  C on C.MaterialType = A.MaterialType
        left join mms_warehouse         D on D.WarehouseCode       = A.WarehouseCode
        left join mms_merchants E on E.MerchantsCode=A.PickUnit
     where  A.ProjectCode =  '201306030001' ) tb_temp
2019-02-11 10:52:56,174 [52872] DEBUG Sys - 
select 1
from sys_roleMenuMap A
left join sys_userRoleMap B on B.RoleCode = A.RoleCode
left join sys_menu C on C.MenuCode = A.MenuCode
where B.UserCode = 'admin'
and C.URL in ('/Mms/send/Index','/Mms/send')
2019-02-11 10:52:56,176 [52872] DEBUG Servicemms_warehouse - 获取动态列表
2019-02-11 10:52:56,176 [52872] DEBUG Mms - select WarehouseCode as value,WarehouseName as text from mms_warehouse where  ProjectCode =  '201306030001'
2019-02-11 10:52:56,176 [52872] DEBUG Servicesys_code - 获取动态列表
2019-02-11 10:52:56,176 [52872] DEBUG Sys - select Code as value,Text as text from sys_code where  CodeType =  'Pricing'
2019-02-11 10:52:56,176 [52872] DEBUG Servicesys_code - 获取动态列表
2019-02-11 10:52:56,176 [52872] DEBUG Sys - select Code as value,Text as text from sys_code where  CodeType =  'MaterialUse'
2019-02-11 10:52:56,188 [52872] DEBUG Sys - select MenuCode from sys_menu where URL = '/mms/send'
2019-02-11 10:52:56,189 [52872] DEBUG Sys - 
select *
from sys_roleMenuColumnMap 
where MenuCode = '1001'
and RoleCode in (
select RoleCode
from sys_userRoleMap
where userCode = 'admin'
union
select A.RoleCode
from sys_organizeRoleMap A
inner join sys_userOrganizeMap B on B.OrganizeCode = A.OrganizeCode
where B.UserCode = 'admin'
)
2019-02-11 10:52:56,190 [52872] DEBUG Sys - select MenuCode from sys_menu where URL = '/mms/send'
2019-02-11 10:52:56,190 [52872] DEBUG Sys - 
select A.*
from sys_button A
inner join sys_roleMenuButtonMap B on B.MenuCode = '1001' and B.ButtonCode = A.ButtonCode
where RoleCode in (
select RoleCode
from sys_userRoleMap
where userCode = 'admin'
union
select A.RoleCode
from sys_organizeRoleMap A
inner join sys_userOrganizeMap B on B.OrganizeCode = A.OrganizeCode
where B.UserCode = 'admin'
)
order by ButtonSeq
2019-02-11 10:52:56,420 [52872] DEBUG Servicemms_send - 获取动态列表
2019-02-11 10:52:56,420 [52872] DEBUG Mms - select top 20 
        A.*, B.ProjectName, C.MaterialTypeName, D.WarehouseName,E.MerchantsName as PickUnitName
     from 
        mms_send A
        left join mms_project       B on B.ProjectCode      = A.ProjectCode
        left join mms_materialType  C on C.MaterialType = A.MaterialType
        left join mms_warehouse         D on D.WarehouseCode       = A.WarehouseCode
        left join mms_merchants E on E.MerchantsCode=A.PickUnit
     where  A.ProjectCode =  '201306030001' order by A.BillNo
2019-02-11 10:52:56,421 [52872] DEBUG Mms - select count(*) from ( select 
        A.*, B.ProjectName, C.MaterialTypeName, D.WarehouseName,E.MerchantsName as PickUnitName
     from 
        mms_send A
        left join mms_project       B on B.ProjectCode      = A.ProjectCode
        left join mms_materialType  C on C.MaterialType = A.MaterialType
        left join mms_warehouse         D on D.WarehouseCode       = A.WarehouseCode
        left join mms_merchants E on E.MerchantsCode=A.PickUnit
     where  A.ProjectCode =  '201306030001' ) tb_temp
2019-02-11 10:52:57,288 [52872] DEBUG Sys - 
select 1
from sys_roleMenuMap A
left join sys_userRoleMap B on B.RoleCode = A.RoleCode
left join sys_menu C on C.MenuCode = A.MenuCode
where B.UserCode = 'admin'
and C.URL in ('/Mms/direct/Index','/Mms/direct')
2019-02-11 10:52:57,290 [52872] DEBUG Servicemms_warehouse - 获取动态列表
2019-02-11 10:52:57,290 [52872] DEBUG Mms - select WarehouseCode as value,WarehouseName as text from mms_warehouse where  ProjectCode =  '201306030001'
2019-02-11 10:52:57,290 [52872] DEBUG Servicesys_code - 获取动态列表
2019-02-11 10:52:57,290 [52872] DEBUG Sys - select Code as value,Text as text from sys_code where  CodeType =  'SupplyType'
2019-02-11 10:52:57,515 [52872] DEBUG Servicemms_direct - 获取动态列表
2019-02-11 10:52:57,515 [52872] DEBUG Mms - select top 20 
        A.*, B.ProjectName, C.MaterialTypeName,D.MerchantsName as SupplierName,E.MerchantsName as PickUnitName
     from 
        mms_direct A
        left join mms_project       B on B.ProjectCode      = A.ProjectCode
        left join mms_materialType  C on C.MaterialType     = A.MaterialType
        left join mms_merchants     D on D.MerchantsCode    = A.SupplierCode
        left join mms_merchants     E on E.MerchantsCode    = A.PickUnit
     where  A.ProjectCode =  '201306030001' order by A.BillNo
2019-02-11 10:52:57,516 [52872] DEBUG Mms - select count(*) from ( select 
        A.*, B.ProjectName, C.MaterialTypeName,D.MerchantsName as SupplierName,E.MerchantsName as PickUnitName
     from 
        mms_direct A
        left join mms_project       B on B.ProjectCode      = A.ProjectCode
        left join mms_materialType  C on C.MaterialType     = A.MaterialType
        left join mms_merchants     D on D.MerchantsCode    = A.SupplierCode
        left join mms_merchants     E on E.MerchantsCode    = A.PickUnit
     where  A.ProjectCode =  '201306030001' ) tb_temp
2019-02-11 10:52:58,334 [52764] DEBUG Sys - 
select 1
from sys_roleMenuMap A
left join sys_userRoleMap B on B.RoleCode = A.RoleCode
left join sys_menu C on C.MenuCode = A.MenuCode
where B.UserCode = 'admin'
and C.URL in ('/Mms/refund/Index','/Mms/refund')
2019-02-11 10:52:58,341 [52764] DEBUG Servicemms_warehouse - 获取动态列表
2019-02-11 10:52:58,341 [52764] DEBUG Mms - select WarehouseCode as value,WarehouseName as text from mms_warehouse where  ProjectCode =  '201306030001'
2019-02-11 10:52:59,067 [52900] DEBUG Servicemms_refund - 获取动态列表
2019-02-11 10:52:59,067 [52900] DEBUG Mms - select top 20 
        A.*, B.ProjectName, C.MaterialTypeName, D.WarehouseName,E.MerchantsName as RefundUnitName
     from 
        mms_refund A
        left join mms_project       B on B.ProjectCode      = A.ProjectCode
        left join mms_materialType  C on C.MaterialType = A.MaterialType
        left join mms_warehouse         D on D.WarehouseCode       = A.WarehouseCode
        left join mms_merchants     E on E.MerchantsCode    = A.RefundUnit
     where  A.ProjectCode =  '201306030001' order by A.BillNo
2019-02-11 10:52:59,090 [52900] DEBUG Mms - select count(*) from ( select 
        A.*, B.ProjectName, C.MaterialTypeName, D.WarehouseName,E.MerchantsName as RefundUnitName
     from 
        mms_refund A
        left join mms_project       B on B.ProjectCode      = A.ProjectCode
        left join mms_materialType  C on C.MaterialType = A.MaterialType
        left join mms_warehouse         D on D.WarehouseCode       = A.WarehouseCode
        left join mms_merchants     E on E.MerchantsCode    = A.RefundUnit
     where  A.ProjectCode =  '201306030001' ) tb_temp
2019-02-11 10:53:01,387 [52872] DEBUG Sys - 
select 1
from sys_roleMenuMap A
left join sys_userRoleMap B on B.RoleCode = A.RoleCode
left join sys_menu C on C.MenuCode = A.MenuCode
where B.UserCode = 'admin'
and C.URL in ('/Mms/report/balanceaccount')
2019-02-11 10:53:01,393 [52872] DEBUG Servicemms_warehouse - 获取动态列表
2019-02-11 10:53:01,393 [52872] DEBUG Mms - select WarehouseCode as value,WarehouseName as text from mms_warehouse where  ProjectCode =  '201306030001'
2019-02-11 10:53:01,393 [52872] DEBUG Servicemms_buildPart - 获取动态列表
2019-02-11 10:53:01,393 [52872] DEBUG Mms - select BuildPartCode as value,BuildPartName as text from mms_buildPart where  ProjectCode =  '201306030001'
2019-02-11 10:53:01,535 [52764] DEBUG Mms - 
Select PickUnitName
From (
--收料单
Select mms_receiveDetail.BillNo As SrcBillNo,mms_receiveDetail.RowId As SrcRowId,'receive' As SrcBillType,mms_receive.ReceiveDate As TakeDate,
	mms_receive.SupplyType As SupplyType,'' As PickUnitName, mms_receiveDetail.MaterialCode,mms_material.MaterialName,mms_material.Model,mms_receiveDetail.Unit,
	mms_receiveDetail.UnitPrice,mms_receiveDetail.Num,mms_receiveDetail.Money,mms_material.MaterialType,mms_materialType.Type As MaterialKind
From mms_receive
Left join mms_receiveDetail On mms_receiveDetail.BillNo=mms_receive.BillNo
Left join mms_material On mms_material.MaterialCode=mms_receiveDetail.MaterialCode
Left join mms_materialType On mms_materialType.MaterialType=mms_material.MaterialType
Where mms_receive.ApproveState='passed'  And  mms_receive.ProjectCode='201306030001'

Union
--退货单
Select mms_returnDetail.BillNo As SrcBillNo,mms_returnDetail.RowId As SrcRowId,'return' As SrcBillType,mms_return.ReturnDate As TakeDate,
	'其他' As SupplyType,'' As PickUnitName, mms_returnDetail.MaterialCode,mms_material.MaterialName,mms_material.Model,mms_returnDetail.Unit,
	mms_returnDetail.UnitPrice,-mms_returnDetail.Num,-mms_returnDetail.Money,mms_material.MaterialType,mms_materialType.Type As MaterialKind
From mms_return
Left join mms_returnDetail On mms_returnDetail.BillNo=mms_return.BillNo
Left join mms_material On mms_material.MaterialCode=mms_returnDetail.MaterialCode
Left join mms_materialType On mms_materialType.MaterialType=mms_material.MaterialType
Where mms_return.ApproveState='passed'  And  mms_return.ProjectCode='201306030001'

Union
--直入直出
Select mms_directDetail.BillNo As SrcBillNo,mms_directDetail.RowId As SrcRowId,'direct' As SrcBillType,mms_direct.ArriveDate As TakeDate,
	mms_direct.SupplyType As SupplyType,mms_merchants.MerchantsName As PickUnitName, mms_directDetail.MaterialCode,mms_material.MaterialName,mms_material.Model,mms_directDetail.Unit,
	mms_directDetail.UnitPrice,mms_directDetail.Num,mms_directDetail.Money,mms_material.MaterialType,mms_materialType.Type As MaterialKind
From mms_direct
Left join mms_directDetail On mms_directDetail.BillNo=mms_direct.BillNo
Left join mms_material On mms_material.MaterialCode=mms_directDetail.MaterialCode
Left join mms_materialType On mms_materialType.MaterialType=mms_material.MaterialType
Left join mms_merchants On mms_merchants.MerchantsCode=mms_direct.PickUnit
Where mms_direct.ApproveState='passed'  And  mms_direct.ProjectCode='201306030001'

Union
--租赁进场
Select mms_rentinDetail.BillNo As SrcBillNo,mms_rentinDetail.RowId As SrcRowId,'rentin' As SrcBillType,mms_rentin.RentInDate As TakeDate,
	'租赁进场' As SupplyType,'租赁进场' As PickUnitName, mms_rentinDetail.MaterialCode,mms_material.MaterialName,mms_material.Model,mms_rentinDetail.Unit,
	mms_rentinDetail.UnitPrice,mms_rentinDetail.Num,'0' As Money,mms_material.MaterialType,mms_materialType.Type As MaterialKind
From mms_rentin
Left join mms_rentinDetail On mms_rentinDetail.BillNo=mms_rentin.BillNo
Left join mms_material On mms_material.MaterialCode=mms_rentinDetail.MaterialCode
Left join mms_materialType On mms_materialType.MaterialType=mms_material.MaterialType
Left join mms_merchants On mms_merchants.MerchantsCode=mms_rentinDetail.UseUnit
Where mms_rentin.ApproveState='passed'  And  mms_rentin.ProjectCode='201306030001'

Union
--库存调整
Select mms_stockAdjustDetail.BillNo As SrcBillNo,mms_stockAdjustDetail.RowId As SrcRowId,'adjust' As SrcBillType,mms_stockAdjust.EffectDate As TakeDate,
	'其他' As SupplyType,'' As PickUnitName, mms_stockAdjustDetail.MaterialCode,mms_material.MaterialName,mms_material.Model,mms_stockAdjustDetail.Unit,
	mms_stockAdjustDetail.UnitPrice,mms_stockAdjustDetail.Num,mms_stockAdjustDetail.Money,mms_material.MaterialType,mms_materialType.Type As MaterialKind
From mms_stockAdjust
Left join mms_stockAdjustDetail On mms_stockAdjustDetail.BillNo=mms_stockAdjust.BillNo
Left join mms_material On mms_material.MaterialCode=mms_stockAdjustDetail.MaterialCode
Left join mms_materialType On mms_materialType.MaterialType=mms_material.MaterialType
Where mms_stockAdjust.ApproveState='passed'  And  mms_stockAdjust.ProjectCode='201306030001'

Union
--发料
Select mms_sendDetail.BillNo As SrcBillNo,mms_sendDetail.RowId As SrcRowId,'send' As SrcBillType,mms_send.SendDate As TakeDate,
	'' As SupplyType, mms_merchants.MerchantsName As PickUnitName,mms_sendDetail.MaterialCode,mms_material.MaterialName,mms_material.Model,mms_sendDetail.Unit,
	mms_sendDetail.UnitPrice,mms_sendDetail.Num,mms_sendDetail.Money,mms_material.MaterialType,mms_materialType.Type As MaterialKind
From mms_send
Left join mms_sendDetail On mms_sendDetail.BillNo=mms_send.BillNo
Left join mms_material On mms_material.MaterialCode=mms_sendDetail.MaterialCode
Left join mms_materialType On mms_materialType.MaterialType=mms_material.MaterialType
Left join mms_merchants On mms_merchants.MerchantsCode=mms_send.PickUnit
Where mms_send.ApproveState='passed'  And  mms_send.ProjectCode='201306030001'

Union
--退库
Select mms_refundDetail.BillNo As SrcBillNo,mms_refundDetail.RowId As SrcRowId,'refund' As SrcBillType,mms_refund.RefundDate As TakeDate,
	'' As SupplyType, mms_merchants.MerchantsName As PickUnitName,mms_refundDetail.MaterialCode,mms_material.MaterialName,mms_material.Model,mms_refundDetail.Unit,
	mms_refundDetail.UnitPrice,-mms_refundDetail.Num,-mms_refundDetail.Money,mms_material.MaterialType,mms_materialType.Type As MaterialKind
From mms_refund
Left join mms_refundDetail On mms_refundDetail.BillNo=mms_refund.BillNo
Left join mms_material On mms_material.MaterialCode=mms_refundDetail.MaterialCode
Left join mms_materialType On mms_materialType.MaterialType=mms_material.MaterialType
Left join mms_merchants On mms_merchants.MerchantsCode=mms_refund.RefundUnit
Where mms_refund.ApproveState='passed'  And  mms_refund.ProjectCode='201306030001'

Union
--调拨
Select mms_transferDetail.BillNo As SrcBillNo,mms_transferDetail.RowId As SrcRowId,'transfer' As SrcBillType,mms_transfer.TransferDate As TakeDate,
	'' As SupplyType, mms_merchants.MerchantsName As PickUnitName,mms_transferDetail.MaterialCode,mms_material.MaterialName,mms_material.Model,mms_transferDetail.Unit,
	mms_transferDetail.UnitPrice,mms_transferDetail.Num,mms_transferDetail.Money,mms_material.MaterialType,mms_materialType.Type As MaterialKind
From mms_transfer
Left join mms_transferDetail On mms_transferDetail.BillNo=mms_transfer.BillNo
Left join mms_material On mms_material.MaterialCode=mms_transferDetail.MaterialCode
Left join mms_materialType On mms_materialType.MaterialType=mms_material.MaterialType
Left join mms_merchants On mms_merchants.MerchantsCode=mms_transfer.ReceiveUnit
Where mms_transfer.ApproveState='passed' And  mms_transfer.ProjectCode='201306030001'

Union
--报损
Select mms_lossReportDetail.BillNo As SrcBillNo,mms_lossReportDetail.RowId As SrcRowId,'lossReport' As SrcBillType,mms_lossReport.LossReportDate As TakeDate,
	'' As SupplyType, '其他' As PickUnitName,mms_lossReportDetail.MaterialCode,mms_material.MaterialName,mms_material.Model,mms_lossReportDetail.Unit,
	mms_lossReportDetail.UnitPrice,mms_lossReportDetail.Num,mms_lossReportDetail.Money,mms_material.MaterialType,mms_materialType.Type As MaterialKind
From mms_lossReport
Left join mms_lossReportDetail On mms_lossReportDetail.BillNo=mms_lossReport.BillNo
Left join mms_material On mms_material.MaterialCode=mms_lossReportDetail.MaterialCode
Left join mms_materialType On mms_materialType.MaterialType=mms_material.MaterialType
Where mms_lossReport.ApproveState='passed'  And  mms_lossReport.ProjectCode='201306030001'
) as t
Where PickUnitName<>'' and PickUnitName<>'其他' and PickUnitName<>'租赁进场'
group by PickUnitName
                
2019-02-11 10:53:01,652 [52764] DEBUG Mms - 
Select MaterialCode,MaterialName,Model,MaterialKind,MaterialType,Unit
    ,ISNULL(Sum(CASE WHEN SupplyType<>'' then Money else 0 end),0) as ReceiveMoney --合计
    ,ISNULL(Sum(CASE WHEN SupplyType='082' then Money else 0 end),0) as StockSelfMoney --自采
    ,ISNULL(Sum(CASE WHEN SupplyType='083' then Money else 0 end),0) as OwnerSupplyMoney --甲供
    ,ISNULL(Sum(CASE WHEN SupplyType='084' then Money else 0 end),0) as CallInMoney --调入
    ,ISNULL(Sum(CASE WHEN SupplyType='其他' then Money else 0 end),0) as ReceiveOtherMoney --其他

    ,ISNULL(Sum(CASE WHEN SupplyType<>'' then Num else 0 end),0) as ReceiveNum --合计
    ,ISNULL(Sum(CASE WHEN SupplyType='082' then Num else 0 end),0) as StockSelfNum --自采
    ,ISNULL(Sum(CASE WHEN SupplyType='083' then Num else 0 end),0) as OwnerSupplyNum --甲供
    ,ISNULL(Sum(CASE WHEN SupplyType='084' then Num else 0 end),0) as CallInNum --调入
	,ISNULL(Sum(CASE WHEN SupplyType='租赁进场' then Num else 0 end),0) as ReceiveRentInNum --租赁进场
    ,ISNULL(Sum(CASE WHEN SupplyType='其他' then Num else 0 end),0) as ReceiveOtherNum --其他

    ,ISNULL(Sum(CASE WHEN PickUnitName<>'' then Money else 0 end),0) as SendMoney --合计
    ,ISNULL(Sum(CASE WHEN PickUnitName<>'' then Num else 0 end),0) as SendNum --合计
     ,ISNULL(Sum(CASE WHEN PickUnitName='北京士兴钢结构有限公司' then Num else 0 end),0) as PickUnitNum0 ,ISNULL(Sum(CASE WHEN PickUnitName='北京士兴钢结构有限公司' then Money else 0 end),0) as PickUnitMoney0 ,ISNULL(Sum(CASE WHEN PickUnitName='河北天强建筑工程有限公司' then Num else 0 end),0) as PickUnitNum1 ,ISNULL(Sum(CASE WHEN PickUnitName='河北天强建筑工程有限公司' then Money else 0 end),0) as PickUnitMoney1                                                             --领料人生成的列
    ,ISNULL(Sum(CASE WHEN PickUnitName='租赁进场' then Num else 0 end),0) as SendRentInNum --租赁进场
    ,ISNULL(Sum(CASE WHEN PickUnitName='其他' then Money else 0 end),0) as SendOtherMoney --其他
    ,ISNULL(Sum(CASE WHEN PickUnitName='其他' then Num else 0 end),0) as SendOtherNum --其他

    ,ISNULL(Sum(CASE WHEN SupplyType<>'' then Num else -Num end),0) as TotalNum --合计
    ,ISNULL(Sum(CASE WHEN SupplyType<>'' then Money else -Money end),0) as TotalMoney --合计

From (
--收料单
Select mms_receiveDetail.BillNo As SrcBillNo,mms_receiveDetail.RowId As SrcRowId,'receive' As SrcBillType,mms_receive.ReceiveDate As TakeDate,
	mms_receive.SupplyType As SupplyType,'' As PickUnitName, mms_receiveDetail.MaterialCode,mms_material.MaterialName,mms_material.Model,mms_receiveDetail.Unit,
	mms_receiveDetail.UnitPrice,mms_receiveDetail.Num,mms_receiveDetail.Money,mms_material.MaterialType,mms_materialType.Type As MaterialKind
From mms_receive
Left join mms_receiveDetail On mms_receiveDetail.BillNo=mms_receive.BillNo
Left join mms_material On mms_material.MaterialCode=mms_receiveDetail.MaterialCode
Left join mms_materialType On mms_materialType.MaterialType=mms_material.MaterialType
Where mms_receive.ApproveState='passed'  And  mms_receive.ProjectCode='201306030001'

Union
--退货单
Select mms_returnDetail.BillNo As SrcBillNo,mms_returnDetail.RowId As SrcRowId,'return' As SrcBillType,mms_return.ReturnDate As TakeDate,
	'其他' As SupplyType,'' As PickUnitName, mms_returnDetail.MaterialCode,mms_material.MaterialName,mms_material.Model,mms_returnDetail.Unit,
	mms_returnDetail.UnitPrice,-mms_returnDetail.Num,-mms_returnDetail.Money,mms_material.MaterialType,mms_materialType.Type As MaterialKind
From mms_return
Left join mms_returnDetail On mms_returnDetail.BillNo=mms_return.BillNo
Left join mms_material On mms_material.MaterialCode=mms_returnDetail.MaterialCode
Left join mms_materialType On mms_materialType.MaterialType=mms_material.MaterialType
Where mms_return.ApproveState='passed'  And  mms_return.ProjectCode='201306030001'

Union
--直入直出
Select mms_directDetail.BillNo As SrcBillNo,mms_directDetail.RowId As SrcRowId,'direct' As SrcBillType,mms_direct.ArriveDate As TakeDate,
	mms_direct.SupplyType As SupplyType,mms_merchants.MerchantsName As PickUnitName, mms_directDetail.MaterialCode,mms_material.MaterialName,mms_material.Model,mms_directDetail.Unit,
	mms_directDetail.UnitPrice,mms_directDetail.Num,mms_directDetail.Money,mms_material.MaterialType,mms_materialType.Type As MaterialKind
From mms_direct
Left join mms_directDetail On mms_directDetail.BillNo=mms_direct.BillNo
Left join mms_material On mms_material.MaterialCode=mms_directDetail.MaterialCode
Left join mms_materialType On mms_materialType.MaterialType=mms_material.MaterialType
Left join mms_merchants On mms_merchants.MerchantsCode=mms_direct.PickUnit
Where mms_direct.ApproveState='passed'  And  mms_direct.ProjectCode='201306030001'

Union
--租赁进场
Select mms_rentinDetail.BillNo As SrcBillNo,mms_rentinDetail.RowId As SrcRowId,'rentin' As SrcBillType,mms_rentin.RentInDate As TakeDate,
	'租赁进场' As SupplyType,'租赁进场' As PickUnitName, mms_rentinDetail.MaterialCode,mms_material.MaterialName,mms_material.Model,mms_rentinDetail.Unit,
	mms_rentinDetail.UnitPrice,mms_rentinDetail.Num,'0' As Money,mms_material.MaterialType,mms_materialType.Type As MaterialKind
From mms_rentin
Left join mms_rentinDetail On mms_rentinDetail.BillNo=mms_rentin.BillNo
Left join mms_material On mms_material.MaterialCode=mms_rentinDetail.MaterialCode
Left join mms_materialType On mms_materialType.MaterialType=mms_material.MaterialType
Left join mms_merchants On mms_merchants.MerchantsCode=mms_rentinDetail.UseUnit
Where mms_rentin.ApproveState='passed'  And  mms_rentin.ProjectCode='201306030001'

Union
--库存调整
Select mms_stockAdjustDetail.BillNo As SrcBillNo,mms_stockAdjustDetail.RowId As SrcRowId,'adjust' As SrcBillType,mms_stockAdjust.EffectDate As TakeDate,
	'其他' As SupplyType,'' As PickUnitName, mms_stockAdjustDetail.MaterialCode,mms_material.MaterialName,mms_material.Model,mms_stockAdjustDetail.Unit,
	mms_stockAdjustDetail.UnitPrice,mms_stockAdjustDetail.Num,mms_stockAdjustDetail.Money,mms_material.MaterialType,mms_materialType.Type As MaterialKind
From mms_stockAdjust
Left join mms_stockAdjustDetail On mms_stockAdjustDetail.BillNo=mms_stockAdjust.BillNo
Left join mms_material On mms_material.MaterialCode=mms_stockAdjustDetail.MaterialCode
Left join mms_materialType On mms_materialType.MaterialType=mms_material.MaterialType
Where mms_stockAdjust.ApproveState='passed'  And  mms_stockAdjust.ProjectCode='201306030001'

Union
--发料
Select mms_sendDetail.BillNo As SrcBillNo,mms_sendDetail.RowId As SrcRowId,'send' As SrcBillType,mms_send.SendDate As TakeDate,
	'' As SupplyType, mms_merchants.MerchantsName As PickUnitName,mms_sendDetail.MaterialCode,mms_material.MaterialName,mms_material.Model,mms_sendDetail.Unit,
	mms_sendDetail.UnitPrice,mms_sendDetail.Num,mms_sendDetail.Money,mms_material.MaterialType,mms_materialType.Type As MaterialKind
From mms_send
Left join mms_sendDetail On mms_sendDetail.BillNo=mms_send.BillNo
Left join mms_material On mms_material.MaterialCode=mms_sendDetail.MaterialCode
Left join mms_materialType On mms_materialType.MaterialType=mms_material.MaterialType
Left join mms_merchants On mms_merchants.MerchantsCode=mms_send.PickUnit
Where mms_send.ApproveState='passed'  And  mms_send.ProjectCode='201306030001'

Union
--退库
Select mms_refundDetail.BillNo As SrcBillNo,mms_refundDetail.RowId As SrcRowId,'refund' As SrcBillType,mms_refund.RefundDate As TakeDate,
	'' As SupplyType, mms_merchants.MerchantsName As PickUnitName,mms_refundDetail.MaterialCode,mms_material.MaterialName,mms_material.Model,mms_refundDetail.Unit,
	mms_refundDetail.UnitPrice,-mms_refundDetail.Num,-mms_refundDetail.Money,mms_material.MaterialType,mms_materialType.Type As MaterialKind
From mms_refund
Left join mms_refundDetail On mms_refundDetail.BillNo=mms_refund.BillNo
Left join mms_material On mms_material.MaterialCode=mms_refundDetail.MaterialCode
Left join mms_materialType On mms_materialType.MaterialType=mms_material.MaterialType
Left join mms_merchants On mms_merchants.MerchantsCode=mms_refund.RefundUnit
Where mms_refund.ApproveState='passed'  And  mms_refund.ProjectCode='201306030001'

Union
--调拨
Select mms_transferDetail.BillNo As SrcBillNo,mms_transferDetail.RowId As SrcRowId,'transfer' As SrcBillType,mms_transfer.TransferDate As TakeDate,
	'' As SupplyType, mms_merchants.MerchantsName As PickUnitName,mms_transferDetail.MaterialCode,mms_material.MaterialName,mms_material.Model,mms_transferDetail.Unit,
	mms_transferDetail.UnitPrice,mms_transferDetail.Num,mms_transferDetail.Money,mms_material.MaterialType,mms_materialType.Type As MaterialKind
From mms_transfer
Left join mms_transferDetail On mms_transferDetail.BillNo=mms_transfer.BillNo
Left join mms_material On mms_material.MaterialCode=mms_transferDetail.MaterialCode
Left join mms_materialType On mms_materialType.MaterialType=mms_material.MaterialType
Left join mms_merchants On mms_merchants.MerchantsCode=mms_transfer.ReceiveUnit
Where mms_transfer.ApproveState='passed' And  mms_transfer.ProjectCode='201306030001'

Union
--报损
Select mms_lossReportDetail.BillNo As SrcBillNo,mms_lossReportDetail.RowId As SrcRowId,'lossReport' As SrcBillType,mms_lossReport.LossReportDate As TakeDate,
	'' As SupplyType, '其他' As PickUnitName,mms_lossReportDetail.MaterialCode,mms_material.MaterialName,mms_material.Model,mms_lossReportDetail.Unit,
	mms_lossReportDetail.UnitPrice,mms_lossReportDetail.Num,mms_lossReportDetail.Money,mms_material.MaterialType,mms_materialType.Type As MaterialKind
From mms_lossReport
Left join mms_lossReportDetail On mms_lossReportDetail.BillNo=mms_lossReport.BillNo
Left join mms_material On mms_material.MaterialCode=mms_lossReportDetail.MaterialCode
Left join mms_materialType On mms_materialType.MaterialType=mms_material.MaterialType
Where mms_lossReport.ApproveState='passed'  And  mms_lossReport.ProjectCode='201306030001'
) as t
group by MaterialCode,MaterialName,Model,MaterialKind,MaterialType,Unit

2019-02-11 10:53:01,795 [52764] DEBUG Mms - 
Select mms_warehouseStockHistory.MaterialCode,sum(Num) As InitNum,sum(UnitPrice*Num) As InitMoney
From mms_warehouseStockHistory
Left join mms_warehouse on mms_warehouse.warehouseCode=mms_warehouseStockHistory.warehouseCode
Left join mms_material on mms_material.MaterialCode=mms_warehouseStockHistory.MaterialCode
Where 1=1  And  mms_warehouse.ProjectCode='201306030001'
group by mms_warehouseStockHistory.MaterialCode

2019-02-11 10:53:16,991 [52900] DEBUG Mms - 
Select PickUnitName
From (
--收料单
Select mms_receiveDetail.BillNo As SrcBillNo,mms_receiveDetail.RowId As SrcRowId,'receive' As SrcBillType,mms_receive.ReceiveDate As TakeDate,
	mms_receive.SupplyType As SupplyType,'' As PickUnitName, mms_receiveDetail.MaterialCode,mms_material.MaterialName,mms_material.Model,mms_receiveDetail.Unit,
	mms_receiveDetail.UnitPrice,mms_receiveDetail.Num,mms_receiveDetail.Money,mms_material.MaterialType,mms_materialType.Type As MaterialKind
From mms_receive
Left join mms_receiveDetail On mms_receiveDetail.BillNo=mms_receive.BillNo
Left join mms_material On mms_material.MaterialCode=mms_receiveDetail.MaterialCode
Left join mms_materialType On mms_materialType.MaterialType=mms_material.MaterialType
Where mms_receive.ApproveState='passed'  And  mms_receive.ProjectCode='201306030001' And 1=0

Union
--退货单
Select mms_returnDetail.BillNo As SrcBillNo,mms_returnDetail.RowId As SrcRowId,'return' As SrcBillType,mms_return.ReturnDate As TakeDate,
	'其他' As SupplyType,'' As PickUnitName, mms_returnDetail.MaterialCode,mms_material.MaterialName,mms_material.Model,mms_returnDetail.Unit,
	mms_returnDetail.UnitPrice,-mms_returnDetail.Num,-mms_returnDetail.Money,mms_material.MaterialType,mms_materialType.Type As MaterialKind
From mms_return
Left join mms_returnDetail On mms_returnDetail.BillNo=mms_return.BillNo
Left join mms_material On mms_material.MaterialCode=mms_returnDetail.MaterialCode
Left join mms_materialType On mms_materialType.MaterialType=mms_material.MaterialType
Where mms_return.ApproveState='passed'  And  mms_return.ProjectCode='201306030001' And 1=0

Union
--直入直出
Select mms_directDetail.BillNo As SrcBillNo,mms_directDetail.RowId As SrcRowId,'direct' As SrcBillType,mms_direct.ArriveDate As TakeDate,
	mms_direct.SupplyType As SupplyType,mms_merchants.MerchantsName As PickUnitName, mms_directDetail.MaterialCode,mms_material.MaterialName,mms_material.Model,mms_directDetail.Unit,
	mms_directDetail.UnitPrice,mms_directDetail.Num,mms_directDetail.Money,mms_material.MaterialType,mms_materialType.Type As MaterialKind
From mms_direct
Left join mms_directDetail On mms_directDetail.BillNo=mms_direct.BillNo
Left join mms_material On mms_material.MaterialCode=mms_directDetail.MaterialCode
Left join mms_materialType On mms_materialType.MaterialType=mms_material.MaterialType
Left join mms_merchants On mms_merchants.MerchantsCode=mms_direct.PickUnit
Where mms_direct.ApproveState='passed'  And  mms_direct.ProjectCode='201306030001' And mms_direct.BuildPartCode ='1'

Union
--租赁进场
Select mms_rentinDetail.BillNo As SrcBillNo,mms_rentinDetail.RowId As SrcRowId,'rentin' As SrcBillType,mms_rentin.RentInDate As TakeDate,
	'租赁进场' As SupplyType,'租赁进场' As PickUnitName, mms_rentinDetail.MaterialCode,mms_material.MaterialName,mms_material.Model,mms_rentinDetail.Unit,
	mms_rentinDetail.UnitPrice,mms_rentinDetail.Num,'0' As Money,mms_material.MaterialType,mms_materialType.Type As MaterialKind
From mms_rentin
Left join mms_rentinDetail On mms_rentinDetail.BillNo=mms_rentin.BillNo
Left join mms_material On mms_material.MaterialCode=mms_rentinDetail.MaterialCode
Left join mms_materialType On mms_materialType.MaterialType=mms_material.MaterialType
Left join mms_merchants On mms_merchants.MerchantsCode=mms_rentinDetail.UseUnit
Where mms_rentin.ApproveState='passed'  And  mms_rentin.ProjectCode='201306030001' And mms_rentin.BuildPartCode ='1'

Union
--库存调整
Select mms_stockAdjustDetail.BillNo As SrcBillNo,mms_stockAdjustDetail.RowId As SrcRowId,'adjust' As SrcBillType,mms_stockAdjust.EffectDate As TakeDate,
	'其他' As SupplyType,'' As PickUnitName, mms_stockAdjustDetail.MaterialCode,mms_material.MaterialName,mms_material.Model,mms_stockAdjustDetail.Unit,
	mms_stockAdjustDetail.UnitPrice,mms_stockAdjustDetail.Num,mms_stockAdjustDetail.Money,mms_material.MaterialType,mms_materialType.Type As MaterialKind
From mms_stockAdjust
Left join mms_stockAdjustDetail On mms_stockAdjustDetail.BillNo=mms_stockAdjust.BillNo
Left join mms_material On mms_material.MaterialCode=mms_stockAdjustDetail.MaterialCode
Left join mms_materialType On mms_materialType.MaterialType=mms_material.MaterialType
Where mms_stockAdjust.ApproveState='passed'  And  mms_stockAdjust.ProjectCode='201306030001' And 1=0

Union
--发料
Select mms_sendDetail.BillNo As SrcBillNo,mms_sendDetail.RowId As SrcRowId,'send' As SrcBillType,mms_send.SendDate As TakeDate,
	'' As SupplyType, mms_merchants.MerchantsName As PickUnitName,mms_sendDetail.MaterialCode,mms_material.MaterialName,mms_material.Model,mms_sendDetail.Unit,
	mms_sendDetail.UnitPrice,mms_sendDetail.Num,mms_sendDetail.Money,mms_material.MaterialType,mms_materialType.Type As MaterialKind
From mms_send
Left join mms_sendDetail On mms_sendDetail.BillNo=mms_send.BillNo
Left join mms_material On mms_material.MaterialCode=mms_sendDetail.MaterialCode
Left join mms_materialType On mms_materialType.MaterialType=mms_material.MaterialType
Left join mms_merchants On mms_merchants.MerchantsCode=mms_send.PickUnit
Where mms_send.ApproveState='passed'  And  mms_send.ProjectCode='201306030001' And mms_send.BuildPartCode ='1'

Union
--退库
Select mms_refundDetail.BillNo As SrcBillNo,mms_refundDetail.RowId As SrcRowId,'refund' As SrcBillType,mms_refund.RefundDate As TakeDate,
	'' As SupplyType, mms_merchants.MerchantsName As PickUnitName,mms_refundDetail.MaterialCode,mms_material.MaterialName,mms_material.Model,mms_refundDetail.Unit,
	mms_refundDetail.UnitPrice,-mms_refundDetail.Num,-mms_refundDetail.Money,mms_material.MaterialType,mms_materialType.Type As MaterialKind
From mms_refund
Left join mms_refundDetail On mms_refundDetail.BillNo=mms_refund.BillNo
Left join mms_material On mms_material.MaterialCode=mms_refundDetail.MaterialCode
Left join mms_materialType On mms_materialType.MaterialType=mms_material.MaterialType
Left join mms_merchants On mms_merchants.MerchantsCode=mms_refund.RefundUnit
Where mms_refund.ApproveState='passed'  And  mms_refund.ProjectCode='201306030001' And 1=0

Union
--调拨
Select mms_transferDetail.BillNo As SrcBillNo,mms_transferDetail.RowId As SrcRowId,'transfer' As SrcBillType,mms_transfer.TransferDate As TakeDate,
	'' As SupplyType, mms_merchants.MerchantsName As PickUnitName,mms_transferDetail.MaterialCode,mms_material.MaterialName,mms_material.Model,mms_transferDetail.Unit,
	mms_transferDetail.UnitPrice,mms_transferDetail.Num,mms_transferDetail.Money,mms_material.MaterialType,mms_materialType.Type As MaterialKind
From mms_transfer
Left join mms_transferDetail On mms_transferDetail.BillNo=mms_transfer.BillNo
Left join mms_material On mms_material.MaterialCode=mms_transferDetail.MaterialCode
Left join mms_materialType On mms_materialType.MaterialType=mms_material.MaterialType
Left join mms_merchants On mms_merchants.MerchantsCode=mms_transfer.ReceiveUnit
Where mms_transfer.ApproveState='passed' And  mms_transfer.ProjectCode='201306030001' And 1=0

Union
--报损
Select mms_lossReportDetail.BillNo As SrcBillNo,mms_lossReportDetail.RowId As SrcRowId,'lossReport' As SrcBillType,mms_lossReport.LossReportDate As TakeDate,
	'' As SupplyType, '其他' As PickUnitName,mms_lossReportDetail.MaterialCode,mms_material.MaterialName,mms_material.Model,mms_lossReportDetail.Unit,
	mms_lossReportDetail.UnitPrice,mms_lossReportDetail.Num,mms_lossReportDetail.Money,mms_material.MaterialType,mms_materialType.Type As MaterialKind
From mms_lossReport
Left join mms_lossReportDetail On mms_lossReportDetail.BillNo=mms_lossReport.BillNo
Left join mms_material On mms_material.MaterialCode=mms_lossReportDetail.MaterialCode
Left join mms_materialType On mms_materialType.MaterialType=mms_material.MaterialType
Where mms_lossReport.ApproveState='passed'  And  mms_lossReport.ProjectCode='201306030001' And 1=0
) as t
Where PickUnitName<>'' and PickUnitName<>'其他' and PickUnitName<>'租赁进场'
group by PickUnitName
                
2019-02-11 10:53:17,042 [52900] DEBUG Mms - 
Select MaterialCode,MaterialName,Model,MaterialKind,MaterialType,Unit
    ,ISNULL(Sum(CASE WHEN SupplyType<>'' then Money else 0 end),0) as ReceiveMoney --合计
    ,ISNULL(Sum(CASE WHEN SupplyType='082' then Money else 0 end),0) as StockSelfMoney --自采
    ,ISNULL(Sum(CASE WHEN SupplyType='083' then Money else 0 end),0) as OwnerSupplyMoney --甲供
    ,ISNULL(Sum(CASE WHEN SupplyType='084' then Money else 0 end),0) as CallInMoney --调入
    ,ISNULL(Sum(CASE WHEN SupplyType='其他' then Money else 0 end),0) as ReceiveOtherMoney --其他

    ,ISNULL(Sum(CASE WHEN SupplyType<>'' then Num else 0 end),0) as ReceiveNum --合计
    ,ISNULL(Sum(CASE WHEN SupplyType='082' then Num else 0 end),0) as StockSelfNum --自采
    ,ISNULL(Sum(CASE WHEN SupplyType='083' then Num else 0 end),0) as OwnerSupplyNum --甲供
    ,ISNULL(Sum(CASE WHEN SupplyType='084' then Num else 0 end),0) as CallInNum --调入
	,ISNULL(Sum(CASE WHEN SupplyType='租赁进场' then Num else 0 end),0) as ReceiveRentInNum --租赁进场
    ,ISNULL(Sum(CASE WHEN SupplyType='其他' then Num else 0 end),0) as ReceiveOtherNum --其他

    ,ISNULL(Sum(CASE WHEN PickUnitName<>'' then Money else 0 end),0) as SendMoney --合计
    ,ISNULL(Sum(CASE WHEN PickUnitName<>'' then Num else 0 end),0) as SendNum --合计
                                                                 --领料人生成的列
    ,ISNULL(Sum(CASE WHEN PickUnitName='租赁进场' then Num else 0 end),0) as SendRentInNum --租赁进场
    ,ISNULL(Sum(CASE WHEN PickUnitName='其他' then Money else 0 end),0) as SendOtherMoney --其他
    ,ISNULL(Sum(CASE WHEN PickUnitName='其他' then Num else 0 end),0) as SendOtherNum --其他

    ,ISNULL(Sum(CASE WHEN SupplyType<>'' then Num else -Num end),0) as TotalNum --合计
    ,ISNULL(Sum(CASE WHEN SupplyType<>'' then Money else -Money end),0) as TotalMoney --合计

From (
--收料单
Select mms_receiveDetail.BillNo As SrcBillNo,mms_receiveDetail.RowId As SrcRowId,'receive' As SrcBillType,mms_receive.ReceiveDate As TakeDate,
	mms_receive.SupplyType As SupplyType,'' As PickUnitName, mms_receiveDetail.MaterialCode,mms_material.MaterialName,mms_material.Model,mms_receiveDetail.Unit,
	mms_receiveDetail.UnitPrice,mms_receiveDetail.Num,mms_receiveDetail.Money,mms_material.MaterialType,mms_materialType.Type As MaterialKind
From mms_receive
Left join mms_receiveDetail On mms_receiveDetail.BillNo=mms_receive.BillNo
Left join mms_material On mms_material.MaterialCode=mms_receiveDetail.MaterialCode
Left join mms_materialType On mms_materialType.MaterialType=mms_material.MaterialType
Where mms_receive.ApproveState='passed'  And  mms_receive.ProjectCode='201306030001' And 1=0

Union
--退货单
Select mms_returnDetail.BillNo As SrcBillNo,mms_returnDetail.RowId As SrcRowId,'return' As SrcBillType,mms_return.ReturnDate As TakeDate,
	'其他' As SupplyType,'' As PickUnitName, mms_returnDetail.MaterialCode,mms_material.MaterialName,mms_material.Model,mms_returnDetail.Unit,
	mms_returnDetail.UnitPrice,-mms_returnDetail.Num,-mms_returnDetail.Money,mms_material.MaterialType,mms_materialType.Type As MaterialKind
From mms_return
Left join mms_returnDetail On mms_returnDetail.BillNo=mms_return.BillNo
Left join mms_material On mms_material.MaterialCode=mms_returnDetail.MaterialCode
Left join mms_materialType On mms_materialType.MaterialType=mms_material.MaterialType
Where mms_return.ApproveState='passed'  And  mms_return.ProjectCode='201306030001' And 1=0

Union
--直入直出
Select mms_directDetail.BillNo As SrcBillNo,mms_directDetail.RowId As SrcRowId,'direct' As SrcBillType,mms_direct.ArriveDate As TakeDate,
	mms_direct.SupplyType As SupplyType,mms_merchants.MerchantsName As PickUnitName, mms_directDetail.MaterialCode,mms_material.MaterialName,mms_material.Model,mms_directDetail.Unit,
	mms_directDetail.UnitPrice,mms_directDetail.Num,mms_directDetail.Money,mms_material.MaterialType,mms_materialType.Type As MaterialKind
From mms_direct
Left join mms_directDetail On mms_directDetail.BillNo=mms_direct.BillNo
Left join mms_material On mms_material.MaterialCode=mms_directDetail.MaterialCode
Left join mms_materialType On mms_materialType.MaterialType=mms_material.MaterialType
Left join mms_merchants On mms_merchants.MerchantsCode=mms_direct.PickUnit
Where mms_direct.ApproveState='passed'  And  mms_direct.ProjectCode='201306030001' And mms_direct.BuildPartCode ='1'

Union
--租赁进场
Select mms_rentinDetail.BillNo As SrcBillNo,mms_rentinDetail.RowId As SrcRowId,'rentin' As SrcBillType,mms_rentin.RentInDate As TakeDate,
	'租赁进场' As SupplyType,'租赁进场' As PickUnitName, mms_rentinDetail.MaterialCode,mms_material.MaterialName,mms_material.Model,mms_rentinDetail.Unit,
	mms_rentinDetail.UnitPrice,mms_rentinDetail.Num,'0' As Money,mms_material.MaterialType,mms_materialType.Type As MaterialKind
From mms_rentin
Left join mms_rentinDetail On mms_rentinDetail.BillNo=mms_rentin.BillNo
Left join mms_material On mms_material.MaterialCode=mms_rentinDetail.MaterialCode
Left join mms_materialType On mms_materialType.MaterialType=mms_material.MaterialType
Left join mms_merchants On mms_merchants.MerchantsCode=mms_rentinDetail.UseUnit
Where mms_rentin.ApproveState='passed'  And  mms_rentin.ProjectCode='201306030001' And mms_rentin.BuildPartCode ='1'

Union
--库存调整
Select mms_stockAdjustDetail.BillNo As SrcBillNo,mms_stockAdjustDetail.RowId As SrcRowId,'adjust' As SrcBillType,mms_stockAdjust.EffectDate As TakeDate,
	'其他' As SupplyType,'' As PickUnitName, mms_stockAdjustDetail.MaterialCode,mms_material.MaterialName,mms_material.Model,mms_stockAdjustDetail.Unit,
	mms_stockAdjustDetail.UnitPrice,mms_stockAdjustDetail.Num,mms_stockAdjustDetail.Money,mms_material.MaterialType,mms_materialType.Type As MaterialKind
From mms_stockAdjust
Left join mms_stockAdjustDetail On mms_stockAdjustDetail.BillNo=mms_stockAdjust.BillNo
Left join mms_material On mms_material.MaterialCode=mms_stockAdjustDetail.MaterialCode
Left join mms_materialType On mms_materialType.MaterialType=mms_material.MaterialType
Where mms_stockAdjust.ApproveState='passed'  And  mms_stockAdjust.ProjectCode='201306030001' And 1=0

Union
--发料
Select mms_sendDetail.BillNo As SrcBillNo,mms_sendDetail.RowId As SrcRowId,'send' As SrcBillType,mms_send.SendDate As TakeDate,
	'' As SupplyType, mms_merchants.MerchantsName As PickUnitName,mms_sendDetail.MaterialCode,mms_material.MaterialName,mms_material.Model,mms_sendDetail.Unit,
	mms_sendDetail.UnitPrice,mms_sendDetail.Num,mms_sendDetail.Money,mms_material.MaterialType,mms_materialType.Type As MaterialKind
From mms_send
Left join mms_sendDetail On mms_sendDetail.BillNo=mms_send.BillNo
Left join mms_material On mms_material.MaterialCode=mms_sendDetail.MaterialCode
Left join mms_materialType On mms_materialType.MaterialType=mms_material.MaterialType
Left join mms_merchants On mms_merchants.MerchantsCode=mms_send.PickUnit
Where mms_send.ApproveState='passed'  And  mms_send.ProjectCode='201306030001' And mms_send.BuildPartCode ='1'

Union
--退库
Select mms_refundDetail.BillNo As SrcBillNo,mms_refundDetail.RowId As SrcRowId,'refund' As SrcBillType,mms_refund.RefundDate As TakeDate,
	'' As SupplyType, mms_merchants.MerchantsName As PickUnitName,mms_refundDetail.MaterialCode,mms_material.MaterialName,mms_material.Model,mms_refundDetail.Unit,
	mms_refundDetail.UnitPrice,-mms_refundDetail.Num,-mms_refundDetail.Money,mms_material.MaterialType,mms_materialType.Type As MaterialKind
From mms_refund
Left join mms_refundDetail On mms_refundDetail.BillNo=mms_refund.BillNo
Left join mms_material On mms_material.MaterialCode=mms_refundDetail.MaterialCode
Left join mms_materialType On mms_materialType.MaterialType=mms_material.MaterialType
Left join mms_merchants On mms_merchants.MerchantsCode=mms_refund.RefundUnit
Where mms_refund.ApproveState='passed'  And  mms_refund.ProjectCode='201306030001' And 1=0

Union
--调拨
Select mms_transferDetail.BillNo As SrcBillNo,mms_transferDetail.RowId As SrcRowId,'transfer' As SrcBillType,mms_transfer.TransferDate As TakeDate,
	'' As SupplyType, mms_merchants.MerchantsName As PickUnitName,mms_transferDetail.MaterialCode,mms_material.MaterialName,mms_material.Model,mms_transferDetail.Unit,
	mms_transferDetail.UnitPrice,mms_transferDetail.Num,mms_transferDetail.Money,mms_material.MaterialType,mms_materialType.Type As MaterialKind
From mms_transfer
Left join mms_transferDetail On mms_transferDetail.BillNo=mms_transfer.BillNo
Left join mms_material On mms_material.MaterialCode=mms_transferDetail.MaterialCode
Left join mms_materialType On mms_materialType.MaterialType=mms_material.MaterialType
Left join mms_merchants On mms_merchants.MerchantsCode=mms_transfer.ReceiveUnit
Where mms_transfer.ApproveState='passed' And  mms_transfer.ProjectCode='201306030001' And 1=0

Union
--报损
Select mms_lossReportDetail.BillNo As SrcBillNo,mms_lossReportDetail.RowId As SrcRowId,'lossReport' As SrcBillType,mms_lossReport.LossReportDate As TakeDate,
	'' As SupplyType, '其他' As PickUnitName,mms_lossReportDetail.MaterialCode,mms_material.MaterialName,mms_material.Model,mms_lossReportDetail.Unit,
	mms_lossReportDetail.UnitPrice,mms_lossReportDetail.Num,mms_lossReportDetail.Money,mms_material.MaterialType,mms_materialType.Type As MaterialKind
From mms_lossReport
Left join mms_lossReportDetail On mms_lossReportDetail.BillNo=mms_lossReport.BillNo
Left join mms_material On mms_material.MaterialCode=mms_lossReportDetail.MaterialCode
Left join mms_materialType On mms_materialType.MaterialType=mms_material.MaterialType
Where mms_lossReport.ApproveState='passed'  And  mms_lossReport.ProjectCode='201306030001' And 1=0
) as t
group by MaterialCode,MaterialName,Model,MaterialKind,MaterialType,Unit

2019-02-11 10:53:17,084 [52900] DEBUG Mms - 
Select mms_warehouseStockHistory.MaterialCode,sum(Num) As InitNum,sum(UnitPrice*Num) As InitMoney
From mms_warehouseStockHistory
Left join mms_warehouse on mms_warehouse.warehouseCode=mms_warehouseStockHistory.warehouseCode
Left join mms_material on mms_material.MaterialCode=mms_warehouseStockHistory.MaterialCode
Where 1=1  And  mms_warehouse.ProjectCode='201306030001'
group by mms_warehouseStockHistory.MaterialCode

2019-02-11 10:53:20,634 [52872] DEBUG Sys - 
select 1
from sys_roleMenuMap A
left join sys_userRoleMap B on B.RoleCode = A.RoleCode
left join sys_menu C on C.MenuCode = A.MenuCode
where B.UserCode = 'admin'
and C.URL in ('/Mms/report/receivesummary')
2019-02-11 10:53:20,930 [52900] DEBUG Mms - 
Select T.*
From
( 
    --收料单
    Select mms_receive.BillNo As SrcBillNo,'receive' As SrcBillType,mms_receive.ContractCode As ContractCode,
	    mms_receive.SupplierCode,mms_receive.OriginalNum,mms_receive.ReceiveDate As TakeDate,
	    mms_receiveDetail.MaterialCode,mms_receiveDetail.Unit,mms_receiveDetail.UnitPrice,
	    mms_receiveDetail.Num,mms_receiveDetail.Money,mms_receiveDetail.Remark,mms_merchants.MerchantsName AS SupplierName,
        '' as name,(mms_receive.BillNo+'receive'+mms_receiveDetail.MaterialCode) as id,mms_material.MaterialName,mms_material.Model
    From mms_receiveDetail
    Left join mms_receive ON mms_receiveDetail.BillNo=mms_receive.BillNo
    left join mms_merchants on mms_merchants.MerchantsCode=mms_receive.SupplierCode
    left join mms_material on mms_material.MaterialCode=mms_receiveDetail.MaterialCode
    Where mms_receive.ApproveState='passed'  And  mms_receive.ProjectCode='201306030001'

    UNION

    --直入直出
    Select mms_direct.BillNo As SrcBillNo,'direct' As SrcBillType,mms_direct.ContractCode As ContractCode,
	    mms_direct.SupplierCode,mms_direct.OriginalNum,mms_direct.ArriveDate As TakeDate,
	    mms_directDetail.MaterialCode,mms_directDetail.Unit,mms_directDetail.UnitPrice,
	    mms_directDetail.Num,mms_directDetail.Money,mms_directDetail.Remark,mms_merchants.MerchantsName AS SupplierName,
        '' as name,(mms_direct.BillNo+'direct'+mms_directDetail.MaterialCode) as id,mms_material.MaterialName,mms_material.Model
    From mms_directDetail
    Left join mms_direct ON mms_directDetail.BillNo=mms_direct.BillNo
    left join mms_merchants on mms_merchants.MerchantsCode=mms_direct.SupplierCode
    left join mms_material on mms_material.MaterialCode=mms_directDetail.MaterialCode
    Where mms_direct.ApproveState='passed'  And  mms_direct.ProjectCode='201306030001'

    UNION

    --退货
    Select mms_return.BillNo As SrcBillNo,'return' As SrcBillType,mms_return.ContractCode As ContractCode,
	    mms_return.SupplierCode,'' AS OriginalNum,mms_return.ReturnDate As TakeDate,
	    mms_returnDetail.MaterialCode,mms_returnDetail.Unit,mms_returnDetail.UnitPrice,
	    -mms_returnDetail.Num,-mms_returnDetail.Money,mms_returnDetail.Remark,mms_merchants.MerchantsName AS SupplierName,
        '' as name,(mms_return.BillNo+'return'+mms_returnDetail.MaterialCode) as id,mms_material.MaterialName,mms_material.Model
    From mms_returnDetail
    Left join mms_return ON mms_returnDetail.BillNo=mms_return.BillNo
    left join mms_merchants on mms_merchants.MerchantsCode=mms_return.SupplierCode
    left join mms_material on mms_material.MaterialCode=mms_returnDetail.MaterialCode
    Where mms_return.ApproveState='passed'  And  mms_return.ProjectCode='201306030001'

    UNION

    --租赁进场
    Select mms_rentIn.BillNo As SrcBillNo,'rentin' As SrcBillType,mms_rentIn.ContractCode As ContractCode,
	    mms_rentIn.SupplierCode,'' as OriginalNum,mms_rentIn.RentInDate As TakeDate,
	    mms_rentInDetail.MaterialCode,mms_rentInDetail.Unit,mms_rentInDetail.UnitPrice,
	    mms_rentInDetail.Num,'0' as Money,mms_rentInDetail.Remark,mms_merchants.MerchantsName AS SupplierName,
        '' as name,(mms_rentIn.BillNo+'rentIn'+mms_rentInDetail.MaterialCode) as id,mms_material.MaterialName,mms_material.Model
    From mms_rentInDetail
    Left join mms_rentIn ON mms_rentInDetail.BillNo=mms_rentIn.BillNo
    left join mms_merchants on mms_merchants.MerchantsCode=mms_rentIn.SupplierCode
    left join mms_material on mms_material.MaterialCode=mms_rentInDetail.MaterialCode
    Where mms_rentIn.ApproveState='passed'  And  mms_rentin.ProjectCode='201306030001'
) as T
Where 1=1 
                
2019-02-11 10:53:21,096 [52900] DEBUG Sys - 
select 1
from sys_roleMenuMap A
left join sys_userRoleMap B on B.RoleCode = A.RoleCode
left join sys_menu C on C.MenuCode = A.MenuCode
where B.UserCode = 'admin'
and C.URL in ('/Mms/report/receivesummary')
2019-02-11 10:53:42,911 [52764] DEBUG Sys - 
select 1
from sys_roleMenuMap A
left join sys_userRoleMap B on B.RoleCode = A.RoleCode
left join sys_menu C on C.MenuCode = A.MenuCode
where B.UserCode = 'admin'
and C.URL in ('/Mms/report/sendsummary')
2019-02-11 10:53:42,919 [52764] DEBUG Servicemms_buildPart - 获取动态列表
2019-02-11 10:53:42,920 [52764] DEBUG Mms - select BuildPartCode as value,BuildPartName as text from mms_buildPart where  ProjectCode =  '201306030001'
2019-02-11 10:53:43,151 [52764] DEBUG Mms - 
Select T.*
From
( 
	--发料单
    Select mms_send.BillNo As SrcBillNo,'send' As SrcBillType,mms_send.SendDate As TakeDate,
		mms_send.PickUnit,mms_merchants.MerchantsName as PickUnitName,mms_buildPart.BuildPartName,
	    mms_sendDetail.MaterialCode,mms_material.MaterialName,mms_material.Model,
		mms_sendDetail.Unit,mms_sendDetail.UnitPrice,mms_sendDetail.Num,mms_sendDetail.Money,
		mms_sendDetail.Remark,'' as name,(mms_send.BillNo+'send'+mms_sendDetail.MaterialCode) as id
    From mms_sendDetail
    Left join mms_send ON mms_sendDetail.BillNo=mms_send.BillNo
    left join mms_merchants on mms_merchants.MerchantsCode=mms_send.PickUnit
    left join mms_material on mms_material.MaterialCode=mms_sendDetail.MaterialCode
	left join mms_buildPart on mms_buildPart.BuildPartCode=mms_send.BuildPartCode
    Where mms_send.ApproveState='passed'  And  mms_send.ProjectCode='201306030001'

    UNION

    --直入直出
    Select mms_direct.BillNo As SrcBillNo,'direct' As SrcBillType,mms_direct.ArriveDate As TakeDate,
		mms_direct.PickUnit,mms_merchants.MerchantsName as PickUnitName,mms_buildPart.BuildPartName,
	    mms_directDetail.MaterialCode,mms_material.MaterialName,mms_material.Model,
		mms_directDetail.Unit,mms_directDetail.UnitPrice,mms_directDetail.Num,mms_directDetail.Money,
		mms_directDetail.Remark,'' as name,(mms_direct.BillNo+'direct'+mms_directDetail.MaterialCode) as id
    From mms_directDetail
    Left join mms_direct ON mms_directDetail.BillNo=mms_direct.BillNo
    left join mms_merchants on mms_merchants.MerchantsCode=mms_direct.PickUnit
    left join mms_material on mms_material.MaterialCode=mms_directDetail.MaterialCode
	left join mms_buildPart on mms_buildPart.BuildPartCode=mms_direct.BuildPartCode
    Where mms_direct.ApproveState='passed'  And  mms_direct.ProjectCode='201306030001'

    UNION

    --退库
     Select mms_refund.BillNo As SrcBillNo,'refund' As SrcBillType,mms_refund.RefundDate As TakeDate,
		mms_refund.RefundUnit as PickUnit,mms_merchants.MerchantsName as PickUnitName,NULL AS BuildPartName,
	    mms_refundDetail.MaterialCode,mms_material.MaterialName,mms_material.Model,
		mms_refundDetail.Unit,mms_refundDetail.UnitPrice,-mms_refundDetail.Num,-mms_refundDetail.Money,
		mms_refundDetail.Remark,'' as name,(mms_refund.BillNo+'refund'+mms_refundDetail.MaterialCode) as id
    From mms_refundDetail
    Left join mms_refund ON mms_refundDetail.BillNo=mms_refund.BillNo
    left join mms_merchants on mms_merchants.MerchantsCode=mms_refund.RefundUnit
    left join mms_material on mms_material.MaterialCode=mms_refundDetail.MaterialCode
    Where mms_refund.ApproveState='passed'  And  mms_refund.ProjectCode='201306030001'

    UNION

    --租赁进场
    Select mms_rentin.BillNo As SrcBillNo,'rentin' As SrcBillType,mms_rentin.RentInDate As TakeDate,
		mms_rentinDetail.UseUnit as PickUnit,mms_merchants.MerchantsName as PickUnitName,mms_buildPart.BuildPartName,
	    mms_rentinDetail.MaterialCode,mms_material.MaterialName,mms_material.Model,
		mms_rentinDetail.Unit,mms_rentinDetail.UnitPrice,mms_rentinDetail.Num,'0' As Money,
		mms_rentinDetail.Remark,'' as name,(mms_rentin.BillNo+'rentin'+mms_rentinDetail.MaterialCode) as id
    From mms_rentinDetail
    Left join mms_rentin ON mms_rentinDetail.BillNo=mms_rentin.BillNo
    left join mms_merchants on mms_merchants.MerchantsCode=mms_rentinDetail.UseUnit
    left join mms_material on mms_material.MaterialCode=mms_rentinDetail.MaterialCode
	left join mms_buildPart on mms_buildPart.BuildPartCode=mms_rentin.BuildPartCode
    Where mms_rentin.ApproveState='passed'  And  mms_rentin.ProjectCode='201306030001'

    UNION

	--报损
	Select mms_lossReport.BillNo As SrcBillNo,'lossReport' As SrcBillType,mms_lossReport.LossReportDate As TakeDate,
		'其他' as PickUnit,'其他' as PickUnitName,NULL AS BuildPartName,
	    mms_lossReportDetail.MaterialCode,mms_material.MaterialName,mms_material.Model,
		mms_lossReportDetail.Unit,mms_lossReportDetail.UnitPrice,mms_lossReportDetail.Num,mms_lossReportDetail.Money,
		mms_lossReportDetail.Remark,'' as name,(mms_lossReport.BillNo+'lossReport'+mms_lossReportDetail.MaterialCode) as id
    From mms_lossReportDetail
    Left join mms_lossReport ON mms_lossReportDetail.BillNo=mms_lossReport.BillNo
    left join mms_material on mms_material.MaterialCode=mms_lossReportDetail.MaterialCode
    Where mms_lossReport.ApproveState='passed'  And  mms_lossReport.ProjectCode='201306030001'

    UNION

	--调拨
	Select mms_transfer.BillNo As SrcBillNo,'transfer' As SrcBillType,mms_transfer.TransferDate As TakeDate,
		mms_transfer.ReceiveUnit as PickUnit,mms_merchants.MerchantsName as PickUnitName,NULL AS BuildPartName,
	    mms_transferDetail.MaterialCode,mms_material.MaterialName,mms_material.Model,
		mms_transferDetail.Unit,mms_transferDetail.UnitPrice,mms_transferDetail.Num,mms_transferDetail.Money,
		mms_transferDetail.Remark,'' as name,(mms_transfer.BillNo+'transfer'+mms_transferDetail.MaterialCode) as id
    From mms_transferDetail
    Left join mms_transfer ON mms_transferDetail.BillNo=mms_transfer.BillNo
    left join mms_merchants on mms_merchants.MerchantsCode=mms_transfer.ReceiveUnit
    left join mms_material on mms_material.MaterialCode=mms_transferDetail.MaterialCode
    Where mms_transfer.ApproveState='passed'  And  mms_transfer.ProjectCode='201306030001'

) as T
Where 1=1 

                
2019-02-11 10:53:43,295 [52764] DEBUG Sys - 
select 1
from sys_roleMenuMap A
left join sys_userRoleMap B on B.RoleCode = A.RoleCode
left join sys_menu C on C.MenuCode = A.MenuCode
where B.UserCode = 'admin'
and C.URL in ('/Mms/report/sendsummary')
2019-02-11 10:53:43,296 [52764] DEBUG Servicemms_buildPart - 获取动态列表
2019-02-11 10:53:43,296 [52764] DEBUG Mms - select BuildPartCode as value,BuildPartName as text from mms_buildPart where  ProjectCode =  '201306030001'
2019-02-11 10:53:45,308 [52764] DEBUG Sys - 
select 1
from sys_roleMenuMap A
left join sys_userRoleMap B on B.RoleCode = A.RoleCode
left join sys_menu C on C.MenuCode = A.MenuCode
where B.UserCode = 'admin'
and C.URL in ('/Mms/report/warehousequery')
2019-02-11 10:53:45,314 [52764] DEBUG Servicemms_warehouse - 获取动态列表
2019-02-11 10:53:45,314 [52764] DEBUG Mms - select WarehouseCode as value,WarehouseName as text from mms_warehouse where  ProjectCode =  '201306030001'
2019-02-11 10:53:45,504 [52764] DEBUG Mms - 
Select mms_warehouseStock.*,mms_material.MaterialName,mms_material.Model,mms_warehouse.WarehouseName,
    mms_warehouseStock.WarehouseCode+'_'+mms_material.MaterialCode as id,'' AS name
From mms_warehouseStock
Left join mms_warehouse on mms_warehouseStock.WarehouseCode=mms_warehouse.WarehouseCode
Left join mms_material on mms_material.MaterialCode=mms_warehouseStock.MaterialCode
Where mms_warehouse.ProjectCode='201306030001' 

                
2019-02-11 10:53:45,596 [52764] DEBUG Sys - 
select 1
from sys_roleMenuMap A
left join sys_userRoleMap B on B.RoleCode = A.RoleCode
left join sys_menu C on C.MenuCode = A.MenuCode
where B.UserCode = 'admin'
and C.URL in ('/Mms/report/warehousequery')
2019-02-11 10:53:45,597 [52764] DEBUG Servicemms_warehouse - 获取动态列表
2019-02-11 10:53:45,597 [52764] DEBUG Mms - select WarehouseCode as value,WarehouseName as text from mms_warehouse where  ProjectCode =  '201306030001'
2019-02-11 10:53:49,662 [52764] DEBUG Sys - 
select 1
from sys_roleMenuMap A
left join sys_userRoleMap B on B.RoleCode = A.RoleCode
left join sys_menu C on C.MenuCode = A.MenuCode
where B.UserCode = 'admin'
and C.URL in ('/Mms/report/warehouseaccount')
2019-02-11 10:53:49,875 [52764] DEBUG Mms - 
Select mms_warehouseStockHistory.*,mms_material.MaterialName,mms_material.Model,mms_material.Unit
From mms_warehouseStockHistory
Left join mms_warehouse on mms_warehouse.WarehouseCode=mms_warehouseStockHistory.WarehouseCode
Left join mms_material on mms_material.MaterialCode=mms_warehouseStockHistory.MaterialCode
Where  mms_warehouse.ProjectCode='201306030001' 
order by mms_warehouseStockHistory.CreateDate desc
                
2019-02-11 10:53:50,908 [52764] DEBUG Sys - 
select 1
from sys_roleMenuMap A
left join sys_userRoleMap B on B.RoleCode = A.RoleCode
left join sys_menu C on C.MenuCode = A.MenuCode
where B.UserCode = 'admin'
and C.URL in ('/Mms/report/materialwarnning')
2019-02-11 10:53:51,105 [52764] DEBUG Mms - 
Select mms_materialWarnning.*,mms_material.MaterialName,mms_material.Model,mms_material.Unit
From mms_materialWarnning
Left join mms_material on mms_material.MaterialCode=mms_materialWarnning.MaterialCode
Where mms_materialWarnning.ProjectCode='201306030001' 
                
2019-02-11 10:53:51,141 [52872] DEBUG Mms - 
Select *
From mms_warehouseStock
Left join mms_warehouse on mms_warehouse.WarehouseCode=mms_warehouseStock.WarehouseCode
Where mms_warehouse.ProjectCode='201306030001' and mms_warehouseStock.MaterialCode=''
                
2019-02-11 10:53:52,550 [51080] DEBUG Mms - 
Select *
From mms_warehouseStock
Left join mms_warehouse on mms_warehouse.WarehouseCode=mms_warehouseStock.WarehouseCode
Where mms_warehouse.ProjectCode='201306030001' and mms_warehouseStock.MaterialCode='0101010103'
                
2019-02-11 10:53:53,890 [52764] DEBUG Mms - 
Select *
From mms_warehouseStock
Left join mms_warehouse on mms_warehouse.WarehouseCode=mms_warehouseStock.WarehouseCode
Where mms_warehouse.ProjectCode='201306030001' and mms_warehouseStock.MaterialCode='0101010104'
                
2019-02-11 10:53:54,765 [52764] DEBUG Mms - 
Select *
From mms_warehouseStock
Left join mms_warehouse on mms_warehouse.WarehouseCode=mms_warehouseStock.WarehouseCode
Where mms_warehouse.ProjectCode='201306030001' and mms_warehouseStock.MaterialCode='0101010102'
                
2019-02-11 10:53:55,689 [52872] DEBUG Mms - 
Select *
From mms_warehouseStock
Left join mms_warehouse on mms_warehouse.WarehouseCode=mms_warehouseStock.WarehouseCode
Where mms_warehouse.ProjectCode='201306030001' and mms_warehouseStock.MaterialCode='0101010101'
                
2019-02-11 10:53:56,667 [52872] DEBUG Mms - 
Select *
From mms_warehouseStock
Left join mms_warehouse on mms_warehouse.WarehouseCode=mms_warehouseStock.WarehouseCode
Where mms_warehouse.ProjectCode='201306030001' and mms_warehouseStock.MaterialCode='01010101'
                
2019-02-11 10:53:59,838 [52872] DEBUG Mms - 
Select *
From mms_warehouseStock
Left join mms_warehouse on mms_warehouse.WarehouseCode=mms_warehouseStock.WarehouseCode
Where mms_warehouse.ProjectCode='201306030001' and mms_warehouseStock.MaterialCode='0101010102'
                
2019-02-11 10:54:00,740 [52872] DEBUG Mms - 
Select *
From mms_warehouseStock
Left join mms_warehouse on mms_warehouse.WarehouseCode=mms_warehouseStock.WarehouseCode
Where mms_warehouse.ProjectCode='201306030001' and mms_warehouseStock.MaterialCode='0101010103'
                
2019-02-11 10:54:11,814 [52872] DEBUG Sys - select * from sys_userSetting where UserCode='admin'
2019-02-11 10:54:25,482 [52872] DEBUG Sys - 
select 1
from sys_roleMenuMap A
left join sys_userRoleMap B on B.RoleCode = A.RoleCode
left join sys_menu C on C.MenuCode = A.MenuCode
where B.UserCode = 'admin'
and C.URL in ('/Sys/menu/Index','/Sys/menu')
2019-02-11 10:54:25,681 [52872] DEBUG Servicesys_menu - 获取动态列表
2019-02-11 10:54:25,681 [52872] DEBUG Sys - select A.*,B.MenuName as ParentName from sys_menu A left join sys_menu B on B.MenuCode = A.ParentCode order by A.MenuSeq,A.MenuCode
2019-02-11 10:54:27,326 [52872] DEBUG Sys - 
select 1
from sys_roleMenuMap A
left join sys_userRoleMap B on B.RoleCode = A.RoleCode
left join sys_menu C on C.MenuCode = A.MenuCode
where B.UserCode = 'admin'
and C.URL in ('/Sys/organize/Index','/Sys/organize')
2019-02-11 10:54:27,333 [52872] DEBUG Servicesys_organize - 获取实体列表
2019-02-11 10:54:27,334 [52872] DEBUG Sys - select sys_organize.* from sys_organize
2019-02-11 10:54:37,441 [52872] DEBUG Sys - 
select 1
from sys_roleMenuMap A
left join sys_userRoleMap B on B.RoleCode = A.RoleCode
left join sys_menu C on C.MenuCode = A.MenuCode
where B.UserCode = 'admin'
and C.URL in ('/Sys/permission/Index','/Sys/permission')
2019-02-11 10:54:37,950 [52872] DEBUG Servicesys_permission - 获取动态列表
2019-02-11 10:54:37,950 [52872] DEBUG Sys - select A.*,B.PermissionName as ParentName from sys_permission A left join sys_permission B on B.PermissionCode = A.ParentCode
2019-02-11 10:54:39,219 [52872] DEBUG Sys - 
select 1
from sys_roleMenuMap A
left join sys_userRoleMap B on B.RoleCode = A.RoleCode
left join sys_menu C on C.MenuCode = A.MenuCode
where B.UserCode = 'admin'
and C.URL in ('/Sys/role/Index','/Sys/role')
2019-02-11 10:54:39,225 [52872] DEBUG Servicesys_user - 获取动态列表
2019-02-11 10:54:39,225 [52872] DEBUG Sys - select UserCode,UserName from sys_user
2019-02-11 10:54:39,226 [52872] DEBUG Servicesys_organize - 获取动态列表
2019-02-11 10:54:39,226 [52872] DEBUG Sys - select OrganizeCode,OrganizeName from sys_organize
2019-02-11 10:54:39,727 [51080] DEBUG Servicesys_role - 获取实体列表
2019-02-11 10:54:39,727 [51080] DEBUG Sys - select sys_role.* from sys_role order by RoleSeq
2019-02-11 10:54:42,773 [51080] DEBUG Sys - 
select 1
from sys_roleMenuMap A
left join sys_userRoleMap B on B.RoleCode = A.RoleCode
left join sys_menu C on C.MenuCode = A.MenuCode
where B.UserCode = 'admin'
and C.URL in ('/Sys/user/Index','/Sys/user')
2019-02-11 10:54:43,286 [51080] DEBUG Servicesys_organize - 获取实体列表
2019-02-11 10:54:43,286 [51080] DEBUG Sys - select sys_organize.* from sys_organize
2019-02-11 10:54:43,312 [51080] DEBUG Servicesys_user - 获取实体列表
2019-02-11 10:54:43,312 [51080] DEBUG Sys - select top 20 sys_user.* from sys_user order by UserSeq
2019-02-11 10:54:43,320 [51080] DEBUG Sys - select count(*) from ( select sys_user.* from sys_user ) tb_temp
2019-02-11 10:54:46,236 [52872] DEBUG Servicesys_user - 获取实体列表
2019-02-11 10:54:46,237 [52872] DEBUG Sys - select top 20 sys_user.* from sys_user where  UserCode in (select UserCode from sys_userOrganizeMap where OrganizeCode in (select ID from [dbo].[GetChild]('sys_organize','04050101'))) order by UserSeq
2019-02-11 10:54:46,415 [52872] DEBUG Sys - select count(*) from ( select sys_user.* from sys_user where  UserCode in (select UserCode from sys_userOrganizeMap where OrganizeCode in (select ID from [dbo].[GetChild]('sys_organize','04050101'))) ) tb_temp
2019-02-11 10:54:47,439 [52872] DEBUG Servicesys_user - 获取实体列表
2019-02-11 10:54:47,439 [52872] DEBUG Sys - select top 20 sys_user.* from sys_user where  UserCode in (select UserCode from sys_userOrganizeMap where OrganizeCode in (select ID from [dbo].[GetChild]('sys_organize','040502'))) order by UserSeq
2019-02-11 10:54:47,455 [52872] DEBUG Sys - select count(*) from ( select sys_user.* from sys_user where  UserCode in (select UserCode from sys_userOrganizeMap where OrganizeCode in (select ID from [dbo].[GetChild]('sys_organize','040502'))) ) tb_temp
2019-02-11 10:54:48,339 [52872] DEBUG Servicesys_user - 获取实体列表
2019-02-11 10:54:48,339 [52872] DEBUG Sys - select top 20 sys_user.* from sys_user where  UserCode in (select UserCode from sys_userOrganizeMap where OrganizeCode in (select ID from [dbo].[GetChild]('sys_organize','040503'))) order by UserSeq
2019-02-11 10:54:48,356 [52872] DEBUG Sys - select count(*) from ( select sys_user.* from sys_user where  UserCode in (select UserCode from sys_userOrganizeMap where OrganizeCode in (select ID from [dbo].[GetChild]('sys_organize','040503'))) ) tb_temp
2019-02-11 10:54:49,570 [52872] DEBUG Sys - 
select 1
from sys_roleMenuMap A
left join sys_userRoleMap B on B.RoleCode = A.RoleCode
left join sys_menu C on C.MenuCode = A.MenuCode
where B.UserCode = 'admin'
and C.URL in ('/Sys/code/Index','/Sys/code')
2019-02-11 10:54:50,157 [52872] DEBUG Servicesys_codeType - 获取动态列表
2019-02-11 10:54:50,158 [52872] DEBUG Sys - select sys_codeType.* from sys_codeType order by Seq,CodeType
2019-02-11 10:54:50,190 [52872] DEBUG Servicesys_code - 获取实体列表
2019-02-11 10:54:50,190 [52872] DEBUG Sys - select top 20 sys_code.* from sys_code order by Seq
2019-02-11 10:54:50,201 [52872] DEBUG Sys - select count(*) from ( select sys_code.* from sys_code ) tb_temp
2019-02-11 10:54:51,963 [52872] DEBUG Servicesys_code - 获取实体列表
2019-02-11 10:54:51,963 [52872] DEBUG Sys - select top 20 sys_code.* from sys_code where  CodeType =  'ImagePart' order by Seq
2019-02-11 10:54:51,966 [52872] DEBUG Sys - select count(*) from ( select sys_code.* from sys_code where  CodeType =  'ImagePart' ) tb_temp
2019-02-11 10:54:54,185 [51080] DEBUG Sys - 
select 1
from sys_roleMenuMap A
left join sys_userRoleMap B on B.RoleCode = A.RoleCode
left join sys_menu C on C.MenuCode = A.MenuCode
where B.UserCode = 'admin'
and C.URL in ('/Sys/parameter/Index','/Sys/parameter')
2019-02-11 10:54:54,704 [51080] DEBUG Servicesys_parameter - 获取实体列表
2019-02-11 10:54:54,705 [51080] DEBUG Sys - select top 20 sys_parameter.* from sys_parameter order by ParamCode
2019-02-11 10:54:54,714 [51080] DEBUG Sys - select count(*) from ( select sys_parameter.* from sys_parameter ) tb_temp
2019-02-11 10:54:57,289 [52872] DEBUG Sys - 
select 1
from sys_roleMenuMap A
left join sys_userRoleMap B on B.RoleCode = A.RoleCode
left join sys_menu C on C.MenuCode = A.MenuCode
where B.UserCode = 'admin'
and C.URL in ('/Sys/log/Index','/Sys/log')
2019-02-11 10:54:57,917 [52872] DEBUG Servicesys_loginHistory - 获取实体列表
2019-02-11 10:54:57,917 [52872] DEBUG Sys - select top 20 
        A.*
     from 
        sys_loginHistory A
     order by A.ID desc
2019-02-11 10:54:57,923 [52872] DEBUG Sys - select count(*) from ( select 
        A.*
     from 
        sys_loginHistory A
     ) tb_temp
2019-02-11 10:54:57,928 [51080] DEBUG Servicesys_log - 获取实体列表
2019-02-11 10:54:57,974 [51080] DEBUG Sys - select top 20 
        A.*
     from 
        sys_log A
     order by A.ID desc
2019-02-11 10:54:58,002 [51080] DEBUG Sys - select count(*) from ( select 
        A.*
     from 
        sys_log A
     ) tb_temp
2019-02-11 10:55:02,926 [51240] DEBUG Sys - 
select 1
from sys_roleMenuMap A
left join sys_userRoleMap B on B.RoleCode = A.RoleCode
left join sys_menu C on C.MenuCode = A.MenuCode
where B.UserCode = 'admin'
and C.URL in ('/Sys/parameter/Index','/Sys/parameter')
2019-02-11 10:55:03,055 [49772] DEBUG Servicesys_parameter - 获取实体列表
2019-02-11 10:55:03,055 [49772] DEBUG Sys - select top 20 sys_parameter.* from sys_parameter order by ParamCode
2019-02-11 10:55:03,056 [49772] DEBUG Sys - select count(*) from ( select sys_parameter.* from sys_parameter ) tb_temp
2019-02-11 10:55:03,818 [51240] DEBUG Sys - 
select 1
from sys_roleMenuMap A
left join sys_userRoleMap B on B.RoleCode = A.RoleCode
left join sys_menu C on C.MenuCode = A.MenuCode
where B.UserCode = 'admin'
and C.URL in ('/Sys/code/Index','/Sys/code')
2019-02-11 10:55:03,939 [51240] DEBUG Servicesys_codeType - 获取动态列表
2019-02-11 10:55:03,940 [51240] DEBUG Sys - select sys_codeType.* from sys_codeType order by Seq,CodeType
2019-02-11 10:55:03,974 [51240] DEBUG Servicesys_code - 获取实体列表
2019-02-11 10:55:03,974 [51240] DEBUG Sys - select top 20 sys_code.* from sys_code order by Seq
2019-02-11 10:55:03,975 [51240] DEBUG Sys - select count(*) from ( select sys_code.* from sys_code ) tb_temp
2019-02-11 10:55:04,515 [51080] DEBUG Sys - 
select 1
from sys_roleMenuMap A
left join sys_userRoleMap B on B.RoleCode = A.RoleCode
left join sys_menu C on C.MenuCode = A.MenuCode
where B.UserCode = 'admin'
and C.URL in ('/Sys/user/Index','/Sys/user')
2019-02-11 10:55:04,652 [51080] DEBUG Servicesys_user - 获取实体列表
2019-02-11 10:55:04,652 [51080] DEBUG Sys - select top 20 sys_user.* from sys_user order by UserSeq
2019-02-11 10:55:04,654 [51240] DEBUG Servicesys_organize - 获取实体列表
2019-02-11 10:55:04,654 [51240] DEBUG Sys - select sys_organize.* from sys_organize
2019-02-11 10:55:04,655 [51080] DEBUG Sys - select count(*) from ( select sys_user.* from sys_user ) tb_temp
2019-02-11 10:55:05,743 [51080] DEBUG Sys - 
select 1
from sys_roleMenuMap A
left join sys_userRoleMap B on B.RoleCode = A.RoleCode
left join sys_menu C on C.MenuCode = A.MenuCode
where B.UserCode = 'admin'
and C.URL in ('/Sys/role/Index','/Sys/role')
2019-02-11 10:55:05,745 [51080] DEBUG Servicesys_user - 获取动态列表
2019-02-11 10:55:05,745 [51080] DEBUG Sys - select UserCode,UserName from sys_user
2019-02-11 10:55:05,746 [51080] DEBUG Servicesys_organize - 获取动态列表
2019-02-11 10:55:05,746 [51080] DEBUG Sys - select OrganizeCode,OrganizeName from sys_organize
2019-02-11 10:55:05,874 [51080] DEBUG Servicesys_role - 获取实体列表
2019-02-11 10:55:05,875 [51080] DEBUG Sys - select sys_role.* from sys_role order by RoleSeq
2019-02-11 10:55:08,021 [51080] DEBUG Sys - 
 select A1.UserName as MemberName ,A1.UserCode as MemberCode,'user' as MemberType
  from sys_user A1
 where A1.UserCode in (select B1.UserCode from sys_userRoleMap B1 where B1.RoleCode = 'super')
union
 select A2.OrganizeName as MemberName ,A2.OrganizeCode as MemberCode,'organize' as MemberType
   from sys_organize A2
  where A2.OrganizeCode in (select B2.OrganizeCode from sys_organizeRoleMap B2 where B2.RoleCode = 'super')
2019-02-11 10:55:25,936 [49772] DEBUG Sys - 
select 1
from sys_roleMenuMap A
left join sys_userRoleMap B on B.RoleCode = A.RoleCode
left join sys_menu C on C.MenuCode = A.MenuCode
where B.UserCode = 'admin'
and C.URL in ('/Sys/user/Index','/Sys/user')
2019-02-11 10:55:26,137 [49772] DEBUG Servicesys_user - 获取实体列表
2019-02-11 10:55:26,137 [49772] DEBUG Sys - select top 20 sys_user.* from sys_user order by UserSeq
2019-02-11 10:55:26,138 [51080] DEBUG Servicesys_organize - 获取实体列表
2019-02-11 10:55:26,138 [51080] DEBUG Sys - select sys_organize.* from sys_organize
2019-02-11 10:55:26,142 [49772] DEBUG Sys - select count(*) from ( select sys_user.* from sys_user ) tb_temp
2019-02-11 10:55:29,723 [51080] DEBUG Sys - 
select distinct A.OrganizeCode,A.OrganizeName,A.ParentCode
,(case when B.UserCode is null then 'false' else 'true' end) as Checked
from sys_organize A
left join sys_userOrganizeMap B on B.OrganizeCode = A.OrganizeCode and B.UserCode = 'zhx'
2019-02-11 10:55:40,416 [51080] DEBUG Sys - 
select 1
from sys_roleMenuMap A
left join sys_userRoleMap B on B.RoleCode = A.RoleCode
left join sys_menu C on C.MenuCode = A.MenuCode
where B.UserCode = 'admin'
and C.URL in ('/Sys/code/Index','/Sys/code')
2019-02-11 10:55:40,528 [51080] DEBUG Servicesys_codeType - 获取动态列表
2019-02-11 10:55:40,529 [51080] DEBUG Sys - select sys_codeType.* from sys_codeType order by Seq,CodeType
2019-02-11 10:55:40,570 [51080] DEBUG Servicesys_code - 获取实体列表
2019-02-11 10:55:40,570 [51080] DEBUG Sys - select top 20 sys_code.* from sys_code order by Seq
2019-02-11 10:55:40,571 [51080] DEBUG Sys - select count(*) from ( select sys_code.* from sys_code ) tb_temp
2019-02-11 12:10:44,547 [51336] DEBUG Sys - select name from dbo.sysobjects where id = object_id(N'[dbo].[fun_getPY]') and xtype in (N'FN', N'IF', N'TF')
2019-02-11 12:10:44,607 [51336] DEBUG Sys - select name from dbo.sysobjects where id = object_id(N'[dbo].[fun_getPY]') and xtype in (N'FN', N'IF', N'TF')
2019-02-11 12:10:44,610 [51336] DEBUG Mms - select name from dbo.sysobjects where id = object_id(N'[dbo].[fun_getPY]') and xtype in (N'FN', N'IF', N'TF')
2019-02-11 12:10:44,624 [51336] DEBUG Mms - select name from dbo.sysobjects where id = object_id(N'[dbo].[fun_getPY]') and xtype in (N'FN', N'IF', N'TF')
2019-02-11 21:59:13,324 [39652] DEBUG Sys - select name from dbo.sysobjects where id = object_id(N'[dbo].[fun_getPY]') and xtype in (N'FN', N'IF', N'TF')
2019-02-11 21:59:13,403 [39652] DEBUG Sys - select name from dbo.sysobjects where id = object_id(N'[dbo].[fun_getPY]') and xtype in (N'FN', N'IF', N'TF')
2019-02-11 21:59:13,446 [39652] DEBUG Mms - select name from dbo.sysobjects where id = object_id(N'[dbo].[fun_getPY]') and xtype in (N'FN', N'IF', N'TF')
2019-02-11 21:59:13,463 [39652] DEBUG Mms - select name from dbo.sysobjects where id = object_id(N'[dbo].[fun_getPY]') and xtype in (N'FN', N'IF', N'TF')
