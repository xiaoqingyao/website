2020-05-07 06:52:25,114 [13276] DEBUG Sys - select name from dbo.sysobjects where id = object_id(N'[dbo].[fun_getPY]') and xtype in (N'FN', N'IF', N'TF')
2020-05-07 06:52:25,160 [13276] DEBUG Sys - select name from dbo.sysobjects where id = object_id(N'[dbo].[fun_getPY]') and xtype in (N'FN', N'IF', N'TF')
2020-05-07 06:52:25,164 [13276] DEBUG Mms - select name from dbo.sysobjects where id = object_id(N'[dbo].[fun_getPY]') and xtype in (N'FN', N'IF', N'TF')
2020-05-07 06:52:25,164 [13276] DEBUG Mms - select name from dbo.sysobjects where id = object_id(N'[dbo].[fun_getPY]') and xtype in (N'FN', N'IF', N'TF')
2020-05-07 10:37:57,184 [10912] DEBUG Sys - select name from dbo.sysobjects where id = object_id(N'[dbo].[fun_getPY]') and xtype in (N'FN', N'IF', N'TF')
2020-05-07 10:37:57,239 [10912] DEBUG Sys - select name from dbo.sysobjects where id = object_id(N'[dbo].[fun_getPY]') and xtype in (N'FN', N'IF', N'TF')
2020-05-07 10:37:57,242 [10912] DEBUG Mms - select name from dbo.sysobjects where id = object_id(N'[dbo].[fun_getPY]') and xtype in (N'FN', N'IF', N'TF')
2020-05-07 10:37:57,243 [10912] DEBUG Mms - select name from dbo.sysobjects where id = object_id(N'[dbo].[fun_getPY]') and xtype in (N'FN', N'IF', N'TF')
2020-05-07 10:38:49,437 [12200] DEBUG Servicesys_user - 获取实体对象
2020-05-07 10:38:49,446 [12200] DEBUG Sys - select sys_user.* from sys_user where  UserCode =  'admin'and Password =  '123456'and IsEnable =  'True'
2020-05-07 10:38:55,179 [12200] DEBUG Servicesys_user - 获取实体对象
2020-05-07 10:38:55,179 [12200] DEBUG Sys - select sys_user.* from sys_user where  UserCode =  'admin'and Password =  '1234'and IsEnable =  'True'
2020-05-07 10:38:55,256 [12200] DEBUG Sys - 
update sys_user
set LoginCount = isnull(LoginCount,0) + 1
   ,LastLoginDate = getdate()
where UserCode = 'admin' 
2020-05-07 10:38:55,367 [12200] DEBUG Sys - insert into sys_loginHistory([UserCode],[UserName],[HostName],[HostIP],[LoginCity],[LoginDate]) values('admin','管理员','iZqxlxq8z66evcZ','localhost','','2020/5/7 10:38:55')
2020-05-07 10:38:55,397 [12200] DEBUG Servicemms_project - 获取实体对象
2020-05-07 10:38:55,397 [12200] DEBUG Mms - select mms_project.* from mms_project where  ProjectCode =  '201306030001'
2020-05-07 10:38:55,463 [12212] DEBUG Sys - select * from sys_userSetting where UserCode='admin'
2020-05-07 10:38:57,160 [12212] DEBUG Sys - 
--角色的菜单
select distinct B.*
from sys_roleMenuMap A
inner join sys_menu  B on B.MenuCode = A.MenuCode
where B.IsEnable='1'
  and RoleCode in (
  select RoleCode from sys_userRoleMap where UserCode = 'admin' --用户的角色
union all
  select RoleCode from sys_organizeRoleMap where OrganizeCode in  --机构的角色
  (
	select OrganizeCode from sys_userOrganizeMap where UserCode = 'admin'
  )  
)
order by B.MenuSeq,B.MenuCode
2020-05-07 10:39:02,950 [12212] DEBUG Sys - 
select 1
from sys_roleMenuMap A
left join sys_userRoleMap B on B.RoleCode = A.RoleCode
left join sys_menu C on C.MenuCode = A.MenuCode
where B.UserCode = 'admin'
and C.URL in ('/Mms/receive/Index','/Mms/receive')
2020-05-07 10:39:02,989 [12212] DEBUG Servicemms_warehouse - 获取动态列表
2020-05-07 10:39:02,990 [12212] DEBUG Mms - select WarehouseCode as value,WarehouseName as text from mms_warehouse where  ProjectCode =  '201306030001'
2020-05-07 10:39:03,003 [12212] DEBUG Servicesys_code - 获取动态列表
2020-05-07 10:39:03,003 [12212] DEBUG Sys - select Code as value,Text as text from sys_code where  CodeType =  'SupplyType'
2020-05-07 10:39:04,350 [12212] DEBUG Servicemms_receive - 获取动态列表
2020-05-07 10:39:04,350 [12212] DEBUG Mms - select top 20 
        A.*, B.ProjectName, C.MaterialTypeName, D.WarehouseName as WarehouseName, E.MerchantsName AS SupplierName
     from 
        mms_receive A
        left join mms_project       B on B.ProjectCode      = A.ProjectCode
        left join mms_materialType  C on C.MaterialType = A.MaterialType
        left join mms_warehouse         D on D.WarehouseCode       = A.WarehouseCode
        left join mms_merchants     E on E.MerchantsCode    = A.SupplierCode
     where  A.ProjectCode =  '201306030001' order by A.BillNo
2020-05-07 10:39:04,396 [12212] DEBUG Mms - select count(*) from ( select 
        A.*, B.ProjectName, C.MaterialTypeName, D.WarehouseName as WarehouseName, E.MerchantsName AS SupplierName
     from 
        mms_receive A
        left join mms_project       B on B.ProjectCode      = A.ProjectCode
        left join mms_materialType  C on C.MaterialType = A.MaterialType
        left join mms_warehouse         D on D.WarehouseCode       = A.WarehouseCode
        left join mms_merchants     E on E.MerchantsCode    = A.SupplierCode
     where  A.ProjectCode =  '201306030001' ) tb_temp
2020-05-07 10:39:07,061 [12212] DEBUG Servicemms_receive - 获取新主键
2020-05-07 10:39:07,063 [12212] DEBUG Mms - select isnull(max(BillNo),0) from mms_receive
2020-05-07 10:39:07,183 [11316] DEBUG Sys - 
select 1
from sys_roleMenuMap A
left join sys_userRoleMap B on B.RoleCode = A.RoleCode
left join sys_menu C on C.MenuCode = A.MenuCode
where B.UserCode = 'admin'
and C.URL in ('/Mms/receive/edit')
2020-05-07 10:39:07,194 [11316] DEBUG Servicemms_receive - 获取实体对象
2020-05-07 10:39:07,194 [11316] DEBUG Mms - select mms_receive.* from mms_receive where  BillNo =  '202005070001'
2020-05-07 10:39:07,199 [11316] DEBUG Servicemms_receive - 获取上一条下一条数据
2020-05-07 10:39:07,214 [11316] DEBUG Servicemms_receive - 获取字段
2020-05-07 10:39:07,214 [11316] DEBUG Mms - select top 1 BillNo from mms_receive where  ProjectCode =  '201306030001' order by BillNo
2020-05-07 10:39:07,219 [11316] DEBUG Servicemms_receive - 获取字段
2020-05-07 10:39:07,219 [11316] DEBUG Mms - select top 1 BillNo from mms_receive where  BillNo < '202005070001'and ProjectCode =  '201306030001' order by BillNo desc
2020-05-07 10:39:07,221 [11316] DEBUG Servicemms_receive - 获取字段
2020-05-07 10:39:07,221 [11316] DEBUG Mms - select top 1 BillNo from mms_receive where  BillNo >  '202005070001'and ProjectCode =  '201306030001' order by BillNo
2020-05-07 10:39:07,226 [11316] DEBUG Servicemms_receive - 获取字段
2020-05-07 10:39:07,226 [11316] DEBUG Mms - select top 1 BillNo from mms_receive where  ProjectCode =  '201306030001' order by BillNo desc
2020-05-07 10:39:07,246 [11316] DEBUG Servicesys_code - 获取动态列表
2020-05-07 10:39:07,246 [11316] DEBUG Sys - select Text as value,Text as text from sys_code where  CodeType =  'MeasureUnit'
2020-05-07 10:39:07,248 [11316] DEBUG Servicesys_code - 获取动态列表
2020-05-07 10:39:07,248 [11316] DEBUG Sys - select Code as value,Text as text from sys_code where  CodeType =  'SupplyType'
2020-05-07 10:39:07,248 [11316] DEBUG Servicesys_code - 获取动态列表
2020-05-07 10:39:07,248 [11316] DEBUG Sys - select Code as value,Text as text from sys_code where  CodeType =  'PayType'
2020-05-07 10:39:07,250 [11316] DEBUG Servicemms_warehouse - 获取动态列表
2020-05-07 10:39:07,250 [11316] DEBUG Mms - select WarehouseCode as value,WarehouseName as text from mms_warehouse where  ProjectCode =  '201306030001'
2020-05-07 10:39:07,251 [11316] DEBUG Servicesys_code - 获取字段
2020-05-07 10:39:07,251 [11316] DEBUG Sys - select top 1 Code from sys_code where  CodeType =  'SupplyType'and IsEnable =  'True'and IsDefault =  'True'
2020-05-07 10:39:07,252 [11316] DEBUG Servicesys_code - 获取字段
2020-05-07 10:39:07,252 [11316] DEBUG Sys - select top 1 Code from sys_code where  CodeType =  'PayType'and IsEnable =  'True'and IsDefault =  'True'
2020-05-07 10:39:09,572 [12200] DEBUG Servicemms_receive - 获取动态列表
2020-05-07 10:39:09,572 [12200] DEBUG Mms - select 
        A.*, B.MaterialName,B.Model,B.Material
     from 
        mms_receiveDetail A
        left join mms_material B on B.MaterialCode = A.MaterialCode
     where  BillNo =  '202005070001' order by A.MaterialCode
2020-05-07 10:39:13,406 [11316] DEBUG Sys - 
select 1
from sys_roleMenuMap A
left join sys_userRoleMap B on B.RoleCode = A.RoleCode
left join sys_menu C on C.MenuCode = A.MenuCode
where B.UserCode = 'admin'
and C.URL in ('/Mms/send/Index','/Mms/send')
2020-05-07 10:39:13,411 [11316] DEBUG Servicemms_warehouse - 获取动态列表
2020-05-07 10:39:13,412 [11316] DEBUG Mms - select WarehouseCode as value,WarehouseName as text from mms_warehouse where  ProjectCode =  '201306030001'
2020-05-07 10:39:13,412 [11316] DEBUG Servicesys_code - 获取动态列表
2020-05-07 10:39:13,413 [11316] DEBUG Sys - select Code as value,Text as text from sys_code where  CodeType =  'Pricing'
2020-05-07 10:39:13,414 [11316] DEBUG Servicesys_code - 获取动态列表
2020-05-07 10:39:13,414 [11316] DEBUG Sys - select Code as value,Text as text from sys_code where  CodeType =  'MaterialUse'
2020-05-07 10:39:13,442 [11316] DEBUG Sys - select MenuCode from sys_menu where URL = '/mms/send'
2020-05-07 10:39:13,446 [11316] DEBUG Sys - 
select *
from sys_roleMenuColumnMap 
where MenuCode = '1001'
and RoleCode in (
select RoleCode
from sys_userRoleMap
where userCode = 'admin'
union
select A.RoleCode
from sys_organizeRoleMap A
inner join sys_userOrganizeMap B on B.OrganizeCode = A.OrganizeCode
where B.UserCode = 'admin'
)
2020-05-07 10:39:13,480 [11316] DEBUG Sys - select MenuCode from sys_menu where URL = '/mms/send'
2020-05-07 10:39:13,480 [11316] DEBUG Sys - 
select A.*
from sys_button A
inner join sys_roleMenuButtonMap B on B.MenuCode = '1001' and B.ButtonCode = A.ButtonCode
where RoleCode in (
select RoleCode
from sys_userRoleMap
where userCode = 'admin'
union
select A.RoleCode
from sys_organizeRoleMap A
inner join sys_userOrganizeMap B on B.OrganizeCode = A.OrganizeCode
where B.UserCode = 'admin'
)
order by ButtonSeq
2020-05-07 10:39:14,347 [12212] DEBUG Servicemms_send - 获取动态列表
2020-05-07 10:39:14,347 [12212] DEBUG Mms - select top 20 
        A.*, B.ProjectName, C.MaterialTypeName, D.WarehouseName,E.MerchantsName as PickUnitName
     from 
        mms_send A
        left join mms_project       B on B.ProjectCode      = A.ProjectCode
        left join mms_materialType  C on C.MaterialType = A.MaterialType
        left join mms_warehouse         D on D.WarehouseCode       = A.WarehouseCode
        left join mms_merchants E on E.MerchantsCode=A.PickUnit
     where  A.ProjectCode =  '201306030001' order by A.BillNo
2020-05-07 10:39:14,357 [12212] DEBUG Mms - select count(*) from ( select 
        A.*, B.ProjectName, C.MaterialTypeName, D.WarehouseName,E.MerchantsName as PickUnitName
     from 
        mms_send A
        left join mms_project       B on B.ProjectCode      = A.ProjectCode
        left join mms_materialType  C on C.MaterialType = A.MaterialType
        left join mms_warehouse         D on D.WarehouseCode       = A.WarehouseCode
        left join mms_merchants E on E.MerchantsCode=A.PickUnit
     where  A.ProjectCode =  '201306030001' ) tb_temp
2020-05-07 10:39:18,523 [12200] DEBUG Servicemms_send - 获取新主键
2020-05-07 10:39:18,523 [12200] DEBUG Mms - select isnull(max(BillNo),0) from mms_send
2020-05-07 10:39:18,642 [12212] DEBUG Sys - 
select 1
from sys_roleMenuMap A
left join sys_userRoleMap B on B.RoleCode = A.RoleCode
left join sys_menu C on C.MenuCode = A.MenuCode
where B.UserCode = 'admin'
and C.URL in ('/Mms/send/edit')
2020-05-07 10:39:18,658 [12212] DEBUG Servicemms_send - 获取实体对象
2020-05-07 10:39:18,658 [12212] DEBUG Mms - select mms_send.* from mms_send where  BillNo =  '202005070001'
2020-05-07 10:39:18,671 [12212] DEBUG Servicemms_send - 获取上一条下一条数据
2020-05-07 10:39:18,672 [12212] DEBUG Servicemms_send - 获取字段
2020-05-07 10:39:18,672 [12212] DEBUG Mms - select top 1 BillNo from mms_send where  ProjectCode =  '201306030001' order by BillNo
2020-05-07 10:39:18,674 [12212] DEBUG Servicemms_send - 获取字段
2020-05-07 10:39:18,674 [12212] DEBUG Mms - select top 1 BillNo from mms_send where  BillNo < '202005070001'and ProjectCode =  '201306030001' order by BillNo desc
2020-05-07 10:39:18,678 [12212] DEBUG Servicemms_send - 获取字段
2020-05-07 10:39:18,678 [12212] DEBUG Mms - select top 1 BillNo from mms_send where  BillNo >  '202005070001'and ProjectCode =  '201306030001' order by BillNo
2020-05-07 10:39:18,679 [12212] DEBUG Servicemms_send - 获取字段
2020-05-07 10:39:18,680 [12212] DEBUG Mms - select top 1 BillNo from mms_send where  ProjectCode =  '201306030001' order by BillNo desc
2020-05-07 10:39:18,697 [12212] DEBUG Servicesys_code - 获取动态列表
2020-05-07 10:39:18,697 [12212] DEBUG Sys - select Code as value,Text as text from sys_code where  CodeType =  'Pricing'
2020-05-07 10:39:18,698 [12212] DEBUG Servicesys_code - 获取动态列表
2020-05-07 10:39:18,698 [12212] DEBUG Sys - select Code as value,Text as text from sys_code where  CodeType =  'MaterialUse'
2020-05-07 10:39:18,699 [12212] DEBUG Servicesys_code - 获取动态列表
2020-05-07 10:39:18,699 [12212] DEBUG Sys - select Text as value,Text as text from sys_code where  CodeType =  'MeasureUnit'
2020-05-07 10:39:18,699 [12212] DEBUG Servicemms_warehouse - 获取动态列表
2020-05-07 10:39:18,699 [12212] DEBUG Mms - select WarehouseCode as value,WarehouseName as text from mms_warehouse where  ProjectCode =  '201306030001'
2020-05-07 10:39:18,700 [12212] DEBUG Servicesys_code - 获取字段
2020-05-07 10:39:18,700 [12212] DEBUG Sys - select top 1 Code from sys_code where  CodeType =  'Pricing'and IsEnable =  'True'and IsDefault =  'True'
2020-05-07 10:39:21,339 [9700] DEBUG Servicemms_send - 获取动态列表
2020-05-07 10:39:21,339 [9700] DEBUG Mms - select 
        A.*, B.MaterialName,B.Model,B.Material
     from 
        mms_sendDetail A
        left join mms_material B on B.MaterialCode = A.MaterialCode
     where  BillNo =  '202005070001' order by A.MaterialCode
2020-05-07 10:39:29,465 [12200] DEBUG ServiceModelBase - 获取动态列表
2020-05-07 10:39:29,465 [12200] DEBUG Mms - select top 20 
    ProjectName as text,ProjectCode as value
   from 
    mms_project
   order by ProjectCode
2020-05-07 10:39:29,469 [12200] DEBUG Mms - select count(*) from ( select 
    ProjectName as text,ProjectCode as value
   from 
    mms_project
   ) tb_temp
2020-05-07 10:40:58,485 [12200] DEBUG Sys - select * from sys_userSetting where UserCode='admin'
2020-05-07 10:40:59,730 [12212] DEBUG Sys - 
--角色的菜单
select distinct B.*
from sys_roleMenuMap A
inner join sys_menu  B on B.MenuCode = A.MenuCode
where B.IsEnable='1'
  and RoleCode in (
  select RoleCode from sys_userRoleMap where UserCode = 'admin' --用户的角色
union all
  select RoleCode from sys_organizeRoleMap where OrganizeCode in  --机构的角色
  (
	select OrganizeCode from sys_userOrganizeMap where UserCode = 'admin'
  )  
)
order by B.MenuSeq,B.MenuCode
2020-05-07 10:41:04,120 [12212] DEBUG Sys - select * from sys_userSetting where UserCode='admin'
2020-05-07 10:41:04,748 [13236] DEBUG Sys - 
--角色的菜单
select distinct B.*
from sys_roleMenuMap A
inner join sys_menu  B on B.MenuCode = A.MenuCode
where B.IsEnable='1'
  and RoleCode in (
  select RoleCode from sys_userRoleMap where UserCode = 'admin' --用户的角色
union all
  select RoleCode from sys_organizeRoleMap where OrganizeCode in  --机构的角色
  (
	select OrganizeCode from sys_userOrganizeMap where UserCode = 'admin'
  )  
)
order by B.MenuSeq,B.MenuCode
2020-05-07 10:41:05,661 [12212] DEBUG Sys - select * from sys_userSetting where UserCode='admin'
2020-05-07 10:41:05,877 [12200] DEBUG Sys - select * from sys_userSetting where UserCode='admin'
2020-05-07 10:41:06,033 [13236] DEBUG Sys - select * from sys_userSetting where UserCode='admin'
2020-05-07 10:41:06,203 [12212] DEBUG Sys - select * from sys_userSetting where UserCode='admin'
2020-05-07 10:41:06,398 [13236] DEBUG Sys - select * from sys_userSetting where UserCode='admin'
2020-05-07 10:41:06,548 [11344] DEBUG Sys - select * from sys_userSetting where UserCode='admin'
2020-05-07 10:41:06,724 [12200] DEBUG Sys - select * from sys_userSetting where UserCode='admin'
2020-05-07 10:41:06,892 [13236] DEBUG Sys - select * from sys_userSetting where UserCode='admin'
2020-05-07 10:41:07,058 [13236] DEBUG Sys - select * from sys_userSetting where UserCode='admin'
2020-05-07 10:41:07,553 [12200] DEBUG Sys - 
--角色的菜单
select distinct B.*
from sys_roleMenuMap A
inner join sys_menu  B on B.MenuCode = A.MenuCode
where B.IsEnable='1'
  and RoleCode in (
  select RoleCode from sys_userRoleMap where UserCode = 'admin' --用户的角色
union all
  select RoleCode from sys_organizeRoleMap where OrganizeCode in  --机构的角色
  (
	select OrganizeCode from sys_userOrganizeMap where UserCode = 'admin'
  )  
)
order by B.MenuSeq,B.MenuCode
2020-05-07 10:44:21,739 [13844] DEBUG Sys - select name from dbo.sysobjects where id = object_id(N'[dbo].[fun_getPY]') and xtype in (N'FN', N'IF', N'TF')
2020-05-07 10:44:21,764 [13844] DEBUG Sys - select name from dbo.sysobjects where id = object_id(N'[dbo].[fun_getPY]') and xtype in (N'FN', N'IF', N'TF')
2020-05-07 10:44:21,768 [13844] DEBUG Mms - select name from dbo.sysobjects where id = object_id(N'[dbo].[fun_getPY]') and xtype in (N'FN', N'IF', N'TF')
2020-05-07 10:44:21,768 [13844] DEBUG Mms - select name from dbo.sysobjects where id = object_id(N'[dbo].[fun_getPY]') and xtype in (N'FN', N'IF', N'TF')
2020-05-07 10:45:38,161 [13900] DEBUG Servicesys_user - 获取实体对象
2020-05-07 10:45:38,169 [13900] DEBUG Sys - select sys_user.* from sys_user where  UserCode =  'admin'and Password =  '1234'and IsEnable =  'True'
2020-05-07 10:45:38,222 [13900] DEBUG Sys - 
update sys_user
set LoginCount = isnull(LoginCount,0) + 1
   ,LastLoginDate = getdate()
where UserCode = 'admin' 
2020-05-07 10:45:38,257 [13900] DEBUG Sys - insert into sys_loginHistory([UserCode],[UserName],[HostName],[HostIP],[LoginCity],[LoginDate]) values('admin','管理员','','111.199.55.211','','2020/5/7 10:45:38')
2020-05-07 10:45:38,264 [13900] DEBUG Servicemms_project - 获取实体对象
2020-05-07 10:45:38,265 [13900] DEBUG Mms - select mms_project.* from mms_project where  ProjectCode =  '201306030001'
2020-05-07 10:45:38,357 [13900] DEBUG Sys - select * from sys_userSetting where UserCode='admin'
2020-05-07 10:45:40,310 [13900] DEBUG Sys - 
--角色的菜单
select distinct B.*
from sys_roleMenuMap A
inner join sys_menu  B on B.MenuCode = A.MenuCode
where B.IsEnable='1'
  and RoleCode in (
  select RoleCode from sys_userRoleMap where UserCode = 'admin' --用户的角色
union all
  select RoleCode from sys_organizeRoleMap where OrganizeCode in  --机构的角色
  (
	select OrganizeCode from sys_userOrganizeMap where UserCode = 'admin'
  )  
)
order by B.MenuSeq,B.MenuCode
2020-05-07 10:51:31,784 [13720] DEBUG Sys - select * from sys_userSetting where UserCode='admin'
2020-05-07 10:51:35,052 [10300] DEBUG Sys - 
--角色的菜单
select distinct B.*
from sys_roleMenuMap A
inner join sys_menu  B on B.MenuCode = A.MenuCode
where B.IsEnable='1'
  and RoleCode in (
  select RoleCode from sys_userRoleMap where UserCode = 'admin' --用户的角色
union all
  select RoleCode from sys_organizeRoleMap where OrganizeCode in  --机构的角色
  (
	select OrganizeCode from sys_userOrganizeMap where UserCode = 'admin'
  )  
)
order by B.MenuSeq,B.MenuCode
2020-05-07 10:51:40,430 [13720] DEBUG Sys - 
select 1
from sys_roleMenuMap A
left join sys_userRoleMap B on B.RoleCode = A.RoleCode
left join sys_menu C on C.MenuCode = A.MenuCode
where B.UserCode = 'admin'
and C.URL in ('/Mms/send/Index','/Mms/send')
2020-05-07 10:51:40,441 [13720] DEBUG Servicemms_warehouse - 获取动态列表
2020-05-07 10:51:40,442 [13720] DEBUG Mms - select WarehouseCode as value,WarehouseName as text from mms_warehouse where  ProjectCode =  '201306030001'
2020-05-07 10:51:40,444 [13720] DEBUG Servicesys_code - 获取动态列表
2020-05-07 10:51:40,444 [13720] DEBUG Sys - select Code as value,Text as text from sys_code where  CodeType =  'Pricing'
2020-05-07 10:51:40,447 [13720] DEBUG Servicesys_code - 获取动态列表
2020-05-07 10:51:40,447 [13720] DEBUG Sys - select Code as value,Text as text from sys_code where  CodeType =  'MaterialUse'
2020-05-07 10:51:40,470 [13720] DEBUG Sys - select MenuCode from sys_menu where URL = '/mms/send'
2020-05-07 10:51:40,474 [13720] DEBUG Sys - 
select *
from sys_roleMenuColumnMap 
where MenuCode = '1001'
and RoleCode in (
select RoleCode
from sys_userRoleMap
where userCode = 'admin'
union
select A.RoleCode
from sys_organizeRoleMap A
inner join sys_userOrganizeMap B on B.OrganizeCode = A.OrganizeCode
where B.UserCode = 'admin'
)
2020-05-07 10:51:40,491 [13720] DEBUG Sys - select MenuCode from sys_menu where URL = '/mms/send'
2020-05-07 10:51:40,492 [13720] DEBUG Sys - 
select A.*
from sys_button A
inner join sys_roleMenuButtonMap B on B.MenuCode = '1001' and B.ButtonCode = A.ButtonCode
where RoleCode in (
select RoleCode
from sys_userRoleMap
where userCode = 'admin'
union
select A.RoleCode
from sys_organizeRoleMap A
inner join sys_userOrganizeMap B on B.OrganizeCode = A.OrganizeCode
where B.UserCode = 'admin'
)
order by ButtonSeq
2020-05-07 10:51:41,777 [13820] DEBUG Servicemms_send - 获取动态列表
2020-05-07 10:51:41,777 [13820] DEBUG Mms - select top 20 
        A.*, B.ProjectName, C.MaterialTypeName, D.WarehouseName,E.MerchantsName as PickUnitName
     from 
        mms_send A
        left join mms_project       B on B.ProjectCode      = A.ProjectCode
        left join mms_materialType  C on C.MaterialType = A.MaterialType
        left join mms_warehouse         D on D.WarehouseCode       = A.WarehouseCode
        left join mms_merchants E on E.MerchantsCode=A.PickUnit
     where  A.ProjectCode =  '201306030001' order by A.BillNo
2020-05-07 10:51:41,826 [13820] DEBUG Mms - select count(*) from ( select 
        A.*, B.ProjectName, C.MaterialTypeName, D.WarehouseName,E.MerchantsName as PickUnitName
     from 
        mms_send A
        left join mms_project       B on B.ProjectCode      = A.ProjectCode
        left join mms_materialType  C on C.MaterialType = A.MaterialType
        left join mms_warehouse         D on D.WarehouseCode       = A.WarehouseCode
        left join mms_merchants E on E.MerchantsCode=A.PickUnit
     where  A.ProjectCode =  '201306030001' ) tb_temp
2020-05-07 10:51:43,326 [13820] DEBUG Servicemms_send - 获取新主键
2020-05-07 10:51:43,329 [13820] DEBUG Mms - select isnull(max(BillNo),0) from mms_send
2020-05-07 10:51:43,907 [13720] DEBUG Sys - 
select 1
from sys_roleMenuMap A
left join sys_userRoleMap B on B.RoleCode = A.RoleCode
left join sys_menu C on C.MenuCode = A.MenuCode
where B.UserCode = 'admin'
and C.URL in ('/Mms/send/edit')
2020-05-07 10:51:44,021 [13720] DEBUG Servicemms_send - 获取实体对象
2020-05-07 10:51:44,021 [13720] DEBUG Mms - select mms_send.* from mms_send where  BillNo =  '202005070001'
2020-05-07 10:51:44,023 [13720] DEBUG Servicemms_send - 获取上一条下一条数据
2020-05-07 10:51:44,035 [13720] DEBUG Servicemms_send - 获取字段
2020-05-07 10:51:44,035 [13720] DEBUG Mms - select top 1 BillNo from mms_send where  ProjectCode =  '201306030001' order by BillNo
2020-05-07 10:51:44,038 [13720] DEBUG Servicemms_send - 获取字段
2020-05-07 10:51:44,039 [13720] DEBUG Mms - select top 1 BillNo from mms_send where  BillNo < '202005070001'and ProjectCode =  '201306030001' order by BillNo desc
2020-05-07 10:51:44,040 [13720] DEBUG Servicemms_send - 获取字段
2020-05-07 10:51:44,040 [13720] DEBUG Mms - select top 1 BillNo from mms_send where  BillNo >  '202005070001'and ProjectCode =  '201306030001' order by BillNo
2020-05-07 10:51:44,041 [13720] DEBUG Servicemms_send - 获取字段
2020-05-07 10:51:44,042 [13720] DEBUG Mms - select top 1 BillNo from mms_send where  ProjectCode =  '201306030001' order by BillNo desc
2020-05-07 10:51:44,064 [13720] DEBUG Servicesys_code - 获取动态列表
2020-05-07 10:51:44,064 [13720] DEBUG Sys - select Code as value,Text as text from sys_code where  CodeType =  'Pricing'
2020-05-07 10:51:44,066 [13720] DEBUG Servicesys_code - 获取动态列表
2020-05-07 10:51:44,066 [13720] DEBUG Sys - select Code as value,Text as text from sys_code where  CodeType =  'MaterialUse'
2020-05-07 10:51:44,066 [13720] DEBUG Servicesys_code - 获取动态列表
2020-05-07 10:51:44,066 [13720] DEBUG Sys - select Text as value,Text as text from sys_code where  CodeType =  'MeasureUnit'
2020-05-07 10:51:44,067 [13720] DEBUG Servicemms_warehouse - 获取动态列表
2020-05-07 10:51:44,067 [13720] DEBUG Mms - select WarehouseCode as value,WarehouseName as text from mms_warehouse where  ProjectCode =  '201306030001'
2020-05-07 10:51:44,069 [13720] DEBUG Servicesys_code - 获取字段
2020-05-07 10:51:44,069 [13720] DEBUG Sys - select top 1 Code from sys_code where  CodeType =  'Pricing'and IsEnable =  'True'and IsDefault =  'True'
2020-05-07 10:51:45,316 [13820] DEBUG Servicemms_send - 获取动态列表
2020-05-07 10:51:45,317 [13820] DEBUG Mms - select 
        A.*, B.MaterialName,B.Model,B.Material
     from 
        mms_sendDetail A
        left join mms_material B on B.MaterialCode = A.MaterialCode
     where  BillNo =  '202005070001' order by A.MaterialCode
2020-05-07 10:51:48,576 [13720] DEBUG Servicemms_send - 获取实体对象
2020-05-07 10:51:48,576 [13720] DEBUG Mms - select mms_send.* from mms_send where  BillNo =  '201306050002'
2020-05-07 10:51:48,579 [13720] DEBUG Servicemms_send - 获取上一条下一条数据
2020-05-07 10:51:48,579 [13720] DEBUG Servicemms_send - 获取字段
2020-05-07 10:51:48,579 [13720] DEBUG Mms - select top 1 BillNo from mms_send where  ProjectCode =  '201306030001' order by BillNo
2020-05-07 10:51:48,580 [13720] DEBUG Servicemms_send - 获取字段
2020-05-07 10:51:48,580 [13720] DEBUG Mms - select top 1 BillNo from mms_send where  BillNo < '201306050002'and ProjectCode =  '201306030001' order by BillNo desc
2020-05-07 10:51:48,583 [13720] DEBUG Servicemms_send - 获取字段
2020-05-07 10:51:48,583 [13720] DEBUG Mms - select top 1 BillNo from mms_send where  BillNo >  '201306050002'and ProjectCode =  '201306030001' order by BillNo
2020-05-07 10:51:48,587 [13720] DEBUG Servicemms_send - 获取字段
2020-05-07 10:51:48,587 [13720] DEBUG Mms - select top 1 BillNo from mms_send where  ProjectCode =  '201306030001' order by BillNo desc
2020-05-07 10:51:48,617 [12024] DEBUG Servicemms_send - 获取动态列表
2020-05-07 10:51:48,617 [12024] DEBUG Mms - select 
        A.*, B.MaterialName,B.Model,B.Material
     from 
        mms_sendDetail A
        left join mms_material B on B.MaterialCode = A.MaterialCode
     where  BillNo =  '201306050002' order by A.MaterialCode
2020-05-07 10:51:48,724 [13720] DEBUG ServiceModelBase - 获取动态列表
2020-05-07 10:51:48,724 [13720] DEBUG Mms - select 
    MerchantsCode   as   value,MerchantsName   as   text
   from 
    mms_merchants A
    left join mms_merchantsType B on B.MerchantsTypeCode = A.MerchantsTypeCode
   where  MerchantsCode in ('FB00503') order by MerchantsCode
2020-05-07 10:51:48,725 [13820] DEBUG ServiceModelBase - 获取动态列表
2020-05-07 10:51:48,759 [13820] DEBUG Mms - select 
    BuildPartCode as value,BuildPartName as text,ParentCode as pid
   from 
    mms_buildPart
   where  BuildPartCode in ('3') order by BuildPartCode
2020-05-07 10:51:48,808 [13720] DEBUG ServiceModelBase - 获取动态列表
2020-05-07 10:51:48,808 [13720] DEBUG Mms - select 
    MerchantsCode   as   value,MerchantsName   as   text
   from 
    mms_merchants A
    left join mms_merchantsType B on B.MerchantsTypeCode = A.MerchantsTypeCode
   where  MerchantsCode in ('FB00503') order by MerchantsCode
2020-05-07 10:51:48,821 [10300] DEBUG ServiceModelBase - 获取动态列表
2020-05-07 10:51:48,821 [10300] DEBUG Mms - select 
    BuildPartCode as value,BuildPartName as text,ParentCode as pid
   from 
    mms_buildPart
   where  BuildPartCode in ('3') order by BuildPartCode
2020-05-07 10:51:51,706 [13720] DEBUG Sys - 
select 1
from sys_roleMenuMap A
left join sys_userRoleMap B on B.RoleCode = A.RoleCode
left join sys_menu C on C.MenuCode = A.MenuCode
where B.UserCode = 'admin'
and C.URL in ('/Mms/report/balanceaccount')
2020-05-07 10:51:51,716 [13720] DEBUG Servicemms_warehouse - 获取动态列表
2020-05-07 10:51:51,716 [13720] DEBUG Mms - select WarehouseCode as value,WarehouseName as text from mms_warehouse where  ProjectCode =  '201306030001'
2020-05-07 10:51:51,717 [13720] DEBUG Servicemms_buildPart - 获取动态列表
2020-05-07 10:51:51,717 [13720] DEBUG Mms - select BuildPartCode as value,BuildPartName as text from mms_buildPart where  ProjectCode =  '201306030001'
2020-05-07 10:51:51,911 [13720] DEBUG Mms - 
Select PickUnitName
From (
--收料单
Select mms_receiveDetail.BillNo As SrcBillNo,mms_receiveDetail.RowId As SrcRowId,'receive' As SrcBillType,mms_receive.ReceiveDate As TakeDate,
	mms_receive.SupplyType As SupplyType,'' As PickUnitName, mms_receiveDetail.MaterialCode,mms_material.MaterialName,mms_material.Model,mms_receiveDetail.Unit,
	mms_receiveDetail.UnitPrice,mms_receiveDetail.Num,mms_receiveDetail.Money,mms_material.MaterialType,mms_materialType.Type As MaterialKind
From mms_receive
Left join mms_receiveDetail On mms_receiveDetail.BillNo=mms_receive.BillNo
Left join mms_material On mms_material.MaterialCode=mms_receiveDetail.MaterialCode
Left join mms_materialType On mms_materialType.MaterialType=mms_material.MaterialType
Where mms_receive.ApproveState='passed'  And  mms_receive.ProjectCode='201306030001'

Union
--退货单
Select mms_returnDetail.BillNo As SrcBillNo,mms_returnDetail.RowId As SrcRowId,'return' As SrcBillType,mms_return.ReturnDate As TakeDate,
	'其他' As SupplyType,'' As PickUnitName, mms_returnDetail.MaterialCode,mms_material.MaterialName,mms_material.Model,mms_returnDetail.Unit,
	mms_returnDetail.UnitPrice,-mms_returnDetail.Num,-mms_returnDetail.Money,mms_material.MaterialType,mms_materialType.Type As MaterialKind
From mms_return
Left join mms_returnDetail On mms_returnDetail.BillNo=mms_return.BillNo
Left join mms_material On mms_material.MaterialCode=mms_returnDetail.MaterialCode
Left join mms_materialType On mms_materialType.MaterialType=mms_material.MaterialType
Where mms_return.ApproveState='passed'  And  mms_return.ProjectCode='201306030001'

Union
--直入直出
Select mms_directDetail.BillNo As SrcBillNo,mms_directDetail.RowId As SrcRowId,'direct' As SrcBillType,mms_direct.ArriveDate As TakeDate,
	mms_direct.SupplyType As SupplyType,mms_merchants.MerchantsName As PickUnitName, mms_directDetail.MaterialCode,mms_material.MaterialName,mms_material.Model,mms_directDetail.Unit,
	mms_directDetail.UnitPrice,mms_directDetail.Num,mms_directDetail.Money,mms_material.MaterialType,mms_materialType.Type As MaterialKind
From mms_direct
Left join mms_directDetail On mms_directDetail.BillNo=mms_direct.BillNo
Left join mms_material On mms_material.MaterialCode=mms_directDetail.MaterialCode
Left join mms_materialType On mms_materialType.MaterialType=mms_material.MaterialType
Left join mms_merchants On mms_merchants.MerchantsCode=mms_direct.PickUnit
Where mms_direct.ApproveState='passed'  And  mms_direct.ProjectCode='201306030001'

Union
--租赁进场
Select mms_rentinDetail.BillNo As SrcBillNo,mms_rentinDetail.RowId As SrcRowId,'rentin' As SrcBillType,mms_rentin.RentInDate As TakeDate,
	'租赁进场' As SupplyType,'租赁进场' As PickUnitName, mms_rentinDetail.MaterialCode,mms_material.MaterialName,mms_material.Model,mms_rentinDetail.Unit,
	mms_rentinDetail.UnitPrice,mms_rentinDetail.Num,'0' As Money,mms_material.MaterialType,mms_materialType.Type As MaterialKind
From mms_rentin
Left join mms_rentinDetail On mms_rentinDetail.BillNo=mms_rentin.BillNo
Left join mms_material On mms_material.MaterialCode=mms_rentinDetail.MaterialCode
Left join mms_materialType On mms_materialType.MaterialType=mms_material.MaterialType
Left join mms_merchants On mms_merchants.MerchantsCode=mms_rentinDetail.UseUnit
Where mms_rentin.ApproveState='passed'  And  mms_rentin.ProjectCode='201306030001'

Union
--库存调整
Select mms_stockAdjustDetail.BillNo As SrcBillNo,mms_stockAdjustDetail.RowId As SrcRowId,'adjust' As SrcBillType,mms_stockAdjust.EffectDate As TakeDate,
	'其他' As SupplyType,'' As PickUnitName, mms_stockAdjustDetail.MaterialCode,mms_material.MaterialName,mms_material.Model,mms_stockAdjustDetail.Unit,
	mms_stockAdjustDetail.UnitPrice,mms_stockAdjustDetail.Num,mms_stockAdjustDetail.Money,mms_material.MaterialType,mms_materialType.Type As MaterialKind
From mms_stockAdjust
Left join mms_stockAdjustDetail On mms_stockAdjustDetail.BillNo=mms_stockAdjust.BillNo
Left join mms_material On mms_material.MaterialCode=mms_stockAdjustDetail.MaterialCode
Left join mms_materialType On mms_materialType.MaterialType=mms_material.MaterialType
Where mms_stockAdjust.ApproveState='passed'  And  mms_stockAdjust.ProjectCode='201306030001'

Union
--发料
Select mms_sendDetail.BillNo As SrcBillNo,mms_sendDetail.RowId As SrcRowId,'send' As SrcBillType,mms_send.SendDate As TakeDate,
	'' As SupplyType, mms_merchants.MerchantsName As PickUnitName,mms_sendDetail.MaterialCode,mms_material.MaterialName,mms_material.Model,mms_sendDetail.Unit,
	mms_sendDetail.UnitPrice,mms_sendDetail.Num,mms_sendDetail.Money,mms_material.MaterialType,mms_materialType.Type As MaterialKind
From mms_send
Left join mms_sendDetail On mms_sendDetail.BillNo=mms_send.BillNo
Left join mms_material On mms_material.MaterialCode=mms_sendDetail.MaterialCode
Left join mms_materialType On mms_materialType.MaterialType=mms_material.MaterialType
Left join mms_merchants On mms_merchants.MerchantsCode=mms_send.PickUnit
Where mms_send.ApproveState='passed'  And  mms_send.ProjectCode='201306030001'

Union
--退库
Select mms_refundDetail.BillNo As SrcBillNo,mms_refundDetail.RowId As SrcRowId,'refund' As SrcBillType,mms_refund.RefundDate As TakeDate,
	'' As SupplyType, mms_merchants.MerchantsName As PickUnitName,mms_refundDetail.MaterialCode,mms_material.MaterialName,mms_material.Model,mms_refundDetail.Unit,
	mms_refundDetail.UnitPrice,-mms_refundDetail.Num,-mms_refundDetail.Money,mms_material.MaterialType,mms_materialType.Type As MaterialKind
From mms_refund
Left join mms_refundDetail On mms_refundDetail.BillNo=mms_refund.BillNo
Left join mms_material On mms_material.MaterialCode=mms_refundDetail.MaterialCode
Left join mms_materialType On mms_materialType.MaterialType=mms_material.MaterialType
Left join mms_merchants On mms_merchants.MerchantsCode=mms_refund.RefundUnit
Where mms_refund.ApproveState='passed'  And  mms_refund.ProjectCode='201306030001'

Union
--调拨
Select mms_transferDetail.BillNo As SrcBillNo,mms_transferDetail.RowId As SrcRowId,'transfer' As SrcBillType,mms_transfer.TransferDate As TakeDate,
	'' As SupplyType, mms_merchants.MerchantsName As PickUnitName,mms_transferDetail.MaterialCode,mms_material.MaterialName,mms_material.Model,mms_transferDetail.Unit,
	mms_transferDetail.UnitPrice,mms_transferDetail.Num,mms_transferDetail.Money,mms_material.MaterialType,mms_materialType.Type As MaterialKind
From mms_transfer
Left join mms_transferDetail On mms_transferDetail.BillNo=mms_transfer.BillNo
Left join mms_material On mms_material.MaterialCode=mms_transferDetail.MaterialCode
Left join mms_materialType On mms_materialType.MaterialType=mms_material.MaterialType
Left join mms_merchants On mms_merchants.MerchantsCode=mms_transfer.ReceiveUnit
Where mms_transfer.ApproveState='passed' And  mms_transfer.ProjectCode='201306030001'

Union
--报损
Select mms_lossReportDetail.BillNo As SrcBillNo,mms_lossReportDetail.RowId As SrcRowId,'lossReport' As SrcBillType,mms_lossReport.LossReportDate As TakeDate,
	'' As SupplyType, '其他' As PickUnitName,mms_lossReportDetail.MaterialCode,mms_material.MaterialName,mms_material.Model,mms_lossReportDetail.Unit,
	mms_lossReportDetail.UnitPrice,mms_lossReportDetail.Num,mms_lossReportDetail.Money,mms_material.MaterialType,mms_materialType.Type As MaterialKind
From mms_lossReport
Left join mms_lossReportDetail On mms_lossReportDetail.BillNo=mms_lossReport.BillNo
Left join mms_material On mms_material.MaterialCode=mms_lossReportDetail.MaterialCode
Left join mms_materialType On mms_materialType.MaterialType=mms_material.MaterialType
Where mms_lossReport.ApproveState='passed'  And  mms_lossReport.ProjectCode='201306030001'
) as t
Where PickUnitName<>'' and PickUnitName<>'其他' and PickUnitName<>'租赁进场'
group by PickUnitName
                
2020-05-07 10:51:52,046 [13720] DEBUG Mms - 
Select MaterialCode,MaterialName,Model,MaterialKind,MaterialType,Unit
    ,ISNULL(Sum(CASE WHEN SupplyType<>'' then Money else 0 end),0) as ReceiveMoney --合计
    ,ISNULL(Sum(CASE WHEN SupplyType='082' then Money else 0 end),0) as StockSelfMoney --自采
    ,ISNULL(Sum(CASE WHEN SupplyType='083' then Money else 0 end),0) as OwnerSupplyMoney --甲供
    ,ISNULL(Sum(CASE WHEN SupplyType='084' then Money else 0 end),0) as CallInMoney --调入
    ,ISNULL(Sum(CASE WHEN SupplyType='其他' then Money else 0 end),0) as ReceiveOtherMoney --其他

    ,ISNULL(Sum(CASE WHEN SupplyType<>'' then Num else 0 end),0) as ReceiveNum --合计
    ,ISNULL(Sum(CASE WHEN SupplyType='082' then Num else 0 end),0) as StockSelfNum --自采
    ,ISNULL(Sum(CASE WHEN SupplyType='083' then Num else 0 end),0) as OwnerSupplyNum --甲供
    ,ISNULL(Sum(CASE WHEN SupplyType='084' then Num else 0 end),0) as CallInNum --调入
	,ISNULL(Sum(CASE WHEN SupplyType='租赁进场' then Num else 0 end),0) as ReceiveRentInNum --租赁进场
    ,ISNULL(Sum(CASE WHEN SupplyType='其他' then Num else 0 end),0) as ReceiveOtherNum --其他

    ,ISNULL(Sum(CASE WHEN PickUnitName<>'' then Money else 0 end),0) as SendMoney --合计
    ,ISNULL(Sum(CASE WHEN PickUnitName<>'' then Num else 0 end),0) as SendNum --合计
     ,ISNULL(Sum(CASE WHEN PickUnitName='北京士兴钢结构有限公司' then Num else 0 end),0) as PickUnitNum0 ,ISNULL(Sum(CASE WHEN PickUnitName='北京士兴钢结构有限公司' then Money else 0 end),0) as PickUnitMoney0 ,ISNULL(Sum(CASE WHEN PickUnitName='河北天强建筑工程有限公司' then Num else 0 end),0) as PickUnitNum1 ,ISNULL(Sum(CASE WHEN PickUnitName='河北天强建筑工程有限公司' then Money else 0 end),0) as PickUnitMoney1                                                             --领料人生成的列
    ,ISNULL(Sum(CASE WHEN PickUnitName='租赁进场' then Num else 0 end),0) as SendRentInNum --租赁进场
    ,ISNULL(Sum(CASE WHEN PickUnitName='其他' then Money else 0 end),0) as SendOtherMoney --其他
    ,ISNULL(Sum(CASE WHEN PickUnitName='其他' then Num else 0 end),0) as SendOtherNum --其他

    ,ISNULL(Sum(CASE WHEN SupplyType<>'' then Num else -Num end),0) as TotalNum --合计
    ,ISNULL(Sum(CASE WHEN SupplyType<>'' then Money else -Money end),0) as TotalMoney --合计

From (
--收料单
Select mms_receiveDetail.BillNo As SrcBillNo,mms_receiveDetail.RowId As SrcRowId,'receive' As SrcBillType,mms_receive.ReceiveDate As TakeDate,
	mms_receive.SupplyType As SupplyType,'' As PickUnitName, mms_receiveDetail.MaterialCode,mms_material.MaterialName,mms_material.Model,mms_receiveDetail.Unit,
	mms_receiveDetail.UnitPrice,mms_receiveDetail.Num,mms_receiveDetail.Money,mms_material.MaterialType,mms_materialType.Type As MaterialKind
From mms_receive
Left join mms_receiveDetail On mms_receiveDetail.BillNo=mms_receive.BillNo
Left join mms_material On mms_material.MaterialCode=mms_receiveDetail.MaterialCode
Left join mms_materialType On mms_materialType.MaterialType=mms_material.MaterialType
Where mms_receive.ApproveState='passed'  And  mms_receive.ProjectCode='201306030001'

Union
--退货单
Select mms_returnDetail.BillNo As SrcBillNo,mms_returnDetail.RowId As SrcRowId,'return' As SrcBillType,mms_return.ReturnDate As TakeDate,
	'其他' As SupplyType,'' As PickUnitName, mms_returnDetail.MaterialCode,mms_material.MaterialName,mms_material.Model,mms_returnDetail.Unit,
	mms_returnDetail.UnitPrice,-mms_returnDetail.Num,-mms_returnDetail.Money,mms_material.MaterialType,mms_materialType.Type As MaterialKind
From mms_return
Left join mms_returnDetail On mms_returnDetail.BillNo=mms_return.BillNo
Left join mms_material On mms_material.MaterialCode=mms_returnDetail.MaterialCode
Left join mms_materialType On mms_materialType.MaterialType=mms_material.MaterialType
Where mms_return.ApproveState='passed'  And  mms_return.ProjectCode='201306030001'

Union
--直入直出
Select mms_directDetail.BillNo As SrcBillNo,mms_directDetail.RowId As SrcRowId,'direct' As SrcBillType,mms_direct.ArriveDate As TakeDate,
	mms_direct.SupplyType As SupplyType,mms_merchants.MerchantsName As PickUnitName, mms_directDetail.MaterialCode,mms_material.MaterialName,mms_material.Model,mms_directDetail.Unit,
	mms_directDetail.UnitPrice,mms_directDetail.Num,mms_directDetail.Money,mms_material.MaterialType,mms_materialType.Type As MaterialKind
From mms_direct
Left join mms_directDetail On mms_directDetail.BillNo=mms_direct.BillNo
Left join mms_material On mms_material.MaterialCode=mms_directDetail.MaterialCode
Left join mms_materialType On mms_materialType.MaterialType=mms_material.MaterialType
Left join mms_merchants On mms_merchants.MerchantsCode=mms_direct.PickUnit
Where mms_direct.ApproveState='passed'  And  mms_direct.ProjectCode='201306030001'

Union
--租赁进场
Select mms_rentinDetail.BillNo As SrcBillNo,mms_rentinDetail.RowId As SrcRowId,'rentin' As SrcBillType,mms_rentin.RentInDate As TakeDate,
	'租赁进场' As SupplyType,'租赁进场' As PickUnitName, mms_rentinDetail.MaterialCode,mms_material.MaterialName,mms_material.Model,mms_rentinDetail.Unit,
	mms_rentinDetail.UnitPrice,mms_rentinDetail.Num,'0' As Money,mms_material.MaterialType,mms_materialType.Type As MaterialKind
From mms_rentin
Left join mms_rentinDetail On mms_rentinDetail.BillNo=mms_rentin.BillNo
Left join mms_material On mms_material.MaterialCode=mms_rentinDetail.MaterialCode
Left join mms_materialType On mms_materialType.MaterialType=mms_material.MaterialType
Left join mms_merchants On mms_merchants.MerchantsCode=mms_rentinDetail.UseUnit
Where mms_rentin.ApproveState='passed'  And  mms_rentin.ProjectCode='201306030001'

Union
--库存调整
Select mms_stockAdjustDetail.BillNo As SrcBillNo,mms_stockAdjustDetail.RowId As SrcRowId,'adjust' As SrcBillType,mms_stockAdjust.EffectDate As TakeDate,
	'其他' As SupplyType,'' As PickUnitName, mms_stockAdjustDetail.MaterialCode,mms_material.MaterialName,mms_material.Model,mms_stockAdjustDetail.Unit,
	mms_stockAdjustDetail.UnitPrice,mms_stockAdjustDetail.Num,mms_stockAdjustDetail.Money,mms_material.MaterialType,mms_materialType.Type As MaterialKind
From mms_stockAdjust
Left join mms_stockAdjustDetail On mms_stockAdjustDetail.BillNo=mms_stockAdjust.BillNo
Left join mms_material On mms_material.MaterialCode=mms_stockAdjustDetail.MaterialCode
Left join mms_materialType On mms_materialType.MaterialType=mms_material.MaterialType
Where mms_stockAdjust.ApproveState='passed'  And  mms_stockAdjust.ProjectCode='201306030001'

Union
--发料
Select mms_sendDetail.BillNo As SrcBillNo,mms_sendDetail.RowId As SrcRowId,'send' As SrcBillType,mms_send.SendDate As TakeDate,
	'' As SupplyType, mms_merchants.MerchantsName As PickUnitName,mms_sendDetail.MaterialCode,mms_material.MaterialName,mms_material.Model,mms_sendDetail.Unit,
	mms_sendDetail.UnitPrice,mms_sendDetail.Num,mms_sendDetail.Money,mms_material.MaterialType,mms_materialType.Type As MaterialKind
From mms_send
Left join mms_sendDetail On mms_sendDetail.BillNo=mms_send.BillNo
Left join mms_material On mms_material.MaterialCode=mms_sendDetail.MaterialCode
Left join mms_materialType On mms_materialType.MaterialType=mms_material.MaterialType
Left join mms_merchants On mms_merchants.MerchantsCode=mms_send.PickUnit
Where mms_send.ApproveState='passed'  And  mms_send.ProjectCode='201306030001'

Union
--退库
Select mms_refundDetail.BillNo As SrcBillNo,mms_refundDetail.RowId As SrcRowId,'refund' As SrcBillType,mms_refund.RefundDate As TakeDate,
	'' As SupplyType, mms_merchants.MerchantsName As PickUnitName,mms_refundDetail.MaterialCode,mms_material.MaterialName,mms_material.Model,mms_refundDetail.Unit,
	mms_refundDetail.UnitPrice,-mms_refundDetail.Num,-mms_refundDetail.Money,mms_material.MaterialType,mms_materialType.Type As MaterialKind
From mms_refund
Left join mms_refundDetail On mms_refundDetail.BillNo=mms_refund.BillNo
Left join mms_material On mms_material.MaterialCode=mms_refundDetail.MaterialCode
Left join mms_materialType On mms_materialType.MaterialType=mms_material.MaterialType
Left join mms_merchants On mms_merchants.MerchantsCode=mms_refund.RefundUnit
Where mms_refund.ApproveState='passed'  And  mms_refund.ProjectCode='201306030001'

Union
--调拨
Select mms_transferDetail.BillNo As SrcBillNo,mms_transferDetail.RowId As SrcRowId,'transfer' As SrcBillType,mms_transfer.TransferDate As TakeDate,
	'' As SupplyType, mms_merchants.MerchantsName As PickUnitName,mms_transferDetail.MaterialCode,mms_material.MaterialName,mms_material.Model,mms_transferDetail.Unit,
	mms_transferDetail.UnitPrice,mms_transferDetail.Num,mms_transferDetail.Money,mms_material.MaterialType,mms_materialType.Type As MaterialKind
From mms_transfer
Left join mms_transferDetail On mms_transferDetail.BillNo=mms_transfer.BillNo
Left join mms_material On mms_material.MaterialCode=mms_transferDetail.MaterialCode
Left join mms_materialType On mms_materialType.MaterialType=mms_material.MaterialType
Left join mms_merchants On mms_merchants.MerchantsCode=mms_transfer.ReceiveUnit
Where mms_transfer.ApproveState='passed' And  mms_transfer.ProjectCode='201306030001'

Union
--报损
Select mms_lossReportDetail.BillNo As SrcBillNo,mms_lossReportDetail.RowId As SrcRowId,'lossReport' As SrcBillType,mms_lossReport.LossReportDate As TakeDate,
	'' As SupplyType, '其他' As PickUnitName,mms_lossReportDetail.MaterialCode,mms_material.MaterialName,mms_material.Model,mms_lossReportDetail.Unit,
	mms_lossReportDetail.UnitPrice,mms_lossReportDetail.Num,mms_lossReportDetail.Money,mms_material.MaterialType,mms_materialType.Type As MaterialKind
From mms_lossReport
Left join mms_lossReportDetail On mms_lossReportDetail.BillNo=mms_lossReport.BillNo
Left join mms_material On mms_material.MaterialCode=mms_lossReportDetail.MaterialCode
Left join mms_materialType On mms_materialType.MaterialType=mms_material.MaterialType
Where mms_lossReport.ApproveState='passed'  And  mms_lossReport.ProjectCode='201306030001'
) as t
group by MaterialCode,MaterialName,Model,MaterialKind,MaterialType,Unit

2020-05-07 10:51:52,170 [13720] DEBUG Mms - 
Select mms_warehouseStockHistory.MaterialCode,sum(Num) As InitNum,sum(UnitPrice*Num) As InitMoney
From mms_warehouseStockHistory
Left join mms_warehouse on mms_warehouse.warehouseCode=mms_warehouseStockHistory.warehouseCode
Left join mms_material on mms_material.MaterialCode=mms_warehouseStockHistory.MaterialCode
Where 1=1  And  mms_warehouse.ProjectCode='201306030001'
group by mms_warehouseStockHistory.MaterialCode

2020-05-07 10:51:56,506 [13720] DEBUG Mms - 
Select PickUnitName
From (
--收料单
Select mms_receiveDetail.BillNo As SrcBillNo,mms_receiveDetail.RowId As SrcRowId,'receive' As SrcBillType,mms_receive.ReceiveDate As TakeDate,
	mms_receive.SupplyType As SupplyType,'' As PickUnitName, mms_receiveDetail.MaterialCode,mms_material.MaterialName,mms_material.Model,mms_receiveDetail.Unit,
	mms_receiveDetail.UnitPrice,mms_receiveDetail.Num,mms_receiveDetail.Money,mms_material.MaterialType,mms_materialType.Type As MaterialKind
From mms_receive
Left join mms_receiveDetail On mms_receiveDetail.BillNo=mms_receive.BillNo
Left join mms_material On mms_material.MaterialCode=mms_receiveDetail.MaterialCode
Left join mms_materialType On mms_materialType.MaterialType=mms_material.MaterialType
Where mms_receive.ApproveState='passed'  And  mms_receive.ProjectCode='201306030001'

Union
--退货单
Select mms_returnDetail.BillNo As SrcBillNo,mms_returnDetail.RowId As SrcRowId,'return' As SrcBillType,mms_return.ReturnDate As TakeDate,
	'其他' As SupplyType,'' As PickUnitName, mms_returnDetail.MaterialCode,mms_material.MaterialName,mms_material.Model,mms_returnDetail.Unit,
	mms_returnDetail.UnitPrice,-mms_returnDetail.Num,-mms_returnDetail.Money,mms_material.MaterialType,mms_materialType.Type As MaterialKind
From mms_return
Left join mms_returnDetail On mms_returnDetail.BillNo=mms_return.BillNo
Left join mms_material On mms_material.MaterialCode=mms_returnDetail.MaterialCode
Left join mms_materialType On mms_materialType.MaterialType=mms_material.MaterialType
Where mms_return.ApproveState='passed'  And  mms_return.ProjectCode='201306030001'

Union
--直入直出
Select mms_directDetail.BillNo As SrcBillNo,mms_directDetail.RowId As SrcRowId,'direct' As SrcBillType,mms_direct.ArriveDate As TakeDate,
	mms_direct.SupplyType As SupplyType,mms_merchants.MerchantsName As PickUnitName, mms_directDetail.MaterialCode,mms_material.MaterialName,mms_material.Model,mms_directDetail.Unit,
	mms_directDetail.UnitPrice,mms_directDetail.Num,mms_directDetail.Money,mms_material.MaterialType,mms_materialType.Type As MaterialKind
From mms_direct
Left join mms_directDetail On mms_directDetail.BillNo=mms_direct.BillNo
Left join mms_material On mms_material.MaterialCode=mms_directDetail.MaterialCode
Left join mms_materialType On mms_materialType.MaterialType=mms_material.MaterialType
Left join mms_merchants On mms_merchants.MerchantsCode=mms_direct.PickUnit
Where mms_direct.ApproveState='passed'  And  mms_direct.ProjectCode='201306030001'

Union
--租赁进场
Select mms_rentinDetail.BillNo As SrcBillNo,mms_rentinDetail.RowId As SrcRowId,'rentin' As SrcBillType,mms_rentin.RentInDate As TakeDate,
	'租赁进场' As SupplyType,'租赁进场' As PickUnitName, mms_rentinDetail.MaterialCode,mms_material.MaterialName,mms_material.Model,mms_rentinDetail.Unit,
	mms_rentinDetail.UnitPrice,mms_rentinDetail.Num,'0' As Money,mms_material.MaterialType,mms_materialType.Type As MaterialKind
From mms_rentin
Left join mms_rentinDetail On mms_rentinDetail.BillNo=mms_rentin.BillNo
Left join mms_material On mms_material.MaterialCode=mms_rentinDetail.MaterialCode
Left join mms_materialType On mms_materialType.MaterialType=mms_material.MaterialType
Left join mms_merchants On mms_merchants.MerchantsCode=mms_rentinDetail.UseUnit
Where mms_rentin.ApproveState='passed'  And  mms_rentin.ProjectCode='201306030001'

Union
--库存调整
Select mms_stockAdjustDetail.BillNo As SrcBillNo,mms_stockAdjustDetail.RowId As SrcRowId,'adjust' As SrcBillType,mms_stockAdjust.EffectDate As TakeDate,
	'其他' As SupplyType,'' As PickUnitName, mms_stockAdjustDetail.MaterialCode,mms_material.MaterialName,mms_material.Model,mms_stockAdjustDetail.Unit,
	mms_stockAdjustDetail.UnitPrice,mms_stockAdjustDetail.Num,mms_stockAdjustDetail.Money,mms_material.MaterialType,mms_materialType.Type As MaterialKind
From mms_stockAdjust
Left join mms_stockAdjustDetail On mms_stockAdjustDetail.BillNo=mms_stockAdjust.BillNo
Left join mms_material On mms_material.MaterialCode=mms_stockAdjustDetail.MaterialCode
Left join mms_materialType On mms_materialType.MaterialType=mms_material.MaterialType
Where mms_stockAdjust.ApproveState='passed'  And  mms_stockAdjust.ProjectCode='201306030001'

Union
--发料
Select mms_sendDetail.BillNo As SrcBillNo,mms_sendDetail.RowId As SrcRowId,'send' As SrcBillType,mms_send.SendDate As TakeDate,
	'' As SupplyType, mms_merchants.MerchantsName As PickUnitName,mms_sendDetail.MaterialCode,mms_material.MaterialName,mms_material.Model,mms_sendDetail.Unit,
	mms_sendDetail.UnitPrice,mms_sendDetail.Num,mms_sendDetail.Money,mms_material.MaterialType,mms_materialType.Type As MaterialKind
From mms_send
Left join mms_sendDetail On mms_sendDetail.BillNo=mms_send.BillNo
Left join mms_material On mms_material.MaterialCode=mms_sendDetail.MaterialCode
Left join mms_materialType On mms_materialType.MaterialType=mms_material.MaterialType
Left join mms_merchants On mms_merchants.MerchantsCode=mms_send.PickUnit
Where mms_send.ApproveState='passed'  And  mms_send.ProjectCode='201306030001'

Union
--退库
Select mms_refundDetail.BillNo As SrcBillNo,mms_refundDetail.RowId As SrcRowId,'refund' As SrcBillType,mms_refund.RefundDate As TakeDate,
	'' As SupplyType, mms_merchants.MerchantsName As PickUnitName,mms_refundDetail.MaterialCode,mms_material.MaterialName,mms_material.Model,mms_refundDetail.Unit,
	mms_refundDetail.UnitPrice,-mms_refundDetail.Num,-mms_refundDetail.Money,mms_material.MaterialType,mms_materialType.Type As MaterialKind
From mms_refund
Left join mms_refundDetail On mms_refundDetail.BillNo=mms_refund.BillNo
Left join mms_material On mms_material.MaterialCode=mms_refundDetail.MaterialCode
Left join mms_materialType On mms_materialType.MaterialType=mms_material.MaterialType
Left join mms_merchants On mms_merchants.MerchantsCode=mms_refund.RefundUnit
Where mms_refund.ApproveState='passed'  And  mms_refund.ProjectCode='201306030001'

Union
--调拨
Select mms_transferDetail.BillNo As SrcBillNo,mms_transferDetail.RowId As SrcRowId,'transfer' As SrcBillType,mms_transfer.TransferDate As TakeDate,
	'' As SupplyType, mms_merchants.MerchantsName As PickUnitName,mms_transferDetail.MaterialCode,mms_material.MaterialName,mms_material.Model,mms_transferDetail.Unit,
	mms_transferDetail.UnitPrice,mms_transferDetail.Num,mms_transferDetail.Money,mms_material.MaterialType,mms_materialType.Type As MaterialKind
From mms_transfer
Left join mms_transferDetail On mms_transferDetail.BillNo=mms_transfer.BillNo
Left join mms_material On mms_material.MaterialCode=mms_transferDetail.MaterialCode
Left join mms_materialType On mms_materialType.MaterialType=mms_material.MaterialType
Left join mms_merchants On mms_merchants.MerchantsCode=mms_transfer.ReceiveUnit
Where mms_transfer.ApproveState='passed' And  mms_transfer.ProjectCode='201306030001'

Union
--报损
Select mms_lossReportDetail.BillNo As SrcBillNo,mms_lossReportDetail.RowId As SrcRowId,'lossReport' As SrcBillType,mms_lossReport.LossReportDate As TakeDate,
	'' As SupplyType, '其他' As PickUnitName,mms_lossReportDetail.MaterialCode,mms_material.MaterialName,mms_material.Model,mms_lossReportDetail.Unit,
	mms_lossReportDetail.UnitPrice,mms_lossReportDetail.Num,mms_lossReportDetail.Money,mms_material.MaterialType,mms_materialType.Type As MaterialKind
From mms_lossReport
Left join mms_lossReportDetail On mms_lossReportDetail.BillNo=mms_lossReport.BillNo
Left join mms_material On mms_material.MaterialCode=mms_lossReportDetail.MaterialCode
Left join mms_materialType On mms_materialType.MaterialType=mms_material.MaterialType
Where mms_lossReport.ApproveState='passed'  And  mms_lossReport.ProjectCode='201306030001'
) as t
Where PickUnitName<>'' and PickUnitName<>'其他' and PickUnitName<>'租赁进场'
group by PickUnitName
                
2020-05-07 10:51:56,508 [13720] DEBUG Mms - 
Select MaterialCode,MaterialName,Model,MaterialKind,MaterialType,Unit
    ,ISNULL(Sum(CASE WHEN SupplyType<>'' then Money else 0 end),0) as ReceiveMoney --合计
    ,ISNULL(Sum(CASE WHEN SupplyType='082' then Money else 0 end),0) as StockSelfMoney --自采
    ,ISNULL(Sum(CASE WHEN SupplyType='083' then Money else 0 end),0) as OwnerSupplyMoney --甲供
    ,ISNULL(Sum(CASE WHEN SupplyType='084' then Money else 0 end),0) as CallInMoney --调入
    ,ISNULL(Sum(CASE WHEN SupplyType='其他' then Money else 0 end),0) as ReceiveOtherMoney --其他

    ,ISNULL(Sum(CASE WHEN SupplyType<>'' then Num else 0 end),0) as ReceiveNum --合计
    ,ISNULL(Sum(CASE WHEN SupplyType='082' then Num else 0 end),0) as StockSelfNum --自采
    ,ISNULL(Sum(CASE WHEN SupplyType='083' then Num else 0 end),0) as OwnerSupplyNum --甲供
    ,ISNULL(Sum(CASE WHEN SupplyType='084' then Num else 0 end),0) as CallInNum --调入
	,ISNULL(Sum(CASE WHEN SupplyType='租赁进场' then Num else 0 end),0) as ReceiveRentInNum --租赁进场
    ,ISNULL(Sum(CASE WHEN SupplyType='其他' then Num else 0 end),0) as ReceiveOtherNum --其他

    ,ISNULL(Sum(CASE WHEN PickUnitName<>'' then Money else 0 end),0) as SendMoney --合计
    ,ISNULL(Sum(CASE WHEN PickUnitName<>'' then Num else 0 end),0) as SendNum --合计
     ,ISNULL(Sum(CASE WHEN PickUnitName='北京士兴钢结构有限公司' then Num else 0 end),0) as PickUnitNum0 ,ISNULL(Sum(CASE WHEN PickUnitName='北京士兴钢结构有限公司' then Money else 0 end),0) as PickUnitMoney0 ,ISNULL(Sum(CASE WHEN PickUnitName='河北天强建筑工程有限公司' then Num else 0 end),0) as PickUnitNum1 ,ISNULL(Sum(CASE WHEN PickUnitName='河北天强建筑工程有限公司' then Money else 0 end),0) as PickUnitMoney1                                                             --领料人生成的列
    ,ISNULL(Sum(CASE WHEN PickUnitName='租赁进场' then Num else 0 end),0) as SendRentInNum --租赁进场
    ,ISNULL(Sum(CASE WHEN PickUnitName='其他' then Money else 0 end),0) as SendOtherMoney --其他
    ,ISNULL(Sum(CASE WHEN PickUnitName='其他' then Num else 0 end),0) as SendOtherNum --其他

    ,ISNULL(Sum(CASE WHEN SupplyType<>'' then Num else -Num end),0) as TotalNum --合计
    ,ISNULL(Sum(CASE WHEN SupplyType<>'' then Money else -Money end),0) as TotalMoney --合计

From (
--收料单
Select mms_receiveDetail.BillNo As SrcBillNo,mms_receiveDetail.RowId As SrcRowId,'receive' As SrcBillType,mms_receive.ReceiveDate As TakeDate,
	mms_receive.SupplyType As SupplyType,'' As PickUnitName, mms_receiveDetail.MaterialCode,mms_material.MaterialName,mms_material.Model,mms_receiveDetail.Unit,
	mms_receiveDetail.UnitPrice,mms_receiveDetail.Num,mms_receiveDetail.Money,mms_material.MaterialType,mms_materialType.Type As MaterialKind
From mms_receive
Left join mms_receiveDetail On mms_receiveDetail.BillNo=mms_receive.BillNo
Left join mms_material On mms_material.MaterialCode=mms_receiveDetail.MaterialCode
Left join mms_materialType On mms_materialType.MaterialType=mms_material.MaterialType
Where mms_receive.ApproveState='passed'  And  mms_receive.ProjectCode='201306030001'

Union
--退货单
Select mms_returnDetail.BillNo As SrcBillNo,mms_returnDetail.RowId As SrcRowId,'return' As SrcBillType,mms_return.ReturnDate As TakeDate,
	'其他' As SupplyType,'' As PickUnitName, mms_returnDetail.MaterialCode,mms_material.MaterialName,mms_material.Model,mms_returnDetail.Unit,
	mms_returnDetail.UnitPrice,-mms_returnDetail.Num,-mms_returnDetail.Money,mms_material.MaterialType,mms_materialType.Type As MaterialKind
From mms_return
Left join mms_returnDetail On mms_returnDetail.BillNo=mms_return.BillNo
Left join mms_material On mms_material.MaterialCode=mms_returnDetail.MaterialCode
Left join mms_materialType On mms_materialType.MaterialType=mms_material.MaterialType
Where mms_return.ApproveState='passed'  And  mms_return.ProjectCode='201306030001'

Union
--直入直出
Select mms_directDetail.BillNo As SrcBillNo,mms_directDetail.RowId As SrcRowId,'direct' As SrcBillType,mms_direct.ArriveDate As TakeDate,
	mms_direct.SupplyType As SupplyType,mms_merchants.MerchantsName As PickUnitName, mms_directDetail.MaterialCode,mms_material.MaterialName,mms_material.Model,mms_directDetail.Unit,
	mms_directDetail.UnitPrice,mms_directDetail.Num,mms_directDetail.Money,mms_material.MaterialType,mms_materialType.Type As MaterialKind
From mms_direct
Left join mms_directDetail On mms_directDetail.BillNo=mms_direct.BillNo
Left join mms_material On mms_material.MaterialCode=mms_directDetail.MaterialCode
Left join mms_materialType On mms_materialType.MaterialType=mms_material.MaterialType
Left join mms_merchants On mms_merchants.MerchantsCode=mms_direct.PickUnit
Where mms_direct.ApproveState='passed'  And  mms_direct.ProjectCode='201306030001'

Union
--租赁进场
Select mms_rentinDetail.BillNo As SrcBillNo,mms_rentinDetail.RowId As SrcRowId,'rentin' As SrcBillType,mms_rentin.RentInDate As TakeDate,
	'租赁进场' As SupplyType,'租赁进场' As PickUnitName, mms_rentinDetail.MaterialCode,mms_material.MaterialName,mms_material.Model,mms_rentinDetail.Unit,
	mms_rentinDetail.UnitPrice,mms_rentinDetail.Num,'0' As Money,mms_material.MaterialType,mms_materialType.Type As MaterialKind
From mms_rentin
Left join mms_rentinDetail On mms_rentinDetail.BillNo=mms_rentin.BillNo
Left join mms_material On mms_material.MaterialCode=mms_rentinDetail.MaterialCode
Left join mms_materialType On mms_materialType.MaterialType=mms_material.MaterialType
Left join mms_merchants On mms_merchants.MerchantsCode=mms_rentinDetail.UseUnit
Where mms_rentin.ApproveState='passed'  And  mms_rentin.ProjectCode='201306030001'

Union
--库存调整
Select mms_stockAdjustDetail.BillNo As SrcBillNo,mms_stockAdjustDetail.RowId As SrcRowId,'adjust' As SrcBillType,mms_stockAdjust.EffectDate As TakeDate,
	'其他' As SupplyType,'' As PickUnitName, mms_stockAdjustDetail.MaterialCode,mms_material.MaterialName,mms_material.Model,mms_stockAdjustDetail.Unit,
	mms_stockAdjustDetail.UnitPrice,mms_stockAdjustDetail.Num,mms_stockAdjustDetail.Money,mms_material.MaterialType,mms_materialType.Type As MaterialKind
From mms_stockAdjust
Left join mms_stockAdjustDetail On mms_stockAdjustDetail.BillNo=mms_stockAdjust.BillNo
Left join mms_material On mms_material.MaterialCode=mms_stockAdjustDetail.MaterialCode
Left join mms_materialType On mms_materialType.MaterialType=mms_material.MaterialType
Where mms_stockAdjust.ApproveState='passed'  And  mms_stockAdjust.ProjectCode='201306030001'

Union
--发料
Select mms_sendDetail.BillNo As SrcBillNo,mms_sendDetail.RowId As SrcRowId,'send' As SrcBillType,mms_send.SendDate As TakeDate,
	'' As SupplyType, mms_merchants.MerchantsName As PickUnitName,mms_sendDetail.MaterialCode,mms_material.MaterialName,mms_material.Model,mms_sendDetail.Unit,
	mms_sendDetail.UnitPrice,mms_sendDetail.Num,mms_sendDetail.Money,mms_material.MaterialType,mms_materialType.Type As MaterialKind
From mms_send
Left join mms_sendDetail On mms_sendDetail.BillNo=mms_send.BillNo
Left join mms_material On mms_material.MaterialCode=mms_sendDetail.MaterialCode
Left join mms_materialType On mms_materialType.MaterialType=mms_material.MaterialType
Left join mms_merchants On mms_merchants.MerchantsCode=mms_send.PickUnit
Where mms_send.ApproveState='passed'  And  mms_send.ProjectCode='201306030001'

Union
--退库
Select mms_refundDetail.BillNo As SrcBillNo,mms_refundDetail.RowId As SrcRowId,'refund' As SrcBillType,mms_refund.RefundDate As TakeDate,
	'' As SupplyType, mms_merchants.MerchantsName As PickUnitName,mms_refundDetail.MaterialCode,mms_material.MaterialName,mms_material.Model,mms_refundDetail.Unit,
	mms_refundDetail.UnitPrice,-mms_refundDetail.Num,-mms_refundDetail.Money,mms_material.MaterialType,mms_materialType.Type As MaterialKind
From mms_refund
Left join mms_refundDetail On mms_refundDetail.BillNo=mms_refund.BillNo
Left join mms_material On mms_material.MaterialCode=mms_refundDetail.MaterialCode
Left join mms_materialType On mms_materialType.MaterialType=mms_material.MaterialType
Left join mms_merchants On mms_merchants.MerchantsCode=mms_refund.RefundUnit
Where mms_refund.ApproveState='passed'  And  mms_refund.ProjectCode='201306030001'

Union
--调拨
Select mms_transferDetail.BillNo As SrcBillNo,mms_transferDetail.RowId As SrcRowId,'transfer' As SrcBillType,mms_transfer.TransferDate As TakeDate,
	'' As SupplyType, mms_merchants.MerchantsName As PickUnitName,mms_transferDetail.MaterialCode,mms_material.MaterialName,mms_material.Model,mms_transferDetail.Unit,
	mms_transferDetail.UnitPrice,mms_transferDetail.Num,mms_transferDetail.Money,mms_material.MaterialType,mms_materialType.Type As MaterialKind
From mms_transfer
Left join mms_transferDetail On mms_transferDetail.BillNo=mms_transfer.BillNo
Left join mms_material On mms_material.MaterialCode=mms_transferDetail.MaterialCode
Left join mms_materialType On mms_materialType.MaterialType=mms_material.MaterialType
Left join mms_merchants On mms_merchants.MerchantsCode=mms_transfer.ReceiveUnit
Where mms_transfer.ApproveState='passed' And  mms_transfer.ProjectCode='201306030001'

Union
--报损
Select mms_lossReportDetail.BillNo As SrcBillNo,mms_lossReportDetail.RowId As SrcRowId,'lossReport' As SrcBillType,mms_lossReport.LossReportDate As TakeDate,
	'' As SupplyType, '其他' As PickUnitName,mms_lossReportDetail.MaterialCode,mms_material.MaterialName,mms_material.Model,mms_lossReportDetail.Unit,
	mms_lossReportDetail.UnitPrice,mms_lossReportDetail.Num,mms_lossReportDetail.Money,mms_material.MaterialType,mms_materialType.Type As MaterialKind
From mms_lossReport
Left join mms_lossReportDetail On mms_lossReportDetail.BillNo=mms_lossReport.BillNo
Left join mms_material On mms_material.MaterialCode=mms_lossReportDetail.MaterialCode
Left join mms_materialType On mms_materialType.MaterialType=mms_material.MaterialType
Where mms_lossReport.ApproveState='passed'  And  mms_lossReport.ProjectCode='201306030001'
) as t
group by MaterialCode,MaterialName,Model,MaterialKind,MaterialType,Unit

2020-05-07 10:51:56,510 [13720] DEBUG Mms - 
Select mms_warehouseStockHistory.MaterialCode,sum(Num) As InitNum,sum(UnitPrice*Num) As InitMoney
From mms_warehouseStockHistory
Left join mms_warehouse on mms_warehouse.warehouseCode=mms_warehouseStockHistory.warehouseCode
Left join mms_material on mms_material.MaterialCode=mms_warehouseStockHistory.MaterialCode
Where 1=1  And  mms_warehouse.ProjectCode='201306030001'
group by mms_warehouseStockHistory.MaterialCode

2020-05-07 10:51:56,576 [13720] ERROR /home/download - System.Exception: htmldoc未实现多选title
   在 Zephyr.Core.HtmlDocExport.MergeCell(Int32 x1, Int32 y1, Int32 x2, Int32 y2) 位置 f:\程序\Project\tb\BN089-BS开发框架_20140717\source20131023\Zephyr.Net\Zephyr.Core\Exporter\HtmlDocExport.cs:行号 38
   在 Zephyr.Core.Exporter.Export(IExport export) 位置 f:\程序\Project\tb\BN089-BS开发框架_20140717\source20131023\Zephyr.Net\Zephyr.Core\Exporter\Exporter.cs:行号 143
   在 Zephyr.Core.Exporter.Export(String type) 位置 f:\程序\Project\tb\BN089-BS开发框架_20140717\source20131023\Zephyr.Net\Zephyr.Core\Exporter\Exporter.cs:行号 107
   在 Zephyr.Core.Exporter.Instance() 位置 f:\程序\Project\tb\BN089-BS开发框架_20140717\source20131023\Zephyr.Net\Zephyr.Core\Exporter\Exporter.cs:行号 60
   在 Zephyr.Controllers.HomeController.Download() 位置 f:\程序\Project\tb\BN089-BS开发框架_20140717\source20131023\Zephyr.Web\Controllers\HomeController.cs:行号 31
   在 lambda_method(Closure , ControllerBase , Object[] )
   在 System.Web.Mvc.ActionMethodDispatcher.<>c__DisplayClass1.<WrapVoidAction>b__0(ControllerBase controller, Object[] parameters)
   在 System.Web.Mvc.ActionMethodDispatcher.Execute(ControllerBase controller, Object[] parameters)
   在 System.Web.Mvc.ReflectedActionDescriptor.Execute(ControllerContext controllerContext, IDictionary`2 parameters)
   在 System.Web.Mvc.ControllerActionInvoker.InvokeActionMethod(ControllerContext controllerContext, ActionDescriptor actionDescriptor, IDictionary`2 parameters)
   在 System.Web.Mvc.Async.AsyncControllerActionInvoker.<>c__DisplayClass42.<BeginInvokeSynchronousActionMethod>b__41()
   在 System.Web.Mvc.Async.AsyncResultWrapper.<>c__DisplayClass8`1.<BeginSynchronous>b__7(IAsyncResult _)
   在 System.Web.Mvc.Async.AsyncResultWrapper.WrappedAsyncResult`1.End()
   在 System.Web.Mvc.Async.AsyncControllerActionInvoker.EndInvokeActionMethod(IAsyncResult asyncResult)
   在 System.Web.Mvc.Async.AsyncControllerActionInvoker.<>c__DisplayClass37.<>c__DisplayClass39.<BeginInvokeActionMethodWithFilters>b__33()
   在 System.Web.Mvc.Async.AsyncControllerActionInvoker.<>c__DisplayClass4f.<InvokeActionMethodFilterAsynchronously>b__49()
   在 System.Web.Mvc.Async.AsyncControllerActionInvoker.<>c__DisplayClass4f.<InvokeActionMethodFilterAsynchronously>b__49()
   在 System.Web.Mvc.Async.AsyncControllerActionInvoker.<>c__DisplayClass4f.<InvokeActionMethodFilterAsynchronously>b__49()
   在 System.Web.Mvc.Async.AsyncControllerActionInvoker.<>c__DisplayClass37.<BeginInvokeActionMethodWithFilters>b__36(IAsyncResult asyncResult)
   在 System.Web.Mvc.Async.AsyncResultWrapper.WrappedAsyncResult`1.End()
   在 System.Web.Mvc.Async.AsyncControllerActionInvoker.EndInvokeActionMethodWithFilters(IAsyncResult asyncResult)
   在 System.Web.Mvc.Async.AsyncControllerActionInvoker.<>c__DisplayClass25.<>c__DisplayClass2a.<BeginInvokeAction>b__20()
   在 System.Web.Mvc.Async.AsyncControllerActionInvoker.<>c__DisplayClass25.<BeginInvokeAction>b__22(IAsyncResult asyncResult)
2020-05-07 10:52:01,069 [10300] DEBUG Mms - 
Select PickUnitName
From (
--收料单
Select mms_receiveDetail.BillNo As SrcBillNo,mms_receiveDetail.RowId As SrcRowId,'receive' As SrcBillType,mms_receive.ReceiveDate As TakeDate,
	mms_receive.SupplyType As SupplyType,'' As PickUnitName, mms_receiveDetail.MaterialCode,mms_material.MaterialName,mms_material.Model,mms_receiveDetail.Unit,
	mms_receiveDetail.UnitPrice,mms_receiveDetail.Num,mms_receiveDetail.Money,mms_material.MaterialType,mms_materialType.Type As MaterialKind
From mms_receive
Left join mms_receiveDetail On mms_receiveDetail.BillNo=mms_receive.BillNo
Left join mms_material On mms_material.MaterialCode=mms_receiveDetail.MaterialCode
Left join mms_materialType On mms_materialType.MaterialType=mms_material.MaterialType
Where mms_receive.ApproveState='passed'  And  mms_receive.ProjectCode='201306030001'

Union
--退货单
Select mms_returnDetail.BillNo As SrcBillNo,mms_returnDetail.RowId As SrcRowId,'return' As SrcBillType,mms_return.ReturnDate As TakeDate,
	'其他' As SupplyType,'' As PickUnitName, mms_returnDetail.MaterialCode,mms_material.MaterialName,mms_material.Model,mms_returnDetail.Unit,
	mms_returnDetail.UnitPrice,-mms_returnDetail.Num,-mms_returnDetail.Money,mms_material.MaterialType,mms_materialType.Type As MaterialKind
From mms_return
Left join mms_returnDetail On mms_returnDetail.BillNo=mms_return.BillNo
Left join mms_material On mms_material.MaterialCode=mms_returnDetail.MaterialCode
Left join mms_materialType On mms_materialType.MaterialType=mms_material.MaterialType
Where mms_return.ApproveState='passed'  And  mms_return.ProjectCode='201306030001'

Union
--直入直出
Select mms_directDetail.BillNo As SrcBillNo,mms_directDetail.RowId As SrcRowId,'direct' As SrcBillType,mms_direct.ArriveDate As TakeDate,
	mms_direct.SupplyType As SupplyType,mms_merchants.MerchantsName As PickUnitName, mms_directDetail.MaterialCode,mms_material.MaterialName,mms_material.Model,mms_directDetail.Unit,
	mms_directDetail.UnitPrice,mms_directDetail.Num,mms_directDetail.Money,mms_material.MaterialType,mms_materialType.Type As MaterialKind
From mms_direct
Left join mms_directDetail On mms_directDetail.BillNo=mms_direct.BillNo
Left join mms_material On mms_material.MaterialCode=mms_directDetail.MaterialCode
Left join mms_materialType On mms_materialType.MaterialType=mms_material.MaterialType
Left join mms_merchants On mms_merchants.MerchantsCode=mms_direct.PickUnit
Where mms_direct.ApproveState='passed'  And  mms_direct.ProjectCode='201306030001'

Union
--租赁进场
Select mms_rentinDetail.BillNo As SrcBillNo,mms_rentinDetail.RowId As SrcRowId,'rentin' As SrcBillType,mms_rentin.RentInDate As TakeDate,
	'租赁进场' As SupplyType,'租赁进场' As PickUnitName, mms_rentinDetail.MaterialCode,mms_material.MaterialName,mms_material.Model,mms_rentinDetail.Unit,
	mms_rentinDetail.UnitPrice,mms_rentinDetail.Num,'0' As Money,mms_material.MaterialType,mms_materialType.Type As MaterialKind
From mms_rentin
Left join mms_rentinDetail On mms_rentinDetail.BillNo=mms_rentin.BillNo
Left join mms_material On mms_material.MaterialCode=mms_rentinDetail.MaterialCode
Left join mms_materialType On mms_materialType.MaterialType=mms_material.MaterialType
Left join mms_merchants On mms_merchants.MerchantsCode=mms_rentinDetail.UseUnit
Where mms_rentin.ApproveState='passed'  And  mms_rentin.ProjectCode='201306030001'

Union
--库存调整
Select mms_stockAdjustDetail.BillNo As SrcBillNo,mms_stockAdjustDetail.RowId As SrcRowId,'adjust' As SrcBillType,mms_stockAdjust.EffectDate As TakeDate,
	'其他' As SupplyType,'' As PickUnitName, mms_stockAdjustDetail.MaterialCode,mms_material.MaterialName,mms_material.Model,mms_stockAdjustDetail.Unit,
	mms_stockAdjustDetail.UnitPrice,mms_stockAdjustDetail.Num,mms_stockAdjustDetail.Money,mms_material.MaterialType,mms_materialType.Type As MaterialKind
From mms_stockAdjust
Left join mms_stockAdjustDetail On mms_stockAdjustDetail.BillNo=mms_stockAdjust.BillNo
Left join mms_material On mms_material.MaterialCode=mms_stockAdjustDetail.MaterialCode
Left join mms_materialType On mms_materialType.MaterialType=mms_material.MaterialType
Where mms_stockAdjust.ApproveState='passed'  And  mms_stockAdjust.ProjectCode='201306030001'

Union
--发料
Select mms_sendDetail.BillNo As SrcBillNo,mms_sendDetail.RowId As SrcRowId,'send' As SrcBillType,mms_send.SendDate As TakeDate,
	'' As SupplyType, mms_merchants.MerchantsName As PickUnitName,mms_sendDetail.MaterialCode,mms_material.MaterialName,mms_material.Model,mms_sendDetail.Unit,
	mms_sendDetail.UnitPrice,mms_sendDetail.Num,mms_sendDetail.Money,mms_material.MaterialType,mms_materialType.Type As MaterialKind
From mms_send
Left join mms_sendDetail On mms_sendDetail.BillNo=mms_send.BillNo
Left join mms_material On mms_material.MaterialCode=mms_sendDetail.MaterialCode
Left join mms_materialType On mms_materialType.MaterialType=mms_material.MaterialType
Left join mms_merchants On mms_merchants.MerchantsCode=mms_send.PickUnit
Where mms_send.ApproveState='passed'  And  mms_send.ProjectCode='201306030001'

Union
--退库
Select mms_refundDetail.BillNo As SrcBillNo,mms_refundDetail.RowId As SrcRowId,'refund' As SrcBillType,mms_refund.RefundDate As TakeDate,
	'' As SupplyType, mms_merchants.MerchantsName As PickUnitName,mms_refundDetail.MaterialCode,mms_material.MaterialName,mms_material.Model,mms_refundDetail.Unit,
	mms_refundDetail.UnitPrice,-mms_refundDetail.Num,-mms_refundDetail.Money,mms_material.MaterialType,mms_materialType.Type As MaterialKind
From mms_refund
Left join mms_refundDetail On mms_refundDetail.BillNo=mms_refund.BillNo
Left join mms_material On mms_material.MaterialCode=mms_refundDetail.MaterialCode
Left join mms_materialType On mms_materialType.MaterialType=mms_material.MaterialType
Left join mms_merchants On mms_merchants.MerchantsCode=mms_refund.RefundUnit
Where mms_refund.ApproveState='passed'  And  mms_refund.ProjectCode='201306030001'

Union
--调拨
Select mms_transferDetail.BillNo As SrcBillNo,mms_transferDetail.RowId As SrcRowId,'transfer' As SrcBillType,mms_transfer.TransferDate As TakeDate,
	'' As SupplyType, mms_merchants.MerchantsName As PickUnitName,mms_transferDetail.MaterialCode,mms_material.MaterialName,mms_material.Model,mms_transferDetail.Unit,
	mms_transferDetail.UnitPrice,mms_transferDetail.Num,mms_transferDetail.Money,mms_material.MaterialType,mms_materialType.Type As MaterialKind
From mms_transfer
Left join mms_transferDetail On mms_transferDetail.BillNo=mms_transfer.BillNo
Left join mms_material On mms_material.MaterialCode=mms_transferDetail.MaterialCode
Left join mms_materialType On mms_materialType.MaterialType=mms_material.MaterialType
Left join mms_merchants On mms_merchants.MerchantsCode=mms_transfer.ReceiveUnit
Where mms_transfer.ApproveState='passed' And  mms_transfer.ProjectCode='201306030001'

Union
--报损
Select mms_lossReportDetail.BillNo As SrcBillNo,mms_lossReportDetail.RowId As SrcRowId,'lossReport' As SrcBillType,mms_lossReport.LossReportDate As TakeDate,
	'' As SupplyType, '其他' As PickUnitName,mms_lossReportDetail.MaterialCode,mms_material.MaterialName,mms_material.Model,mms_lossReportDetail.Unit,
	mms_lossReportDetail.UnitPrice,mms_lossReportDetail.Num,mms_lossReportDetail.Money,mms_material.MaterialType,mms_materialType.Type As MaterialKind
From mms_lossReport
Left join mms_lossReportDetail On mms_lossReportDetail.BillNo=mms_lossReport.BillNo
Left join mms_material On mms_material.MaterialCode=mms_lossReportDetail.MaterialCode
Left join mms_materialType On mms_materialType.MaterialType=mms_material.MaterialType
Where mms_lossReport.ApproveState='passed'  And  mms_lossReport.ProjectCode='201306030001'
) as t
Where PickUnitName<>'' and PickUnitName<>'其他' and PickUnitName<>'租赁进场'
group by PickUnitName
                
2020-05-07 10:52:01,070 [10300] DEBUG Mms - 
Select MaterialCode,MaterialName,Model,MaterialKind,MaterialType,Unit
    ,ISNULL(Sum(CASE WHEN SupplyType<>'' then Money else 0 end),0) as ReceiveMoney --合计
    ,ISNULL(Sum(CASE WHEN SupplyType='082' then Money else 0 end),0) as StockSelfMoney --自采
    ,ISNULL(Sum(CASE WHEN SupplyType='083' then Money else 0 end),0) as OwnerSupplyMoney --甲供
    ,ISNULL(Sum(CASE WHEN SupplyType='084' then Money else 0 end),0) as CallInMoney --调入
    ,ISNULL(Sum(CASE WHEN SupplyType='其他' then Money else 0 end),0) as ReceiveOtherMoney --其他

    ,ISNULL(Sum(CASE WHEN SupplyType<>'' then Num else 0 end),0) as ReceiveNum --合计
    ,ISNULL(Sum(CASE WHEN SupplyType='082' then Num else 0 end),0) as StockSelfNum --自采
    ,ISNULL(Sum(CASE WHEN SupplyType='083' then Num else 0 end),0) as OwnerSupplyNum --甲供
    ,ISNULL(Sum(CASE WHEN SupplyType='084' then Num else 0 end),0) as CallInNum --调入
	,ISNULL(Sum(CASE WHEN SupplyType='租赁进场' then Num else 0 end),0) as ReceiveRentInNum --租赁进场
    ,ISNULL(Sum(CASE WHEN SupplyType='其他' then Num else 0 end),0) as ReceiveOtherNum --其他

    ,ISNULL(Sum(CASE WHEN PickUnitName<>'' then Money else 0 end),0) as SendMoney --合计
    ,ISNULL(Sum(CASE WHEN PickUnitName<>'' then Num else 0 end),0) as SendNum --合计
     ,ISNULL(Sum(CASE WHEN PickUnitName='北京士兴钢结构有限公司' then Num else 0 end),0) as PickUnitNum0 ,ISNULL(Sum(CASE WHEN PickUnitName='北京士兴钢结构有限公司' then Money else 0 end),0) as PickUnitMoney0 ,ISNULL(Sum(CASE WHEN PickUnitName='河北天强建筑工程有限公司' then Num else 0 end),0) as PickUnitNum1 ,ISNULL(Sum(CASE WHEN PickUnitName='河北天强建筑工程有限公司' then Money else 0 end),0) as PickUnitMoney1                                                             --领料人生成的列
    ,ISNULL(Sum(CASE WHEN PickUnitName='租赁进场' then Num else 0 end),0) as SendRentInNum --租赁进场
    ,ISNULL(Sum(CASE WHEN PickUnitName='其他' then Money else 0 end),0) as SendOtherMoney --其他
    ,ISNULL(Sum(CASE WHEN PickUnitName='其他' then Num else 0 end),0) as SendOtherNum --其他

    ,ISNULL(Sum(CASE WHEN SupplyType<>'' then Num else -Num end),0) as TotalNum --合计
    ,ISNULL(Sum(CASE WHEN SupplyType<>'' then Money else -Money end),0) as TotalMoney --合计

From (
--收料单
Select mms_receiveDetail.BillNo As SrcBillNo,mms_receiveDetail.RowId As SrcRowId,'receive' As SrcBillType,mms_receive.ReceiveDate As TakeDate,
	mms_receive.SupplyType As SupplyType,'' As PickUnitName, mms_receiveDetail.MaterialCode,mms_material.MaterialName,mms_material.Model,mms_receiveDetail.Unit,
	mms_receiveDetail.UnitPrice,mms_receiveDetail.Num,mms_receiveDetail.Money,mms_material.MaterialType,mms_materialType.Type As MaterialKind
From mms_receive
Left join mms_receiveDetail On mms_receiveDetail.BillNo=mms_receive.BillNo
Left join mms_material On mms_material.MaterialCode=mms_receiveDetail.MaterialCode
Left join mms_materialType On mms_materialType.MaterialType=mms_material.MaterialType
Where mms_receive.ApproveState='passed'  And  mms_receive.ProjectCode='201306030001'

Union
--退货单
Select mms_returnDetail.BillNo As SrcBillNo,mms_returnDetail.RowId As SrcRowId,'return' As SrcBillType,mms_return.ReturnDate As TakeDate,
	'其他' As SupplyType,'' As PickUnitName, mms_returnDetail.MaterialCode,mms_material.MaterialName,mms_material.Model,mms_returnDetail.Unit,
	mms_returnDetail.UnitPrice,-mms_returnDetail.Num,-mms_returnDetail.Money,mms_material.MaterialType,mms_materialType.Type As MaterialKind
From mms_return
Left join mms_returnDetail On mms_returnDetail.BillNo=mms_return.BillNo
Left join mms_material On mms_material.MaterialCode=mms_returnDetail.MaterialCode
Left join mms_materialType On mms_materialType.MaterialType=mms_material.MaterialType
Where mms_return.ApproveState='passed'  And  mms_return.ProjectCode='201306030001'

Union
--直入直出
Select mms_directDetail.BillNo As SrcBillNo,mms_directDetail.RowId As SrcRowId,'direct' As SrcBillType,mms_direct.ArriveDate As TakeDate,
	mms_direct.SupplyType As SupplyType,mms_merchants.MerchantsName As PickUnitName, mms_directDetail.MaterialCode,mms_material.MaterialName,mms_material.Model,mms_directDetail.Unit,
	mms_directDetail.UnitPrice,mms_directDetail.Num,mms_directDetail.Money,mms_material.MaterialType,mms_materialType.Type As MaterialKind
From mms_direct
Left join mms_directDetail On mms_directDetail.BillNo=mms_direct.BillNo
Left join mms_material On mms_material.MaterialCode=mms_directDetail.MaterialCode
Left join mms_materialType On mms_materialType.MaterialType=mms_material.MaterialType
Left join mms_merchants On mms_merchants.MerchantsCode=mms_direct.PickUnit
Where mms_direct.ApproveState='passed'  And  mms_direct.ProjectCode='201306030001'

Union
--租赁进场
Select mms_rentinDetail.BillNo As SrcBillNo,mms_rentinDetail.RowId As SrcRowId,'rentin' As SrcBillType,mms_rentin.RentInDate As TakeDate,
	'租赁进场' As SupplyType,'租赁进场' As PickUnitName, mms_rentinDetail.MaterialCode,mms_material.MaterialName,mms_material.Model,mms_rentinDetail.Unit,
	mms_rentinDetail.UnitPrice,mms_rentinDetail.Num,'0' As Money,mms_material.MaterialType,mms_materialType.Type As MaterialKind
From mms_rentin
Left join mms_rentinDetail On mms_rentinDetail.BillNo=mms_rentin.BillNo
Left join mms_material On mms_material.MaterialCode=mms_rentinDetail.MaterialCode
Left join mms_materialType On mms_materialType.MaterialType=mms_material.MaterialType
Left join mms_merchants On mms_merchants.MerchantsCode=mms_rentinDetail.UseUnit
Where mms_rentin.ApproveState='passed'  And  mms_rentin.ProjectCode='201306030001'

Union
--库存调整
Select mms_stockAdjustDetail.BillNo As SrcBillNo,mms_stockAdjustDetail.RowId As SrcRowId,'adjust' As SrcBillType,mms_stockAdjust.EffectDate As TakeDate,
	'其他' As SupplyType,'' As PickUnitName, mms_stockAdjustDetail.MaterialCode,mms_material.MaterialName,mms_material.Model,mms_stockAdjustDetail.Unit,
	mms_stockAdjustDetail.UnitPrice,mms_stockAdjustDetail.Num,mms_stockAdjustDetail.Money,mms_material.MaterialType,mms_materialType.Type As MaterialKind
From mms_stockAdjust
Left join mms_stockAdjustDetail On mms_stockAdjustDetail.BillNo=mms_stockAdjust.BillNo
Left join mms_material On mms_material.MaterialCode=mms_stockAdjustDetail.MaterialCode
Left join mms_materialType On mms_materialType.MaterialType=mms_material.MaterialType
Where mms_stockAdjust.ApproveState='passed'  And  mms_stockAdjust.ProjectCode='201306030001'

Union
--发料
Select mms_sendDetail.BillNo As SrcBillNo,mms_sendDetail.RowId As SrcRowId,'send' As SrcBillType,mms_send.SendDate As TakeDate,
	'' As SupplyType, mms_merchants.MerchantsName As PickUnitName,mms_sendDetail.MaterialCode,mms_material.MaterialName,mms_material.Model,mms_sendDetail.Unit,
	mms_sendDetail.UnitPrice,mms_sendDetail.Num,mms_sendDetail.Money,mms_material.MaterialType,mms_materialType.Type As MaterialKind
From mms_send
Left join mms_sendDetail On mms_sendDetail.BillNo=mms_send.BillNo
Left join mms_material On mms_material.MaterialCode=mms_sendDetail.MaterialCode
Left join mms_materialType On mms_materialType.MaterialType=mms_material.MaterialType
Left join mms_merchants On mms_merchants.MerchantsCode=mms_send.PickUnit
Where mms_send.ApproveState='passed'  And  mms_send.ProjectCode='201306030001'

Union
--退库
Select mms_refundDetail.BillNo As SrcBillNo,mms_refundDetail.RowId As SrcRowId,'refund' As SrcBillType,mms_refund.RefundDate As TakeDate,
	'' As SupplyType, mms_merchants.MerchantsName As PickUnitName,mms_refundDetail.MaterialCode,mms_material.MaterialName,mms_material.Model,mms_refundDetail.Unit,
	mms_refundDetail.UnitPrice,-mms_refundDetail.Num,-mms_refundDetail.Money,mms_material.MaterialType,mms_materialType.Type As MaterialKind
From mms_refund
Left join mms_refundDetail On mms_refundDetail.BillNo=mms_refund.BillNo
Left join mms_material On mms_material.MaterialCode=mms_refundDetail.MaterialCode
Left join mms_materialType On mms_materialType.MaterialType=mms_material.MaterialType
Left join mms_merchants On mms_merchants.MerchantsCode=mms_refund.RefundUnit
Where mms_refund.ApproveState='passed'  And  mms_refund.ProjectCode='201306030001'

Union
--调拨
Select mms_transferDetail.BillNo As SrcBillNo,mms_transferDetail.RowId As SrcRowId,'transfer' As SrcBillType,mms_transfer.TransferDate As TakeDate,
	'' As SupplyType, mms_merchants.MerchantsName As PickUnitName,mms_transferDetail.MaterialCode,mms_material.MaterialName,mms_material.Model,mms_transferDetail.Unit,
	mms_transferDetail.UnitPrice,mms_transferDetail.Num,mms_transferDetail.Money,mms_material.MaterialType,mms_materialType.Type As MaterialKind
From mms_transfer
Left join mms_transferDetail On mms_transferDetail.BillNo=mms_transfer.BillNo
Left join mms_material On mms_material.MaterialCode=mms_transferDetail.MaterialCode
Left join mms_materialType On mms_materialType.MaterialType=mms_material.MaterialType
Left join mms_merchants On mms_merchants.MerchantsCode=mms_transfer.ReceiveUnit
Where mms_transfer.ApproveState='passed' And  mms_transfer.ProjectCode='201306030001'

Union
--报损
Select mms_lossReportDetail.BillNo As SrcBillNo,mms_lossReportDetail.RowId As SrcRowId,'lossReport' As SrcBillType,mms_lossReport.LossReportDate As TakeDate,
	'' As SupplyType, '其他' As PickUnitName,mms_lossReportDetail.MaterialCode,mms_material.MaterialName,mms_material.Model,mms_lossReportDetail.Unit,
	mms_lossReportDetail.UnitPrice,mms_lossReportDetail.Num,mms_lossReportDetail.Money,mms_material.MaterialType,mms_materialType.Type As MaterialKind
From mms_lossReport
Left join mms_lossReportDetail On mms_lossReportDetail.BillNo=mms_lossReport.BillNo
Left join mms_material On mms_material.MaterialCode=mms_lossReportDetail.MaterialCode
Left join mms_materialType On mms_materialType.MaterialType=mms_material.MaterialType
Where mms_lossReport.ApproveState='passed'  And  mms_lossReport.ProjectCode='201306030001'
) as t
group by MaterialCode,MaterialName,Model,MaterialKind,MaterialType,Unit

2020-05-07 10:52:01,071 [10300] DEBUG Mms - 
Select mms_warehouseStockHistory.MaterialCode,sum(Num) As InitNum,sum(UnitPrice*Num) As InitMoney
From mms_warehouseStockHistory
Left join mms_warehouse on mms_warehouse.warehouseCode=mms_warehouseStockHistory.warehouseCode
Left join mms_material on mms_material.MaterialCode=mms_warehouseStockHistory.MaterialCode
Where 1=1  And  mms_warehouse.ProjectCode='201306030001'
group by mms_warehouseStockHistory.MaterialCode

2020-05-07 10:52:07,175 [13720] DEBUG Sys - select * from sys_userSetting where UserCode='admin'
2020-05-07 10:52:07,419 [12024] DEBUG Sys - 
--角色的菜单
select distinct B.*
from sys_roleMenuMap A
inner join sys_menu  B on B.MenuCode = A.MenuCode
where B.IsEnable='1'
  and RoleCode in (
  select RoleCode from sys_userRoleMap where UserCode = 'admin' --用户的角色
union all
  select RoleCode from sys_organizeRoleMap where OrganizeCode in  --机构的角色
  (
	select OrganizeCode from sys_userOrganizeMap where UserCode = 'admin'
  )  
)
order by B.MenuSeq,B.MenuCode
2020-05-07 10:52:15,154 [10300] DEBUG ServiceModelBase - 获取动态列表
2020-05-07 10:52:15,155 [10300] DEBUG Mms - select top 20 
    ProjectName as text,ProjectCode as value
   from 
    mms_project
   order by ProjectCode
2020-05-07 10:52:15,156 [10300] DEBUG Mms - select count(*) from ( select 
    ProjectName as text,ProjectCode as value
   from 
    mms_project
   ) tb_temp
2020-05-07 10:52:21,855 [13720] DEBUG ServiceModelBase - 获取动态列表
2020-05-07 10:52:21,855 [13720] DEBUG Mms - select top 20 
    ProjectName as text,ProjectCode as value
   from 
    mms_project
   order by ProjectCode
2020-05-07 10:52:21,855 [13720] DEBUG Mms - select count(*) from ( select 
    ProjectName as text,ProjectCode as value
   from 
    mms_project
   ) tb_temp
2020-05-07 10:52:28,762 [10300] DEBUG Sys - select * from sys_userSetting where UserCode='admin'
2020-05-07 10:53:43,113 [13720] DEBUG Servicesys_user - 获取实体对象
2020-05-07 10:53:43,114 [13720] DEBUG Sys - select sys_user.* from sys_user where  UserCode =  'admin'and Password =  '1234'and IsEnable =  'True'
2020-05-07 10:53:43,123 [13720] DEBUG Sys - 
update sys_user
set LoginCount = isnull(LoginCount,0) + 1
   ,LastLoginDate = getdate()
where UserCode = 'admin' 
2020-05-07 10:53:43,127 [13720] DEBUG Sys - insert into sys_loginHistory([UserCode],[UserName],[HostName],[HostIP],[LoginCity],[LoginDate]) values('admin','管理员','','111.199.55.211','','2020/5/7 10:53:43')
2020-05-07 10:53:43,129 [13720] DEBUG Servicemms_project - 获取实体对象
2020-05-07 10:53:43,129 [13720] DEBUG Mms - select mms_project.* from mms_project where  ProjectCode =  '201306030001'
2020-05-07 10:53:43,207 [10300] DEBUG Sys - select * from sys_userSetting where UserCode='admin'
2020-05-07 10:53:43,793 [6392] DEBUG Sys - 
--角色的菜单
select distinct B.*
from sys_roleMenuMap A
inner join sys_menu  B on B.MenuCode = A.MenuCode
where B.IsEnable='1'
  and RoleCode in (
  select RoleCode from sys_userRoleMap where UserCode = 'admin' --用户的角色
union all
  select RoleCode from sys_organizeRoleMap where OrganizeCode in  --机构的角色
  (
	select OrganizeCode from sys_userOrganizeMap where UserCode = 'admin'
  )  
)
order by B.MenuSeq,B.MenuCode
2020-05-07 10:53:49,512 [10300] DEBUG Sys - 
select 1
from sys_roleMenuMap A
left join sys_userRoleMap B on B.RoleCode = A.RoleCode
left join sys_menu C on C.MenuCode = A.MenuCode
where B.UserCode = 'admin'
and C.URL in ('/Mms/report/balanceaccount')
2020-05-07 10:53:49,520 [10300] DEBUG Servicemms_warehouse - 获取动态列表
2020-05-07 10:53:49,520 [10300] DEBUG Mms - select WarehouseCode as value,WarehouseName as text from mms_warehouse where  ProjectCode =  '201306030001'
2020-05-07 10:53:49,521 [10300] DEBUG Servicemms_buildPart - 获取动态列表
2020-05-07 10:53:49,521 [10300] DEBUG Mms - select BuildPartCode as value,BuildPartName as text from mms_buildPart where  ProjectCode =  '201306030001'
2020-05-07 10:53:49,989 [10300] DEBUG Mms - 
Select PickUnitName
From (
--收料单
Select mms_receiveDetail.BillNo As SrcBillNo,mms_receiveDetail.RowId As SrcRowId,'receive' As SrcBillType,mms_receive.ReceiveDate As TakeDate,
	mms_receive.SupplyType As SupplyType,'' As PickUnitName, mms_receiveDetail.MaterialCode,mms_material.MaterialName,mms_material.Model,mms_receiveDetail.Unit,
	mms_receiveDetail.UnitPrice,mms_receiveDetail.Num,mms_receiveDetail.Money,mms_material.MaterialType,mms_materialType.Type As MaterialKind
From mms_receive
Left join mms_receiveDetail On mms_receiveDetail.BillNo=mms_receive.BillNo
Left join mms_material On mms_material.MaterialCode=mms_receiveDetail.MaterialCode
Left join mms_materialType On mms_materialType.MaterialType=mms_material.MaterialType
Where mms_receive.ApproveState='passed'  And  mms_receive.ProjectCode='201306030001'

Union
--退货单
Select mms_returnDetail.BillNo As SrcBillNo,mms_returnDetail.RowId As SrcRowId,'return' As SrcBillType,mms_return.ReturnDate As TakeDate,
	'其他' As SupplyType,'' As PickUnitName, mms_returnDetail.MaterialCode,mms_material.MaterialName,mms_material.Model,mms_returnDetail.Unit,
	mms_returnDetail.UnitPrice,-mms_returnDetail.Num,-mms_returnDetail.Money,mms_material.MaterialType,mms_materialType.Type As MaterialKind
From mms_return
Left join mms_returnDetail On mms_returnDetail.BillNo=mms_return.BillNo
Left join mms_material On mms_material.MaterialCode=mms_returnDetail.MaterialCode
Left join mms_materialType On mms_materialType.MaterialType=mms_material.MaterialType
Where mms_return.ApproveState='passed'  And  mms_return.ProjectCode='201306030001'

Union
--直入直出
Select mms_directDetail.BillNo As SrcBillNo,mms_directDetail.RowId As SrcRowId,'direct' As SrcBillType,mms_direct.ArriveDate As TakeDate,
	mms_direct.SupplyType As SupplyType,mms_merchants.MerchantsName As PickUnitName, mms_directDetail.MaterialCode,mms_material.MaterialName,mms_material.Model,mms_directDetail.Unit,
	mms_directDetail.UnitPrice,mms_directDetail.Num,mms_directDetail.Money,mms_material.MaterialType,mms_materialType.Type As MaterialKind
From mms_direct
Left join mms_directDetail On mms_directDetail.BillNo=mms_direct.BillNo
Left join mms_material On mms_material.MaterialCode=mms_directDetail.MaterialCode
Left join mms_materialType On mms_materialType.MaterialType=mms_material.MaterialType
Left join mms_merchants On mms_merchants.MerchantsCode=mms_direct.PickUnit
Where mms_direct.ApproveState='passed'  And  mms_direct.ProjectCode='201306030001'

Union
--租赁进场
Select mms_rentinDetail.BillNo As SrcBillNo,mms_rentinDetail.RowId As SrcRowId,'rentin' As SrcBillType,mms_rentin.RentInDate As TakeDate,
	'租赁进场' As SupplyType,'租赁进场' As PickUnitName, mms_rentinDetail.MaterialCode,mms_material.MaterialName,mms_material.Model,mms_rentinDetail.Unit,
	mms_rentinDetail.UnitPrice,mms_rentinDetail.Num,'0' As Money,mms_material.MaterialType,mms_materialType.Type As MaterialKind
From mms_rentin
Left join mms_rentinDetail On mms_rentinDetail.BillNo=mms_rentin.BillNo
Left join mms_material On mms_material.MaterialCode=mms_rentinDetail.MaterialCode
Left join mms_materialType On mms_materialType.MaterialType=mms_material.MaterialType
Left join mms_merchants On mms_merchants.MerchantsCode=mms_rentinDetail.UseUnit
Where mms_rentin.ApproveState='passed'  And  mms_rentin.ProjectCode='201306030001'

Union
--库存调整
Select mms_stockAdjustDetail.BillNo As SrcBillNo,mms_stockAdjustDetail.RowId As SrcRowId,'adjust' As SrcBillType,mms_stockAdjust.EffectDate As TakeDate,
	'其他' As SupplyType,'' As PickUnitName, mms_stockAdjustDetail.MaterialCode,mms_material.MaterialName,mms_material.Model,mms_stockAdjustDetail.Unit,
	mms_stockAdjustDetail.UnitPrice,mms_stockAdjustDetail.Num,mms_stockAdjustDetail.Money,mms_material.MaterialType,mms_materialType.Type As MaterialKind
From mms_stockAdjust
Left join mms_stockAdjustDetail On mms_stockAdjustDetail.BillNo=mms_stockAdjust.BillNo
Left join mms_material On mms_material.MaterialCode=mms_stockAdjustDetail.MaterialCode
Left join mms_materialType On mms_materialType.MaterialType=mms_material.MaterialType
Where mms_stockAdjust.ApproveState='passed'  And  mms_stockAdjust.ProjectCode='201306030001'

Union
--发料
Select mms_sendDetail.BillNo As SrcBillNo,mms_sendDetail.RowId As SrcRowId,'send' As SrcBillType,mms_send.SendDate As TakeDate,
	'' As SupplyType, mms_merchants.MerchantsName As PickUnitName,mms_sendDetail.MaterialCode,mms_material.MaterialName,mms_material.Model,mms_sendDetail.Unit,
	mms_sendDetail.UnitPrice,mms_sendDetail.Num,mms_sendDetail.Money,mms_material.MaterialType,mms_materialType.Type As MaterialKind
From mms_send
Left join mms_sendDetail On mms_sendDetail.BillNo=mms_send.BillNo
Left join mms_material On mms_material.MaterialCode=mms_sendDetail.MaterialCode
Left join mms_materialType On mms_materialType.MaterialType=mms_material.MaterialType
Left join mms_merchants On mms_merchants.MerchantsCode=mms_send.PickUnit
Where mms_send.ApproveState='passed'  And  mms_send.ProjectCode='201306030001'

Union
--退库
Select mms_refundDetail.BillNo As SrcBillNo,mms_refundDetail.RowId As SrcRowId,'refund' As SrcBillType,mms_refund.RefundDate As TakeDate,
	'' As SupplyType, mms_merchants.MerchantsName As PickUnitName,mms_refundDetail.MaterialCode,mms_material.MaterialName,mms_material.Model,mms_refundDetail.Unit,
	mms_refundDetail.UnitPrice,-mms_refundDetail.Num,-mms_refundDetail.Money,mms_material.MaterialType,mms_materialType.Type As MaterialKind
From mms_refund
Left join mms_refundDetail On mms_refundDetail.BillNo=mms_refund.BillNo
Left join mms_material On mms_material.MaterialCode=mms_refundDetail.MaterialCode
Left join mms_materialType On mms_materialType.MaterialType=mms_material.MaterialType
Left join mms_merchants On mms_merchants.MerchantsCode=mms_refund.RefundUnit
Where mms_refund.ApproveState='passed'  And  mms_refund.ProjectCode='201306030001'

Union
--调拨
Select mms_transferDetail.BillNo As SrcBillNo,mms_transferDetail.RowId As SrcRowId,'transfer' As SrcBillType,mms_transfer.TransferDate As TakeDate,
	'' As SupplyType, mms_merchants.MerchantsName As PickUnitName,mms_transferDetail.MaterialCode,mms_material.MaterialName,mms_material.Model,mms_transferDetail.Unit,
	mms_transferDetail.UnitPrice,mms_transferDetail.Num,mms_transferDetail.Money,mms_material.MaterialType,mms_materialType.Type As MaterialKind
From mms_transfer
Left join mms_transferDetail On mms_transferDetail.BillNo=mms_transfer.BillNo
Left join mms_material On mms_material.MaterialCode=mms_transferDetail.MaterialCode
Left join mms_materialType On mms_materialType.MaterialType=mms_material.MaterialType
Left join mms_merchants On mms_merchants.MerchantsCode=mms_transfer.ReceiveUnit
Where mms_transfer.ApproveState='passed' And  mms_transfer.ProjectCode='201306030001'

Union
--报损
Select mms_lossReportDetail.BillNo As SrcBillNo,mms_lossReportDetail.RowId As SrcRowId,'lossReport' As SrcBillType,mms_lossReport.LossReportDate As TakeDate,
	'' As SupplyType, '其他' As PickUnitName,mms_lossReportDetail.MaterialCode,mms_material.MaterialName,mms_material.Model,mms_lossReportDetail.Unit,
	mms_lossReportDetail.UnitPrice,mms_lossReportDetail.Num,mms_lossReportDetail.Money,mms_material.MaterialType,mms_materialType.Type As MaterialKind
From mms_lossReport
Left join mms_lossReportDetail On mms_lossReportDetail.BillNo=mms_lossReport.BillNo
Left join mms_material On mms_material.MaterialCode=mms_lossReportDetail.MaterialCode
Left join mms_materialType On mms_materialType.MaterialType=mms_material.MaterialType
Where mms_lossReport.ApproveState='passed'  And  mms_lossReport.ProjectCode='201306030001'
) as t
Where PickUnitName<>'' and PickUnitName<>'其他' and PickUnitName<>'租赁进场'
group by PickUnitName
                
2020-05-07 10:53:50,071 [10300] DEBUG Mms - 
Select MaterialCode,MaterialName,Model,MaterialKind,MaterialType,Unit
    ,ISNULL(Sum(CASE WHEN SupplyType<>'' then Money else 0 end),0) as ReceiveMoney --合计
    ,ISNULL(Sum(CASE WHEN SupplyType='082' then Money else 0 end),0) as StockSelfMoney --自采
    ,ISNULL(Sum(CASE WHEN SupplyType='083' then Money else 0 end),0) as OwnerSupplyMoney --甲供
    ,ISNULL(Sum(CASE WHEN SupplyType='084' then Money else 0 end),0) as CallInMoney --调入
    ,ISNULL(Sum(CASE WHEN SupplyType='其他' then Money else 0 end),0) as ReceiveOtherMoney --其他

    ,ISNULL(Sum(CASE WHEN SupplyType<>'' then Num else 0 end),0) as ReceiveNum --合计
    ,ISNULL(Sum(CASE WHEN SupplyType='082' then Num else 0 end),0) as StockSelfNum --自采
    ,ISNULL(Sum(CASE WHEN SupplyType='083' then Num else 0 end),0) as OwnerSupplyNum --甲供
    ,ISNULL(Sum(CASE WHEN SupplyType='084' then Num else 0 end),0) as CallInNum --调入
	,ISNULL(Sum(CASE WHEN SupplyType='租赁进场' then Num else 0 end),0) as ReceiveRentInNum --租赁进场
    ,ISNULL(Sum(CASE WHEN SupplyType='其他' then Num else 0 end),0) as ReceiveOtherNum --其他

    ,ISNULL(Sum(CASE WHEN PickUnitName<>'' then Money else 0 end),0) as SendMoney --合计
    ,ISNULL(Sum(CASE WHEN PickUnitName<>'' then Num else 0 end),0) as SendNum --合计
     ,ISNULL(Sum(CASE WHEN PickUnitName='北京士兴钢结构有限公司' then Num else 0 end),0) as PickUnitNum0 ,ISNULL(Sum(CASE WHEN PickUnitName='北京士兴钢结构有限公司' then Money else 0 end),0) as PickUnitMoney0 ,ISNULL(Sum(CASE WHEN PickUnitName='河北天强建筑工程有限公司' then Num else 0 end),0) as PickUnitNum1 ,ISNULL(Sum(CASE WHEN PickUnitName='河北天强建筑工程有限公司' then Money else 0 end),0) as PickUnitMoney1                                                             --领料人生成的列
    ,ISNULL(Sum(CASE WHEN PickUnitName='租赁进场' then Num else 0 end),0) as SendRentInNum --租赁进场
    ,ISNULL(Sum(CASE WHEN PickUnitName='其他' then Money else 0 end),0) as SendOtherMoney --其他
    ,ISNULL(Sum(CASE WHEN PickUnitName='其他' then Num else 0 end),0) as SendOtherNum --其他

    ,ISNULL(Sum(CASE WHEN SupplyType<>'' then Num else -Num end),0) as TotalNum --合计
    ,ISNULL(Sum(CASE WHEN SupplyType<>'' then Money else -Money end),0) as TotalMoney --合计

From (
--收料单
Select mms_receiveDetail.BillNo As SrcBillNo,mms_receiveDetail.RowId As SrcRowId,'receive' As SrcBillType,mms_receive.ReceiveDate As TakeDate,
	mms_receive.SupplyType As SupplyType,'' As PickUnitName, mms_receiveDetail.MaterialCode,mms_material.MaterialName,mms_material.Model,mms_receiveDetail.Unit,
	mms_receiveDetail.UnitPrice,mms_receiveDetail.Num,mms_receiveDetail.Money,mms_material.MaterialType,mms_materialType.Type As MaterialKind
From mms_receive
Left join mms_receiveDetail On mms_receiveDetail.BillNo=mms_receive.BillNo
Left join mms_material On mms_material.MaterialCode=mms_receiveDetail.MaterialCode
Left join mms_materialType On mms_materialType.MaterialType=mms_material.MaterialType
Where mms_receive.ApproveState='passed'  And  mms_receive.ProjectCode='201306030001'

Union
--退货单
Select mms_returnDetail.BillNo As SrcBillNo,mms_returnDetail.RowId As SrcRowId,'return' As SrcBillType,mms_return.ReturnDate As TakeDate,
	'其他' As SupplyType,'' As PickUnitName, mms_returnDetail.MaterialCode,mms_material.MaterialName,mms_material.Model,mms_returnDetail.Unit,
	mms_returnDetail.UnitPrice,-mms_returnDetail.Num,-mms_returnDetail.Money,mms_material.MaterialType,mms_materialType.Type As MaterialKind
From mms_return
Left join mms_returnDetail On mms_returnDetail.BillNo=mms_return.BillNo
Left join mms_material On mms_material.MaterialCode=mms_returnDetail.MaterialCode
Left join mms_materialType On mms_materialType.MaterialType=mms_material.MaterialType
Where mms_return.ApproveState='passed'  And  mms_return.ProjectCode='201306030001'

Union
--直入直出
Select mms_directDetail.BillNo As SrcBillNo,mms_directDetail.RowId As SrcRowId,'direct' As SrcBillType,mms_direct.ArriveDate As TakeDate,
	mms_direct.SupplyType As SupplyType,mms_merchants.MerchantsName As PickUnitName, mms_directDetail.MaterialCode,mms_material.MaterialName,mms_material.Model,mms_directDetail.Unit,
	mms_directDetail.UnitPrice,mms_directDetail.Num,mms_directDetail.Money,mms_material.MaterialType,mms_materialType.Type As MaterialKind
From mms_direct
Left join mms_directDetail On mms_directDetail.BillNo=mms_direct.BillNo
Left join mms_material On mms_material.MaterialCode=mms_directDetail.MaterialCode
Left join mms_materialType On mms_materialType.MaterialType=mms_material.MaterialType
Left join mms_merchants On mms_merchants.MerchantsCode=mms_direct.PickUnit
Where mms_direct.ApproveState='passed'  And  mms_direct.ProjectCode='201306030001'

Union
--租赁进场
Select mms_rentinDetail.BillNo As SrcBillNo,mms_rentinDetail.RowId As SrcRowId,'rentin' As SrcBillType,mms_rentin.RentInDate As TakeDate,
	'租赁进场' As SupplyType,'租赁进场' As PickUnitName, mms_rentinDetail.MaterialCode,mms_material.MaterialName,mms_material.Model,mms_rentinDetail.Unit,
	mms_rentinDetail.UnitPrice,mms_rentinDetail.Num,'0' As Money,mms_material.MaterialType,mms_materialType.Type As MaterialKind
From mms_rentin
Left join mms_rentinDetail On mms_rentinDetail.BillNo=mms_rentin.BillNo
Left join mms_material On mms_material.MaterialCode=mms_rentinDetail.MaterialCode
Left join mms_materialType On mms_materialType.MaterialType=mms_material.MaterialType
Left join mms_merchants On mms_merchants.MerchantsCode=mms_rentinDetail.UseUnit
Where mms_rentin.ApproveState='passed'  And  mms_rentin.ProjectCode='201306030001'

Union
--库存调整
Select mms_stockAdjustDetail.BillNo As SrcBillNo,mms_stockAdjustDetail.RowId As SrcRowId,'adjust' As SrcBillType,mms_stockAdjust.EffectDate As TakeDate,
	'其他' As SupplyType,'' As PickUnitName, mms_stockAdjustDetail.MaterialCode,mms_material.MaterialName,mms_material.Model,mms_stockAdjustDetail.Unit,
	mms_stockAdjustDetail.UnitPrice,mms_stockAdjustDetail.Num,mms_stockAdjustDetail.Money,mms_material.MaterialType,mms_materialType.Type As MaterialKind
From mms_stockAdjust
Left join mms_stockAdjustDetail On mms_stockAdjustDetail.BillNo=mms_stockAdjust.BillNo
Left join mms_material On mms_material.MaterialCode=mms_stockAdjustDetail.MaterialCode
Left join mms_materialType On mms_materialType.MaterialType=mms_material.MaterialType
Where mms_stockAdjust.ApproveState='passed'  And  mms_stockAdjust.ProjectCode='201306030001'

Union
--发料
Select mms_sendDetail.BillNo As SrcBillNo,mms_sendDetail.RowId As SrcRowId,'send' As SrcBillType,mms_send.SendDate As TakeDate,
	'' As SupplyType, mms_merchants.MerchantsName As PickUnitName,mms_sendDetail.MaterialCode,mms_material.MaterialName,mms_material.Model,mms_sendDetail.Unit,
	mms_sendDetail.UnitPrice,mms_sendDetail.Num,mms_sendDetail.Money,mms_material.MaterialType,mms_materialType.Type As MaterialKind
From mms_send
Left join mms_sendDetail On mms_sendDetail.BillNo=mms_send.BillNo
Left join mms_material On mms_material.MaterialCode=mms_sendDetail.MaterialCode
Left join mms_materialType On mms_materialType.MaterialType=mms_material.MaterialType
Left join mms_merchants On mms_merchants.MerchantsCode=mms_send.PickUnit
Where mms_send.ApproveState='passed'  And  mms_send.ProjectCode='201306030001'

Union
--退库
Select mms_refundDetail.BillNo As SrcBillNo,mms_refundDetail.RowId As SrcRowId,'refund' As SrcBillType,mms_refund.RefundDate As TakeDate,
	'' As SupplyType, mms_merchants.MerchantsName As PickUnitName,mms_refundDetail.MaterialCode,mms_material.MaterialName,mms_material.Model,mms_refundDetail.Unit,
	mms_refundDetail.UnitPrice,-mms_refundDetail.Num,-mms_refundDetail.Money,mms_material.MaterialType,mms_materialType.Type As MaterialKind
From mms_refund
Left join mms_refundDetail On mms_refundDetail.BillNo=mms_refund.BillNo
Left join mms_material On mms_material.MaterialCode=mms_refundDetail.MaterialCode
Left join mms_materialType On mms_materialType.MaterialType=mms_material.MaterialType
Left join mms_merchants On mms_merchants.MerchantsCode=mms_refund.RefundUnit
Where mms_refund.ApproveState='passed'  And  mms_refund.ProjectCode='201306030001'

Union
--调拨
Select mms_transferDetail.BillNo As SrcBillNo,mms_transferDetail.RowId As SrcRowId,'transfer' As SrcBillType,mms_transfer.TransferDate As TakeDate,
	'' As SupplyType, mms_merchants.MerchantsName As PickUnitName,mms_transferDetail.MaterialCode,mms_material.MaterialName,mms_material.Model,mms_transferDetail.Unit,
	mms_transferDetail.UnitPrice,mms_transferDetail.Num,mms_transferDetail.Money,mms_material.MaterialType,mms_materialType.Type As MaterialKind
From mms_transfer
Left join mms_transferDetail On mms_transferDetail.BillNo=mms_transfer.BillNo
Left join mms_material On mms_material.MaterialCode=mms_transferDetail.MaterialCode
Left join mms_materialType On mms_materialType.MaterialType=mms_material.MaterialType
Left join mms_merchants On mms_merchants.MerchantsCode=mms_transfer.ReceiveUnit
Where mms_transfer.ApproveState='passed' And  mms_transfer.ProjectCode='201306030001'

Union
--报损
Select mms_lossReportDetail.BillNo As SrcBillNo,mms_lossReportDetail.RowId As SrcRowId,'lossReport' As SrcBillType,mms_lossReport.LossReportDate As TakeDate,
	'' As SupplyType, '其他' As PickUnitName,mms_lossReportDetail.MaterialCode,mms_material.MaterialName,mms_material.Model,mms_lossReportDetail.Unit,
	mms_lossReportDetail.UnitPrice,mms_lossReportDetail.Num,mms_lossReportDetail.Money,mms_material.MaterialType,mms_materialType.Type As MaterialKind
From mms_lossReport
Left join mms_lossReportDetail On mms_lossReportDetail.BillNo=mms_lossReport.BillNo
Left join mms_material On mms_material.MaterialCode=mms_lossReportDetail.MaterialCode
Left join mms_materialType On mms_materialType.MaterialType=mms_material.MaterialType
Where mms_lossReport.ApproveState='passed'  And  mms_lossReport.ProjectCode='201306030001'
) as t
group by MaterialCode,MaterialName,Model,MaterialKind,MaterialType,Unit

2020-05-07 10:53:50,139 [10300] DEBUG Mms - 
Select mms_warehouseStockHistory.MaterialCode,sum(Num) As InitNum,sum(UnitPrice*Num) As InitMoney
From mms_warehouseStockHistory
Left join mms_warehouse on mms_warehouse.warehouseCode=mms_warehouseStockHistory.warehouseCode
Left join mms_material on mms_material.MaterialCode=mms_warehouseStockHistory.MaterialCode
Where 1=1  And  mms_warehouse.ProjectCode='201306030001'
group by mms_warehouseStockHistory.MaterialCode

2020-05-07 10:56:32,392 [12956] DEBUG Sys - select name from dbo.sysobjects where id = object_id(N'[dbo].[fun_getPY]') and xtype in (N'FN', N'IF', N'TF')
2020-05-07 10:56:32,521 [12956] DEBUG Sys - select name from dbo.sysobjects where id = object_id(N'[dbo].[fun_getPY]') and xtype in (N'FN', N'IF', N'TF')
2020-05-07 10:56:32,525 [12956] DEBUG Mms - select name from dbo.sysobjects where id = object_id(N'[dbo].[fun_getPY]') and xtype in (N'FN', N'IF', N'TF')
2020-05-07 10:56:32,534 [12956] DEBUG Mms - select name from dbo.sysobjects where id = object_id(N'[dbo].[fun_getPY]') and xtype in (N'FN', N'IF', N'TF')
2020-05-07 11:20:24,982 [13964] DEBUG Servicesys_user - 获取实体对象
2020-05-07 11:20:24,995 [13964] DEBUG Sys - select sys_user.* from sys_user where  UserCode =  'admin'and Password =  '1234'and IsEnable =  'True'
2020-05-07 11:20:25,056 [13964] DEBUG Sys - 
update sys_user
set LoginCount = isnull(LoginCount,0) + 1
   ,LastLoginDate = getdate()
where UserCode = 'admin' 
2020-05-07 11:20:25,093 [13964] DEBUG Sys - insert into sys_loginHistory([UserCode],[UserName],[HostName],[HostIP],[LoginCity],[LoginDate]) values('admin','管理员','','111.199.55.211','','2020/5/7 11:20:25')
2020-05-07 11:20:25,099 [13964] DEBUG Servicemms_project - 获取实体对象
2020-05-07 11:20:25,101 [13964] DEBUG Mms - select mms_project.* from mms_project where  ProjectCode =  '201306030001'
2020-05-07 11:20:25,213 [13324] DEBUG Sys - select * from sys_userSetting where UserCode='admin'
2020-05-07 11:20:26,871 [13724] DEBUG Sys - 
--角色的菜单
select distinct B.*
from sys_roleMenuMap A
inner join sys_menu  B on B.MenuCode = A.MenuCode
where B.IsEnable='1'
  and RoleCode in (
  select RoleCode from sys_userRoleMap where UserCode = 'admin' --用户的角色
union all
  select RoleCode from sys_organizeRoleMap where OrganizeCode in  --机构的角色
  (
	select OrganizeCode from sys_userOrganizeMap where UserCode = 'admin'
  )  
)
order by B.MenuSeq,B.MenuCode
2020-05-07 11:20:34,650 [10060] DEBUG Sys - 
select 1
from sys_roleMenuMap A
left join sys_userRoleMap B on B.RoleCode = A.RoleCode
left join sys_menu C on C.MenuCode = A.MenuCode
where B.UserCode = 'admin'
and C.URL in ('/Mms/receive/Index','/Mms/receive')
2020-05-07 11:20:34,660 [10060] DEBUG Servicemms_warehouse - 获取动态列表
2020-05-07 11:20:34,661 [10060] DEBUG Mms - select WarehouseCode as value,WarehouseName as text from mms_warehouse where  ProjectCode =  '201306030001'
2020-05-07 11:20:34,663 [10060] DEBUG Servicesys_code - 获取动态列表
2020-05-07 11:20:34,663 [10060] DEBUG Sys - select Code as value,Text as text from sys_code where  CodeType =  'SupplyType'
2020-05-07 11:20:35,920 [13724] DEBUG Servicemms_receive - 获取动态列表
2020-05-07 11:20:35,921 [13724] DEBUG Mms - select top 20 
        A.*, B.ProjectName, C.MaterialTypeName, D.WarehouseName as WarehouseName, E.MerchantsName AS SupplierName
     from 
        mms_receive A
        left join mms_project       B on B.ProjectCode      = A.ProjectCode
        left join mms_materialType  C on C.MaterialType = A.MaterialType
        left join mms_warehouse         D on D.WarehouseCode       = A.WarehouseCode
        left join mms_merchants     E on E.MerchantsCode    = A.SupplierCode
     where  A.ProjectCode =  '201306030001' order by A.BillNo
2020-05-07 11:20:35,935 [13724] DEBUG Mms - select count(*) from ( select 
        A.*, B.ProjectName, C.MaterialTypeName, D.WarehouseName as WarehouseName, E.MerchantsName AS SupplierName
     from 
        mms_receive A
        left join mms_project       B on B.ProjectCode      = A.ProjectCode
        left join mms_materialType  C on C.MaterialType = A.MaterialType
        left join mms_warehouse         D on D.WarehouseCode       = A.WarehouseCode
        left join mms_merchants     E on E.MerchantsCode    = A.SupplierCode
     where  A.ProjectCode =  '201306030001' ) tb_temp
2020-05-07 14:45:28,098 [13456] DEBUG Sys - select name from dbo.sysobjects where id = object_id(N'[dbo].[fun_getPY]') and xtype in (N'FN', N'IF', N'TF')
2020-05-07 14:45:28,469 [13456] DEBUG Sys - select name from dbo.sysobjects where id = object_id(N'[dbo].[fun_getPY]') and xtype in (N'FN', N'IF', N'TF')
2020-05-07 14:45:28,506 [13456] DEBUG Mms - select name from dbo.sysobjects where id = object_id(N'[dbo].[fun_getPY]') and xtype in (N'FN', N'IF', N'TF')
2020-05-07 14:45:28,523 [13456] DEBUG Mms - select name from dbo.sysobjects where id = object_id(N'[dbo].[fun_getPY]') and xtype in (N'FN', N'IF', N'TF')
2020-05-07 15:58:45,717 [11320] DEBUG Sys - select name from dbo.sysobjects where id = object_id(N'[dbo].[fun_getPY]') and xtype in (N'FN', N'IF', N'TF')
2020-05-07 15:58:45,749 [11320] DEBUG Sys - select name from dbo.sysobjects where id = object_id(N'[dbo].[fun_getPY]') and xtype in (N'FN', N'IF', N'TF')
2020-05-07 15:58:45,753 [11320] DEBUG Mms - select name from dbo.sysobjects where id = object_id(N'[dbo].[fun_getPY]') and xtype in (N'FN', N'IF', N'TF')
2020-05-07 15:58:45,769 [11320] DEBUG Mms - select name from dbo.sysobjects where id = object_id(N'[dbo].[fun_getPY]') and xtype in (N'FN', N'IF', N'TF')
